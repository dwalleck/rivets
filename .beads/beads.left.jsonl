{"id":"rivets-014n","content_hash":"168900b563daaa24530656c000143bdbe2bdab164a1b094efa03540130bb541e","title":"Refactor: Extract shared filter logic between list() and ready_to_work()","description":"In storage/in_memory/trait_impl.rs, the filter logic in `list()` (lines 342-378) and `ready_to_work()` (lines 413-451) is nearly identical:\n\n**list() filter:**\n```rust\n.filter(|issue| {\n    if let Some(status) = \u0026filter.status {\n        if \u0026issue.status != status { return false; }\n    }\n    if let Some(priority) = filter.priority {\n        if issue.priority != priority { return false; }\n    }\n    if let Some(issue_type) = \u0026filter.issue_type {\n        if \u0026issue.issue_type != issue_type { return false; }\n    }\n    if let Some(assignee) = \u0026filter.assignee {\n        if issue.assignee.as_ref() != Some(assignee) { return false; }\n    }\n    if let Some(label) = \u0026filter.label {\n        if !issue.labels.contains(label) { return false; }\n    }\n    true\n})\n```\n\n**ready_to_work() has the exact same logic.**\n\n**Recommendation:** Extract to a helper:\n```rust\nfn matches_filter(issue: \u0026Issue, filter: \u0026IssueFilter) -\u003e bool {\n    if let Some(status) = \u0026filter.status {\n        if \u0026issue.status != status { return false; }\n    }\n    // ... rest of filter logic\n    true\n}\n```\n\nThen use in both methods:\n```rust\n.filter(|issue| matches_filter(issue, filter))\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T09:51:16.121637806-06:00","updated_at":"2025-12-28T14:57:12.887646398-06:00","closed_at":"2025-12-28T14:57:12.887646398-06:00","source_repo":".","labels":["DRY","refactor","trait_impl.rs"],"dependencies":[{"issue_id":"rivets-014n","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:52:00.833402452-06:00","created_by":"dwalleck"}]}
{"id":"rivets-02t","content_hash":"f1d7cb67c9d2f2dd7128612026765a06630501144032a08155ebc6b438db073b","title":"Implement modification tools (create, update, close, dep)","description":"Implement issue modification tools:\n- create(title, description, priority, type, ...) - Create issue\n- update(issue_id, status, priority, ...) - Update fields\n- close(issue_id, reason) - Mark complete (update status to Closed)\n- dep(issue_id, depends_on_id, dep_type) - Add dependency","acceptance_criteria":"- [ ] create tool creates issue and saves\n- [ ] update tool modifies fields correctly\n- [ ] close tool sets status to Closed\n- [ ] dep tool adds dependency with cycle detection\n- [ ] Unit tests: each tool with MockStorage (happy path + error cases)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:16:28.277217069-06:00","updated_at":"2025-11-29T19:19:22.951737809-06:00","closed_at":"2025-11-29T19:19:22.951737809-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-02t","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:17:45.742468544-06:00","created_by":"dwalleck"},{"issue_id":"rivets-02t","depends_on_id":"rivets-6u6","type":"blocks","created_at":"2025-11-28T19:18:47.046864037-06:00","created_by":"dwalleck"},{"issue_id":"rivets-02t","depends_on_id":"rivets-vdi","type":"blocks","created_at":"2025-11-29T17:37:05.21843294-06:00","created_by":"dwalleck"}]}
{"id":"rivets-067","content_hash":"0df353712e2e2d7a7d07cd4e1c1b12a0d842e184efe9ddc1220846d79b87c8f0","title":"Create rivets-automerge crate scaffold","description":"Set up the new crate with Cargo.toml, basic module structure, and dependencies.\n\nDependencies to add:\n- autosurgeon = \"0.9\"\n- automerge = \"0.7\"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T13:10:22.019758791-06:00","updated_at":"2025-12-22T22:44:53.700012982-06:00","closed_at":"2025-12-22T22:44:53.700012982-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-067","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T13:10:22.049221624-06:00","created_by":"dwalleck"}]}
{"id":"rivets-06w","content_hash":"5baa9903e0dcee2a1052c8215fb2ce156eafa76ad8050de0150c28b4e71897bd","title":"Implement core domain types (Issue, Dependency, Filter)","description":"Create the core domain types that represent issues, dependencies, filters, and related structures. These are used across all storage implementations and the CLI.","design":"Create domain module in rivets crate (src/domain/mod.rs):\n\n**Module Structure**:\n```\nsrc/domain/\n├── mod.rs          # Public exports\n├── issue.rs        # Issue, NewIssue, IssueUpdate\n├── dependency.rs   # Dependency, DependencyType\n├── filter.rs       # IssueFilter, builder\n└── types.rs        # IssueId, Priority, Status, IssueType\n```\n\n**Core Types**:\n```rust\n// Issue representation\npub struct Issue {\n    pub id: IssueId,\n    pub title: String,\n    pub description: String,\n    pub design: Option\u003cString\u003e,\n    pub acceptance_criteria: Option\u003cString\u003e,\n    pub notes: Option\u003cString\u003e,\n    pub status: Status,\n    pub priority: Priority,\n    pub issue_type: IssueType,\n    pub assignee: Option\u003cString\u003e,\n    pub created_at: DateTime\u003cUtc\u003e,\n    pub updated_at: DateTime\u003cUtc\u003e,\n    pub closed_at: Option\u003cDateTime\u003cUtc\u003e\u003e,\n    pub labels: Vec\u003cString\u003e,\n    pub dependencies: Vec\u003cDependency\u003e,\n}\n\npub struct NewIssue { /* builder fields */ }\npub struct IssueUpdate { /* optional fields */ }\n\n// Enums\npub enum Status { Open, InProgress, Blocked, Closed }\npub enum IssueType { Bug, Feature, Task, Epic, Chore }\npub enum DependencyType { Blocks, Related, ParentChild, DiscoveredFrom }\n\n// Filters\npub struct IssueFilter {\n    pub status: Option\u003cVec\u003cStatus\u003e\u003e,\n    pub priority: Option\u003cRangeInclusive\u003cu8\u003e\u003e,\n    pub assignee: Option\u003cString\u003e,\n    pub labels: Option\u003cVec\u003cString\u003e\u003e,\n    // ... all filter dimensions\n}\n\n// Newtypes for type safety\npub struct IssueId(String);\npub struct Priority(u8);  // 0-4\n```\n\n**Serde support**: All types derive Serialize/Deserialize for JSONL","acceptance_criteria":"- All core types defined\n- Serde derives for serialization\n- Builder patterns for NewIssue, IssueFilter\n- Validation logic (priority 0-4, ID format)\n- Type safety with newtypes\n- Unit tests for validation\n- Documentation with examples","notes":"Implement as src/domain/ module in rivets crate, NOT a separate rivets-core crate. This keeps the domain types co-located with the CLI application for now. Can be extracted to separate crate later if needed for library reuse.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-17T16:41:41.346359643-06:00","updated_at":"2025-11-17T19:25:08.707227678-06:00","closed_at":"2025-11-17T19:25:08.707227678-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-06w","depends_on_id":"rivets-0gc","type":"blocks","created_at":"2025-11-17T16:46:29.253520883-06:00","created_by":"daemon"}]}
{"id":"rivets-08u","content_hash":"047d53e190b5c637500a9ea4968226f9ade222b8f3b17c45bb26b7aa15f04143","title":"Implement map transformations for JsonlQuery","description":"Add map() method to JsonlQuery for transforming records during streaming.\n\nThis enables type transformations and projections on JSONL data.","design":"```rust\npub struct JsonlQuery\u003cT, U = T\u003e {\n    predicates: Vec\u003cBox\u003cdyn Fn(\u0026T) -\u003e bool + Send + Sync\u003e\u003e,\n    transform: Option\u003cBox\u003cdyn Fn(T) -\u003e U + Send + Sync\u003e\u003e,\n    _phantom: PhantomData\u003c(T, U)\u003e,\n}\n\nimpl\u003cT, U\u003e JsonlQuery\u003cT, U\u003e\nwhere\n    T: DeserializeOwned + 'static,\n    U: 'static,\n{\n    pub fn map\u003cV, F\u003e(self, transform: F) -\u003e JsonlQuery\u003cT, V\u003e\n    where\n        F: Fn(U) -\u003e V + Send + Sync + 'static,\n        V: 'static,\n    {\n        JsonlQuery {\n            predicates: self.predicates,\n            transform: Some(Box::new(move |t| transform(\n                self.transform.as_ref()\n                    .map(|f| f(t))\n                    .unwrap_or(t)\n            ))),\n            _phantom: PhantomData,\n        }\n    }\n}\n```\n\nNote: This requires refactoring JsonlQuery to support type transformations.","acceptance_criteria":"- map() method implemented\n- Supports type transformations\n- Can chain multiple map() calls\n- Transformations applied during streaming\n- Unit tests verify transformations\n- Integration test with filter + map pipeline","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T17:17:01.111641956-06:00","updated_at":"2025-11-27T17:17:01.111641956-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-08u","depends_on_id":"rivets-83j","type":"blocks","created_at":"2025-11-27T17:20:01.342007269-06:00","created_by":"dwalleck"}]}
{"id":"rivets-0dw","content_hash":"39aefe50467c67641c82cd00da78d19e3d4c85c9fe24fd21cef2000224cc8b4d","title":"Add debug logging to find_database() for observability","description":"The `find_database()` function has fallback logic but doesn't log which database was selected. This makes debugging harder when users have unexpected database files in `.rivets/`.","design":"Add `tracing::debug!` calls to show which path was taken:\n\n```rust\nfn find_database(rivets_dir: \u0026Path) -\u003e Result\u003cPathBuf\u003e {\n    let standard = rivets_dir.join(\"issues.jsonl\");\n    if standard.exists() {\n        tracing::debug!(\"Using standard database: {}\", standard.display());\n        return Ok(standard);\n    }\n\n    // ... search logic ...\n\n    match found.len() {\n        0 =\u003e {\n            tracing::debug!(\"No database found, using default: {}\", standard.display());\n            Ok(standard)\n        }\n        1 =\u003e {\n            let path = found.into_iter().next().expect(\"checked len\");\n            tracing::debug!(\"Using discovered database: {}\", path.display());\n            Ok(path)\n        }\n        _ =\u003e {\n            tracing::warn!(\"Multiple databases found: {:?}\", found);\n            Err(...)\n        }\n    }\n}\n```\n\n**Location:** `context.rs:276-314`","acceptance_criteria":"- [ ] Debug log when using standard `issues.jsonl` path\n- [ ] Debug log when using default path for new workspace\n- [ ] Debug log when using discovered non-standard database\n- [ ] Warn log before returning error for multiple databases","status":"open","priority":4,"issue_type":"chore","created_at":"2025-11-28T22:33:25.311491982-06:00","updated_at":"2025-11-28T22:33:25.311491982-06:00","source_repo":".","labels":["logging","observability"]}
{"id":"rivets-0gc","content_hash":"6bdd1fbf04700e68494941e86384a905165a248d71dab7ca0bb69a0283a6336e","title":"Design and implement storage trait abstraction","description":"Create the Storage trait abstraction that will allow multiple backend implementations (in-memory, JSONL, PostgreSQL). This is the foundation for the phased storage approach.\n\nPhase 1: Storage Trait + In-Memory Graph (MVP)\n- Define Storage trait with all required methods\n- In-memory implementation using HashMap + petgraph\n- JSONL persistence as backup/export format\n\nPhase 2: PostgreSQL with Recursive CTEs (Production)\n- PostgreSQL implementation with recursive CTEs for dependency queries\n- Migration path from in-memory to PostgreSQL\n\nThis task focuses on the trait definition and abstraction layer.\n\n## Clarifications\n\n### Session 2025-11-17\n\n- Q: Should the IssueStorage trait be async or synchronous? → A: Make trait async from start using async-trait crate (future-proof for PostgreSQL, enables non-blocking I/O)\n- Q: How should storage operations handle concurrent access in the in-memory backend? → A: Wrap in Arc\u003cMutex\u003cStorage\u003e\u003e for thread-safe access (standard pattern, simple for MVP)\n- Q: How should JSONL file corruption be handled during load? → A: Skip invalid lines with warning logs, continue loading valid entries (practical, allows recovery from partial corruption)\n- Q: Which tokio runtime should the CLI use? → A: Current-thread runtime (simpler for CLI, lower overhead, easier debugging)\n- Q: What should happen to dependencies when an issue is deleted? → A: Delete issue's dependencies, fail if issue has dependents with warning (safe, prevents orphaned references)","design":"## Storage Trait Design\n\n### Core Trait Definition\n\n**Async trait using async-trait crate:**\n\n```rust\nuse async_trait::async_trait;\n\n#[async_trait]\npub trait IssueStorage: Send + Sync {\n    // CRUD operations\n    async fn create(\u0026mut self, issue: NewIssue) -\u003e Result\u003cIssue\u003e;\n    async fn get(\u0026self, id: \u0026IssueId) -\u003e Result\u003cOption\u003cIssue\u003e\u003e;\n    async fn update(\u0026mut self, id: \u0026IssueId, updates: IssueUpdate) -\u003e Result\u003cIssue\u003e;\n    async fn delete(\u0026mut self, id: \u0026IssueId) -\u003e Result\u003c()\u003e;\n    \n    // Dependency management\n    async fn add_dependency(\u0026mut self, from: \u0026IssueId, to: \u0026IssueId, dep_type: DependencyType) -\u003e Result\u003c()\u003e;\n    async fn remove_dependency(\u0026mut self, from: \u0026IssueId, to: \u0026IssueId) -\u003e Result\u003c()\u003e;\n    async fn get_dependencies(\u0026self, id: \u0026IssueId) -\u003e Result\u003cVec\u003cDependency\u003e\u003e;\n    async fn get_dependents(\u0026self, id: \u0026IssueId) -\u003e Result\u003cVec\u003cDependency\u003e\u003e;\n    async fn has_cycle(\u0026self, from: \u0026IssueId, to: \u0026IssueId) -\u003e Result\u003cbool\u003e;\n    \n    // Queries\n    async fn list(\u0026self, filter: \u0026IssueFilter) -\u003e Result\u003cVec\u003cIssue\u003e\u003e;\n    async fn ready_to_work(\u0026self, filter: Option\u003c\u0026IssueFilter\u003e) -\u003e Result\u003cVec\u003cIssue\u003e\u003e;\n    async fn blocked_issues(\u0026self) -\u003e Result\u003cVec\u003c(Issue, Vec\u003cIssue\u003e)\u003e\u003e;\n    \n    // Batch operations for JSONL import/export\n    async fn import_issues(\u0026mut self, issues: Vec\u003cIssue\u003e) -\u003e Result\u003c()\u003e;\n    async fn export_all(\u0026self) -\u003e Result\u003cVec\u003cIssue\u003e\u003e;\n    \n    // Persistence (for backends that need explicit save)\n    async fn save(\u0026self) -\u003e Result\u003c()\u003e;\n}\n```\n\n**Note**: In-memory implementation will use blocking operations wrapped in `async` blocks for Phase 1. PostgreSQL will use true async I/O with sqlx in Phase 2. The save() method allows backends to persist state - InMemoryStorage saves to JSONL, PostgreSQL is a no-op.\n\n### Async Runtime Configuration\n\n**Use current-thread tokio runtime for CLI:**\n\n```rust\n// main.rs\n#[tokio::main(flavor = \"current_thread\")]\nasync fn main() -\u003e Result\u003c()\u003e {\n    // CLI initialization and execution\n    let cli = Cli::parse();\n    let config = Config::load().await?;\n    let storage = create_storage(config.storage_backend).await?;\n    \n    cli.execute(storage).await\n}\n```\n\n**Rationale**:\n- Simpler runtime for sequential CLI operations\n- Lower memory and CPU overhead\n- Easier to debug with single-threaded execution\n- Sufficient for I/O-bound storage operations\n- Can upgrade to multi-threaded if parallelism becomes necessary\n\n### Concurrency Model\n\n**Thread-safe wrapper for in-memory storage:**\n\n```rust\n// Storage implementation (not thread-safe)\nstruct InMemoryStorageInner {\n    issues: HashMap\u003cIssueId, Issue\u003e,\n    graph: DiGraph\u003cIssueId, DependencyType\u003e,\n    node_map: HashMap\u003cIssueId, NodeIndex\u003e,\n}\n\n// Thread-safe wrapper\npub type InMemoryStorage = Arc\u003cMutex\u003cInMemoryStorageInner\u003e\u003e;\n\n// CLI usage\npub struct App {\n    storage: Box\u003cdyn IssueStorage\u003e,  // Already thread-safe via Arc\u003cMutex\u003c\u003e\u003e\n    config: Config,\n}\n```\n\n**Rationale**: \n- Simple standard pattern for Rust CLI applications\n- Prevents data races with minimal complexity\n- Easy to test and reason about\n- PostgreSQL backend will handle concurrency at database level\n\n### Delete Semantics \u0026 Referential Integrity\n\n**Safe deletion with dependent check:**\n\n```rust\nasync fn delete(\u0026mut self, id: \u0026IssueId) -\u003e Result\u003c()\u003e {\n    // Check for dependents\n    let dependents = self.get_dependents(id).await?;\n    if !dependents.is_empty() {\n        let dependent_ids: Vec\u003c_\u003e = dependents.iter()\n            .map(|d| d.issue_id.to_string())\n            .collect();\n        return Err(Error::HasDependents {\n            issue_id: id.clone(),\n            dependents: dependent_ids,\n            message: format!(\n                \"Cannot delete {}: {} other issues depend on it. Delete or update those issues first.\",\n                id, dependents.len()\n            )\n        });\n    }\n    \n    // Remove all outgoing dependencies from this issue\n    let dependencies = self.get_dependencies(id).await?;\n    for dep in dependencies {\n        self.remove_dependency(id, \u0026dep.depends_on_id).await?;\n    }\n    \n    // Remove issue from storage\n    self.issues.remove(id);\n    if let Some(node_idx) = self.node_map.remove(id) {\n        self.graph.remove_node(node_idx);\n    }\n    \n    Ok(())\n}\n```\n\n**Strategy**: \n- Fail with clear error if issue has dependents\n- Error message lists dependent issue IDs\n- Remove all outgoing dependencies automatically\n- Prevents orphaned dependency references\n- User can use `--force` flag to batch delete dependents first (future enhancement)\n\n### Error Handling \u0026 Recovery\n\n**JSONL Corruption Handling:**\n\n```rust\npub async fn load_from_jsonl(path: \u0026Path) -\u003e Result\u003c(Self, Vec\u003cLoadError\u003e)\u003e {\n    let file = BufReader::new(File::open(path).await?);\n    let mut storage = Self::new();\n    let mut errors = Vec::new();\n    \n    for (line_num, line) in file.lines().enumerate() {\n        match line {\n            Ok(content) =\u003e {\n                match serde_json::from_str::\u003cIssue\u003e(\u0026content) {\n                    Ok(issue) =\u003e {\n                        if let Err(e) = storage.import_issue(issue).await {\n                            errors.push(LoadError::ImportFailed { line: line_num, reason: e });\n                            log::warn!(\"Line {}: Failed to import issue: {}\", line_num, e);\n                        }\n                    }\n                    Err(e) =\u003e {\n                        errors.push(LoadError::InvalidJson { line: line_num, reason: e });\n                        log::warn!(\"Line {}: Invalid JSON, skipping: {}\", line_num, e);\n                    }\n                }\n            }\n            Err(e) =\u003e {\n                errors.push(LoadError::ReadError { line: line_num, reason: e });\n                log::warn!(\"Line {}: Read error, skipping: {}\", line_num, e);\n            }\n        }\n    }\n    \n    if !errors.is_empty() {\n        log::warn!(\"Loaded with {} errors/warnings. {} issues imported.\", \n                   errors.len(), storage.issue_count());\n    }\n    \n    Ok((storage, errors))\n}\n```\n\n**Strategy**: Skip corrupted lines, log warnings, continue loading. Returns both the loaded storage and collection of errors for caller to handle.\n\n### Backend Factory\n\n```rust\npub enum StorageBackend {\n    InMemory,\n    Jsonl(PathBuf),\n    PostgreSQL(String), // connection string\n}\n\npub async fn create_storage(backend: StorageBackend) -\u003e Result\u003cBox\u003cdyn IssueStorage\u003e\u003e {\n    match backend {\n        StorageBackend::InMemory =\u003e Ok(Box::new(InMemoryStorage::new())),\n        StorageBackend::Jsonl(path) =\u003e {\n            let (storage, errors) = InMemoryStorage::load_from_jsonl(\u0026path).await?;\n            if !errors.is_empty() {\n                eprintln!(\"Warning: Loaded with {} errors. Check logs.\", errors.len());\n            }\n            Ok(Box::new(storage))\n        }\n        StorageBackend::PostgreSQL(conn_str) =\u003e {\n            Ok(Box::new(PostgresStorage::new(\u0026conn_str).await?))\n        }\n    }\n}\n```\n\n### Architecture Benefits\n\n1. **Testability**: Use in-memory storage for fast unit tests\n2. **Flexibility**: Easy to add new backends (SQLite, cloud storage, etc.)\n3. **Performance**: Can optimize each backend independently\n4. **Migration**: Clear path from simple to complex storage\n5. **Future-proof**: Async trait enables efficient PostgreSQL and network I/O\n6. **Thread-safety**: Arc\u003cMutex\u003c\u003e\u003e wrapper prevents data races\n7. **Resilience**: Graceful degradation on partial JSONL corruption\n8. **Simplicity**: Current-thread runtime reduces complexity for CLI use case\n9. **Data integrity**: Safe deletion prevents orphaned dependency references\n10. **Explicit persistence**: save() method allows control over when data is persisted","acceptance_criteria":"- Storage trait defined with async methods using async-trait in src/storage/mod.rs\n- Backend factory pattern implemented for creating storage instances (async)\n- Trait includes save() method for explicit persistence (async fn save(\u0026self) -\u003e Result\u003c()\u003e)\n- Trait documentation includes usage examples and backend comparison\n- All trait methods have clear error semantics\n- Trait is object-safe (can use Box\u003cdyn IssueStorage\u003e)\n- Unit tests for trait object usage with tokio test runtime\n- Documentation examples compile and run\n- async-trait dependency added to Cargo.toml\n- tokio dependency with current_thread flavor configured in main.rs\n- JSONL load handles corruption gracefully (skip invalid lines, log warnings)\n- Load function returns both storage and error collection\n- Delete operation checks for dependents, fails with clear error message if found\n- Delete operation removes all outgoing dependencies automatically\n- Error type includes HasDependents variant with issue list","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T16:15:21.281073361-06:00","updated_at":"2025-11-17T18:26:22.170944324-06:00","closed_at":"2025-11-17T18:26:22.170944324-06:00","source_repo":"."}
{"id":"rivets-0ib","content_hash":"7607d1db6c940d35bb4b3a9f9a1f2cfeef0a1c27f983a6d95a6b10d1897947db","title":"Implement TUI list and detail views","description":"Create list and detail views for TUI:\n\nList view:\n- Sortable/filterable issue list\n- Compact single-line display\n- Keyboard navigation (j/k or arrows)\n\nDetail view:\n- Full issue details in side panel\n- Dependencies and dependents\n- Edit capabilities","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:37:18.308663319-06:00","updated_at":"2025-11-30T12:37:18.308663319-06:00","source_repo":".","labels":["phase-3","tui"],"dependencies":[{"issue_id":"rivets-0ib","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:37:18.339062566-06:00","created_by":"dwalleck"}]}
{"id":"rivets-0jv","content_hash":"3c570abf693adf6f5f20e151fbffb612c5fd58bc8883f16f5f6fe37d3e272767","title":"Consider path canonicalization in find_rivets_root for symlink support","description":"The find_rivets_root function traverses parent directories to find a .rivets directory. If the start path contains symlinks, this might behave unexpectedly since it operates on the logical path rather than the resolved physical path.","design":"Current implementation:\\n```rust\\nlet mut current = start_dir.to_path_buf();\\n```\\n\\nPotential enhancement:\\n```rust\\nlet mut current = start_dir.canonicalize().ok()?.to_path_buf();\\n```\\n\\nTrade-offs:\\n- Pro: Correctly handles symlinked directories\\n- Con: canonicalize() fails if path doesn't exist\\n- Con: Adds complexity for edge case\\n\\nOptions:\\n1. Try canonicalize, fall back to original path on failure\\n2. Document current behavior as intentional\\n3. Add optional `follow_symlinks` parameter\\n\\nCurrent implementation is reasonable for most use cases. This is a low-priority enhancement for symlink-heavy workflows.","status":"open","priority":4,"issue_type":"task","created_at":"2025-11-29T20:54:20.690844991-06:00","updated_at":"2025-11-29T20:54:20.690844991-06:00","source_repo":".","labels":["enhancement","filesystem"]}
{"id":"rivets-0vd","content_hash":"ba9ca91a2f7ba4183eee4ecd271332ee4d76cba917136e708af9e59ae7e98bf1","title":"Implement dep tree visualization","description":"Add 'dep tree' subcommand to display dependency tree for an issue.\\n\\nShould show both upstream dependencies (what this issue depends on) and downstream dependents (what depends on this issue) in a tree format.\\n\\nExample: rivets dep tree proj-abc","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T18:24:02.683285758-06:00","updated_at":"2025-12-27T18:50:58.475771946-06:00","closed_at":"2025-12-27T18:50:58.475771946-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-0vd","depends_on_id":"rivets-v3s","type":"parent-child","created_at":"2025-12-27T18:24:02.685561795-06:00","created_by":"dwalleck"}]}
{"id":"rivets-1dza","content_hash":"227261f251ff6b2c7aac922f1f15e059fa4e85b4df3a06cc58662c4882b4fc63","title":"Integrate LSP into callers --lsp","description":"When `--lsp` flag is set for callers query:\n\n1. Return stored references (from DB)\n2. Additionally, ask LSP find_references for the symbol\n3. Merge results, deduplicate\n\nThis catches callers that tree-sitter couldn't resolve during indexing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T11:29:02.890552913-06:00","updated_at":"2026-01-28T19:34:56.77546592-06:00","closed_at":"2026-01-28T19:34:56.77546592-06:00","source_repo":".","labels":["lsp","phase2","tethys"],"dependencies":[{"issue_id":"rivets-1dza","depends_on_id":"rivets-k3mv","type":"blocks","created_at":"2026-01-28T11:30:51.854123195-06:00","created_by":"dwalleck"},{"issue_id":"rivets-1dza","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:42.983228824-06:00","created_by":"dwalleck"}]}
{"id":"rivets-1p0f","content_hash":"fb6acaf2fc0326da922d82bccc54267bbc61e7ef742f2ebf77178e946c921846","title":"Store unresolved references with symbol_id = NULL","description":"Currently we skip references we can't resolve. Instead, store them with `symbol_id = NULL` and enough context to resolve later.\n\nThis requires allowing nullable symbol_id in the refs table and updating `store_references()` to handle unresolved refs.","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:27:33.176960624-06:00","updated_at":"2026-01-28T11:44:36.816956542-06:00","closed_at":"2026-01-28T11:44:36.816956542-06:00","source_repo":".","labels":["phase1","tethys"],"dependencies":[{"issue_id":"rivets-1p0f","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:31:39.142501319-06:00","created_by":"dwalleck"}]}
{"id":"rivets-1qp","content_hash":"ede58bc4747d641570826ec59ba979b0d2538fbb74d22eb0f9e2b6e8284493e7","title":"Evaluate rstest for rivets-jsonl/src/lib.rs inline tests","description":"Evaluate and apply rstest improvements to inline unit tests in lib.rs.\n\nFile: crates/rivets-jsonl/src/lib.rs (lines ~319+)","acceptance_criteria":"- Inline tests evaluated for rstest opportunities\n- Parameterization applied where beneficial\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:19:13.789405062-06:00","updated_at":"2025-11-28T19:27:19.14640416-06:00","closed_at":"2025-11-28T19:27:19.14640416-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-1qp","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T19:20:06.301044574-06:00","created_by":"dwalleck"}]}
{"id":"rivets-1u7n","content_hash":"9937bf3deac3af999857dcef8ab4a533b36d740209aa50b43a76d67a96f7800f","title":"Enforce parent-child dependency type is epic-to-task","description":"Help text says parent-child dependency is \"Hierarchical - epic to task\" but we don't actually enforce this. Either enforce the constraint or update the help text.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-11T16:47:15.926596806-06:00","updated_at":"2026-01-11T16:47:15.926596806-06:00","source_repo":".","labels":["cli","ux"]}
{"id":"rivets-1wa","content_hash":"be37a4870a88b575911b8252fa4ca250ececc383d68111dbc1117a7c4fbb17ac","title":"Implement query tools (ready, list, show, blocked)","description":"Implement issue query tools:\n- ready(limit, priority, assignee) - Find unblocked tasks via ready_to_work()\n- list(status, priority, type, assignee, limit) - List with filters\n- show(issue_id) - Full issue details with dependencies\n- blocked() - Get blocked issues with their blockers","acceptance_criteria":"- [ ] ready tool returns unblocked issues\n- [ ] list tool supports all filter parameters\n- [ ] show tool returns full issue with dependencies\n- [ ] blocked tool returns blocked issues with blockers\n- [ ] Unit tests: each tool with MockStorage (happy path + edge cases)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:16:22.628369922-06:00","updated_at":"2025-11-29T19:19:17.301204975-06:00","closed_at":"2025-11-29T19:19:17.301204975-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-1wa","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:17:40.080018812-06:00","created_by":"dwalleck"},{"issue_id":"rivets-1wa","depends_on_id":"rivets-6u6","type":"blocks","created_at":"2025-11-28T19:18:41.398482827-06:00","created_by":"dwalleck"},{"issue_id":"rivets-1wa","depends_on_id":"rivets-vdi","type":"blocks","created_at":"2025-11-29T17:36:59.340099999-06:00","created_by":"dwalleck"}]}
{"id":"rivets-1wn","content_hash":"2c1b68c58399007c81f912e4d3b5f8cd93c26ecd0e0a0039f3c10cf39c619de1","title":"Extract shared filter logic from list() and ready_to_work()","description":"The filter logic in list() and ready_to_work() is nearly identical. Extract to a shared function to reduce duplication and improve maintainability.","design":"Current duplication in `crates/rivets/src/storage/in_memory/trait_impl.rs`:\n- `list()`: lines 336-378\n- `ready_to_work()`: lines 411-448\n\nProposed refactoring:\n\n```rust\n/// Apply filter criteria to an issue, returning true if it matches.\nfn apply_filter(issue: \u0026Issue, filter: \u0026IssueFilter) -\u003e bool {\n    if let Some(status) = \u0026filter.status {\n        if \u0026issue.status != status { return false; }\n    }\n    if let Some(priority) = filter.priority {\n        if issue.priority != priority { return false; }\n    }\n    if let Some(issue_type) = \u0026filter.issue_type {\n        if \u0026issue.issue_type != issue_type { return false; }\n    }\n    if let Some(assignee) = \u0026filter.assignee {\n        if issue.assignee.as_ref() != Some(assignee) { return false; }\n    }\n    if let Some(label) = \u0026filter.label {\n        if !issue.labels.contains(label) { return false; }\n    }\n    true\n}\n```\n\nUsage:\n```rust\nissues.retain(|issue| apply_filter(issue, filter));\nif let Some(limit) = filter.limit {\n    issues.truncate(limit);\n}\n```\n\nThis is low priority since the current code works correctly - just a maintainability improvement.","acceptance_criteria":"- [ ] Extract shared filter predicate function\n- [ ] Update list() to use shared function\n- [ ] Update ready_to_work() to use shared function\n- [ ] All existing tests pass\n- [ ] No change in observable behavior","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-29T19:09:16.681348623-06:00","updated_at":"2025-11-29T19:09:16.681348623-06:00","source_repo":".","labels":["refactoring","storage"]}
{"id":"rivets-1xh","content_hash":"f3c37d016b6d7c2a147050565f9ef1402fa9e2bd31dc0fe7e99aa04e061c7f0e","title":"Add Unicode status icons with color support","description":"Enhance status icons with Unicode characters and colors:\n- [ ] Open (blue)\n- [\u003e] In Progress (yellow)\n- [→] Ready (green) - new icon for ready-to-work\n- [X] Blocked (red)\n- [✓] Closed (gray)\n\nSupport fallback to ASCII for terminals without Unicode support.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-30T12:34:46.957517194-06:00","updated_at":"2025-11-30T12:34:46.957517194-06:00","source_repo":".","labels":["phase-1a","ux"],"dependencies":[{"issue_id":"rivets-1xh","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:34:46.959485325-06:00","created_by":"dwalleck"}]}
{"id":"rivets-1yi","content_hash":"0ca08fc5e94d576bce1251cdd5f74916120b603d8bf9d088acede5f038b3dc90","title":"Refactor ready filter tests to use rstest with struct-based test cases","description":"Replace individual ready filter tests with a single rstest parameterized test using a ReadyFilterCase struct.\n\nCurrent tests to consolidate:\n- test_ready_with_priority_filter\n- test_ready_with_assignee_filter\n- test_ready_with_limit\n- test_ready_excludes_blocked\n\nNew structure:\n```rust\nstruct ReadyFilterCase {\n    name: \u0026'static str,\n    limit: Option\u003cusize\u003e,\n    priority: Option\u003cu8\u003e,\n    issue_type: Option\u003c\u0026'static str\u003e,\n    assignee: Option\u003c\u0026'static str\u003e,\n    label: Option\u003c\u0026'static str\u003e,\n    expected_count: usize,\n}\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T17:57:45.611773476-06:00","updated_at":"2025-11-29T18:03:33.242895114-06:00","closed_at":"2025-11-29T18:03:33.242895114-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-1yi","depends_on_id":"rivets-jfs","type":"blocks","created_at":"2025-11-29T17:58:14.12611116-06:00","created_by":"dwalleck"}]}
{"id":"rivets-1zz","content_hash":"2f6acb92c03d3c83eaa8fe60c69a3d3d5248e68a618c372935e2c4ef86236f64","title":"Add conflict logging for Automerge merges","description":"Even though CRDTs auto-resolve conflicts, users should be aware when merges happen.\n\nImplement:\n- Log when merge() is called and changes are integrated\n- Track which fields had concurrent modifications\n- Optional: Store merge events in a separate log file or document metadata\n- Surface merge history in `rv log` or similar command","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:49:37.30797917-06:00","updated_at":"2025-12-22T22:45:28.797678904-06:00","closed_at":"2025-12-22T22:45:28.797678904-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-1zz","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T15:49:37.310386303-06:00","created_by":"dwalleck"}]}
{"id":"rivets-241","content_hash":"83a4c23a4f04829a75974d9312aaef9dae672e60286b34170b745412510d8a81","title":"Add validator edge case tests","description":"Add comprehensive edge case tests to validators.rs for:\n- Multiple hyphens in issue IDs (proj-abc-123-def)\n- Unicode characters and emojis in titles\n- Max length boundary conditions\n- Empty and whitespace-only inputs","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T22:11:13.839324597-06:00","updated_at":"2025-11-29T22:11:13.839324597-06:00","source_repo":".","labels":["pr-feedback","testing"]}
{"id":"rivets-2c5","content_hash":"9bb449e6b0a32853f7086bb6e8485779edced0ef9c228987f4b29bd8a4993212","title":"Optimize ready_to_work filter pre-application in find_blocked_issues","description":"Investigate potential optimization to apply IssueFilter early in find_blocked_issues() to reduce the number of issues checked for blocking status.\n\nCurrently, find_blocked_issues checks ALL non-closed issues in Phase 1, then ready_to_work applies the user filter afterward. For selective filters, this does unnecessary work.","design":"**Current Flow:**\n1. `find_blocked_issues` checks all non-closed issues\n2. `ready_to_work` filters out blocked issues\n3. User filter applied last\n\n**Proposed Optimization:**\nPass filter hint to `find_blocked_issues` to skip checking issues that won't be in final result.\n\n**Correctness Constraint:**\nCannot skip issues that might be transitive blockers via ParentChild. If Parent A (priority=1) is blocked, Child C (priority=2) must also be marked blocked even if filter.priority=2 would skip A.\n\n**Safe Optimization Approaches:**\n1. Only apply filter in Phase 1 for \"leaf-only\" filters (labels, assignee) that don't affect blocking propagation\n2. Lazy per-issue blocking check - trade BFS O(n+e) for O(filtered × edges), better only for very selective filters\n3. Two-pass: first find all potentially blocking parents, then filter\n\n**When to Implement:**\nProfile ready_to_work with large datasets (10k+ issues) to determine if optimization is worthwhile.","acceptance_criteria":"- [ ] Profile ready_to_work performance with 10k+ issues\n- [ ] Determine if optimization provides measurable benefit\n- [ ] If implementing, ensure correctness with parent-child transitive blocking\n- [ ] Add benchmark tests for ready_to_work with various filter selectivity levels","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-28T15:22:06.362877015-06:00","updated_at":"2025-11-28T15:22:06.362877015-06:00","source_repo":".","labels":["optimization","performance"]}
{"id":"rivets-2pn","content_hash":"682d08dcf1f3dcf77528810894299b0bf5cc4429e3151b125213f92fa2481695","title":"Add integration tests for invalid filter values and error paths","description":"Add integration tests that exercise error handling when invalid values are passed to MCP tool filters. The validation logic exists but isn't covered by integration tests.","design":"Add error path tests to `crates/rivets-mcp/tests/integration.rs`:\n\n```rust\n// ============================================================================\n// Error Path Tests - Invalid Filter Values\n// ============================================================================\n\n#[tokio::test]\nasync fn test_list_invalid_status_returns_error() {\n    let workspace = create_temp_workspace();\n    let tools = create_tools();\n    set_context(\u0026tools, workspace.path()).await;\n\n    let result = tools\n        .list(Some(\"invalid_status\"), None, None, None, None, None, None)\n        .await;\n\n    assert!(result.is_err());\n    let err = result.unwrap_err();\n    assert!(matches!(err, Error::InvalidArgument { field: \"status\", .. }));\n    assert!(err.to_string().contains(\"invalid_status\"));\n    assert!(err.to_string().contains(\"open, in_progress, blocked, closed\"));\n}\n\n#[tokio::test]\nasync fn test_list_invalid_issue_type_returns_error() { ... }\n\n#[tokio::test]\nasync fn test_ready_invalid_issue_type_returns_error() { ... }\n\n#[tokio::test]\nasync fn test_create_invalid_issue_type_returns_error() { ... }\n\n#[tokio::test]\nasync fn test_update_invalid_status_returns_error() { ... }\n\n#[tokio::test]\nasync fn test_dep_invalid_dep_type_returns_error() { ... }\n```\n\nValidation logic locations:\n- `tools.rs:32-38` - validate_status()\n- `tools.rs:40-47` - validate_issue_type()\n- `tools.rs:49-56` - validate_dep_type()","acceptance_criteria":"- [ ] Test invalid status values (e.g., \"invalid\", \"pending\", \"done\")\n- [ ] Test invalid issue_type values (e.g., \"invalid\", \"story\", \"spike\")\n- [ ] Test invalid dep_type values (e.g., \"invalid\", \"requires\", \"depends\")\n- [ ] Test invalid priority values (e.g., 5, 10, 255)\n- [ ] Verify appropriate error types are returned (InvalidArgument)\n- [ ] Verify error messages include the invalid value and valid options","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-29T19:13:42.028936963-06:00","updated_at":"2025-11-30T12:09:28.465454953-06:00","closed_at":"2025-11-30T12:09:28.465454953-06:00","source_repo":".","labels":["mcp","testing"]}
{"id":"rivets-2ub","content_hash":"85923e53d493088d406a3ba9ce07178985acee8c9e0dd1299c6d05bab6414376","title":"Implement Cargo workspace structure with directory layout","description":"Create the physical workspace structure including workspace Cargo.toml, crates/ directory, and initial Cargo.toml files for both rivets-jsonl and rivets crates. Set up the directory tree according to the design from rivets-kr3.","design":"Follow the design from rivets-kr3:\n- Create workspace root Cargo.toml with resolver=3 and workspace configuration\n- Create crates/ directory\n- Create crates/rivets-jsonl/ with Cargo.toml, src/, tests/, benches/, examples/ directories\n- Create crates/rivets/ with Cargo.toml, src/, tests/ directories\n- Create docs/ directory\n- Set up workspace dependencies in root Cargo.toml\n- Configure individual crate Cargo.toml files with workspace inheritance\n- Add README.md files for each crate","acceptance_criteria":"- Workspace Cargo.toml exists with correct resolver and members\n- crates/rivets-jsonl/Cargo.toml configured with workspace inheritance\n- crates/rivets/Cargo.toml configured with workspace inheritance and binary target\n- All required directories created\n- Project builds successfully with `cargo build`\n- README.md files created for workspace root and both crates","status":"closed","priority":1,"issue_type":"task","assignee":"Claude","created_at":"2025-11-17T15:45:32.798758607-06:00","updated_at":"2025-11-17T15:51:12.910655343-06:00","closed_at":"2025-11-17T15:51:12.910655343-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-2ub","depends_on_id":"rivets-kr3","type":"blocks","created_at":"2025-11-17T15:45:32.800932514-06:00","created_by":"daemon"}]}
{"id":"rivets-2uv","content_hash":"1146d5218ae80af57f6c395da1c09778c204a97cc4e9335ce8bcf11e2b2e84b5","title":"Evaluate rstest for rivets-jsonl/src/warning.rs and atomic.rs inline tests","description":"Evaluate and apply rstest improvements to inline unit tests in warning.rs and atomic.rs.\n\nFiles:\n- crates/rivets-jsonl/src/warning.rs (lines ~392+)\n- crates/rivets-jsonl/src/atomic.rs (lines ~209+)","acceptance_criteria":"- Inline tests evaluated for rstest opportunities\n- Parameterization applied where beneficial\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:19:19.45380685-06:00","updated_at":"2025-11-28T19:28:55.618500868-06:00","closed_at":"2025-11-28T19:28:55.618500868-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-2uv","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T19:20:11.92503113-06:00","created_by":"dwalleck"}]}
{"id":"rivets-2wp","content_hash":"087b62a09244d0bcf514dd0c0a52efc60180dc26deecb1c389335b11c2d15e08","title":"Create architecture document and diagrams for rivets","description":"Based on research from JSONL library design and project structure planning, create comprehensive architecture documentation with diagrams showing component relationships, data flow, and system design.","design":"Create comprehensive documentation covering:\n\n**1. High-Level System Architecture**:\n- System architecture diagram showing all components/crates\n- Component interaction diagrams (crate dependency graph)\n- Key design decisions and rationale\n- Technology choices (libraries, patterns, etc.)\n- Future extensibility considerations\n\n**2. Data Flow**:\n- JSONL data flow through system (CLI → RPC → Storage → JSONL)\n- How JSONL operations work across components\n- Module organization within each crate\n\n**3. Storage Layer**:\n- Database schema diagram\n- Table relationships\n- Index strategy\n- Migration system\n\n**4. ID Generation System**:\n- Hash algorithm explanation\n- Collision handling strategy\n- Hierarchical ID format\n\n**5. Dependency System**:\n- 4 dependency types explained\n- Cycle detection algorithm\n- Ready work calculation logic\n\n**6. JSONL Sync**:\n- Export flow diagram\n- Import flow diagram\n- Conflict resolution strategy\n\n**7. RPC Protocol**:\n- Message format specification\n- Operation list\n- Error handling approach\n\nUse mermaid diagrams for visual clarity throughout. Format as ADR or similar structured format.","acceptance_criteria":"- Architecture document created at docs/architecture.md\n- System architecture diagram showing all crates and components\n- Crate dependency graph with clear separation of concerns\n- Data flow diagram showing JSONL operations (CLI → RPC → Storage → JSONL)\n- Database schema diagram with table relationships\n- ID generation algorithm documented with collision handling\n- Dependency system explained (4 types, cycle detection, ready work)\n- JSONL sync flows documented (export/import with conflict resolution)\n- RPC protocol specification (message format, operations, errors)\n- All diagrams in mermaid format (maintainable and version-controllable)\n- Design decisions justified with rationale\n- Future extensibility considerations noted\n- Document integrates findings from rivets-fk9 and rivets-kr3 research","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-17T15:08:45.698527855-06:00","updated_at":"2025-11-27T18:44:22.287918117-06:00","closed_at":"2025-11-27T18:44:22.287918117-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-2wp","depends_on_id":"rivets-fk9","type":"blocks","created_at":"2025-11-17T15:08:54.237721515-06:00","created_by":"daemon"},{"issue_id":"rivets-2wp","depends_on_id":"rivets-kr3","type":"blocks","created_at":"2025-11-17T15:08:55.20642145-06:00","created_by":"daemon"}]}
{"id":"rivets-34i","content_hash":"666c6587483161506abeef06ee9cdc637da8a7ab3b7ec8a46fe70a5c04efd1fc","title":"Add missing filter parameters to MCP list and ready tools","description":"The MCP tools don't expose all filter options that the storage layer supports.\n\n**Missing filters:**\n- `list()`: Missing `label` filter\n- `ready()`: Missing `label` and `issue_type` filters\n\nThe storage layer (`IssueFilter`) supports all these fields and applies them correctly. The MCP tools just need to accept and pass these additional parameters.","design":"**list() changes:**\nAdd `label: Option\u003cString\u003e` parameter and include in IssueFilter construction.\n\n**ready() changes:**\nAdd `label: Option\u003cString\u003e` and `issue_type: Option\u003c\u0026str\u003e` parameters.\nValidate issue_type like list() does before passing to storage.\n\n**Server changes:**\nUpdate `ListParams` and `ReadyParams` structs in models.rs to include new fields.\nUpdate server.rs tool handlers to pass new parameters.","acceptance_criteria":"- [ ] list() accepts label parameter\n- [ ] ready() accepts label and issue_type parameters\n- [ ] MCP tool schemas updated with new parameters\n- [ ] Integration tests for new filter combinations","notes":"Progress: Core implementation complete (models, tools, server updated). Integration tests need fixing and refactoring to rstest. See child tasks: rivets-jfs, rivets-wfb, rivets-1yi, rivets-vvp","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-11-29T17:45:00.665218723-06:00","updated_at":"2025-11-29T18:03:50.414931004-06:00","closed_at":"2025-11-29T18:03:50.414931004-06:00","source_repo":"."}
{"id":"rivets-37y","content_hash":"876c7b051d0b74e53124881cd189062a199fb33ee25322e5499fb29ba811e902","title":"Implement labels and comments system","description":"Implement label tagging and commenting functionality for issues, with many-to-many relationships and filtering support.","design":"Based on beads labels.go and comments functionality:\n\n**Labels**:\n- Many-to-many relationship (issues ↔ labels)\n- Operations: add, remove, list labels on issue\n- Query by labels (AND / OR semantics)\n- Label management (create, delete, rename)\n\n**Comments**:\n- One-to-many (issue → comments)\n- Fields: author, created_at, content\n- Operations: add comment, list comments\n- Threaded comments (optional future)\n\n**Schema**:\n```sql\nlabels (\n  id INTEGER PRIMARY KEY,\n  issue_id TEXT NOT NULL,\n  label TEXT NOT NULL,\n  UNIQUE(issue_id, label)\n)\n\ncomments (\n  id INTEGER PRIMARY KEY,\n  issue_id TEXT NOT NULL,\n  author TEXT,\n  created_at TIMESTAMP,\n  content TEXT NOT NULL\n)\n```\n\n**CLI Commands**:\n- `rivets label add \u003cissue\u003e \u003clabel...\u003e`\n- `rivets label remove \u003cissue\u003e \u003clabel...\u003e`\n- `rivets comment add \u003cissue\u003e \u003ctext\u003e`\n- `rivets comment list \u003cissue\u003e`","acceptance_criteria":"- Label add/remove operations work\n- Comment add/list operations work\n- Query issues by labels (--label, --labels-any)\n- Labels embedded in JSONL export\n- Comments embedded in JSONL export\n- Foreign key CASCADE on issue deletion\n- Unit tests for label/comment CRUD","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-17T16:16:47.355222934-06:00","updated_at":"2025-11-17T16:16:47.355222934-06:00","source_repo":"."}
{"id":"rivets-3af","content_hash":"bfeadec34215cc28acf6b39ce2aab8b555458fa84b01a2bbcf957e8d54b78296","title":"Extract sorting logic into reusable functions","description":"Consider extracting sorting logic from execute.rs into reusable functions.\n\nCurrently:\n- `execute.rs:140-156`: List command has inline sorting logic for `SortOrderArg`\n- Ready command uses `SortPolicy` with different sorting semantics\n\nThe list command sorting is clear and correct, but if sorting needs to be reused elsewhere, extracting it into a dedicated module or helper functions would improve maintainability.\n\nPotential approach:\n- Create a `sorting` module with functions for different sort strategies\n- Unify `SortOrderArg` and `SortPolicy` if they share common patterns\n- Keep domain-specific sorting in the storage layer where appropriate","status":"open","priority":4,"issue_type":"chore","created_at":"2025-11-30T11:44:03.996137048-06:00","updated_at":"2025-11-30T11:44:03.996137048-06:00","source_repo":".","labels":["code-quality","pr-feedback"]}
{"id":"rivets-3hs","content_hash":"a0d9e81bc9690327b3e4fc97bce97d1ebc722666906186cf3ab91dfc4251829b","title":"Add indicatif dependency for progress indicators","description":"Add indicatif crate to workspace dependencies for progress bars and spinners.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-30T12:35:19.476455174-06:00","updated_at":"2025-11-30T12:35:19.476455174-06:00","source_repo":".","labels":["phase-1b","ux"],"dependencies":[{"issue_id":"rivets-3hs","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:35:19.479146117-06:00","created_by":"dwalleck"}]}
{"id":"rivets-3nx","content_hash":"cba77f6a9e54a5b6bd61b0e95b48948e1578e6dc5bd79582c3ca6c1577b70e43","title":"Implement undo/redo system","description":"Add transaction history for undo/redo:\n\n- Store operation log in `.rivets/history.jsonl`\n- Each entry: `{timestamp, operation, before_state, after_state}`\n- Keep last 50 operations\n\nCommands:\n- `rivets undo` - Revert last mutation\n- `rivets history` - Show recent operations\n\nNote: Lower priority since git provides a safety net.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-11-30T12:38:07.706908268-06:00","updated_at":"2025-11-30T12:38:07.706908268-06:00","source_repo":".","labels":["phase-4","ux"],"dependencies":[{"issue_id":"rivets-3nx","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:38:07.709210788-06:00","created_by":"dwalleck"}]}
{"id":"rivets-3q4","content_hash":"6d50545e1a772082d43bd17822902f685141e83058f55d00196fa906ae41c294","title":"Add throughput benchmarks","description":"Create throughput benchmarks to verify \"100MB file in \u003c1s\" read and write targets.\n\nMeasures actual I/O performance with realistic data.","design":"Create benches/throughput_benchmarks.rs:\n\n```rust\nuse criterion::{criterion_group, criterion_main, Criterion, Throughput};\n\nfn throughput_benchmarks(c: \u0026mut Criterion) {\n    let mut group = c.benchmark_group(\"throughput\");\n    \n    // Read benchmarks\n    group.throughput(Throughput::Bytes(100 * 1024 * 1024)); // 100MB\n    group.bench_function(\"read_100mb\", |b| {\n        b.iter(|| {\n            // Stream read 100MB JSONL file\n        });\n    });\n    \n    // Write benchmarks\n    group.throughput(Throughput::Bytes(100 * 1024 * 1024));\n    group.bench_function(\"write_100mb\", |b| {\n        b.iter(|| {\n            // Write 100MB JSONL file\n        });\n    });\n    \n    // Atomic write benchmarks\n    group.throughput(Throughput::Bytes(100 * 1024 * 1024));\n    group.bench_function(\"write_100mb_atomic\", |b| {\n        b.iter(|| {\n            // Atomic write 100MB\n        });\n    });\n}\n```\n\nTargets from research:\n- Read: 100MB in \u003c1s (\u003e100MB/s)\n- Write: 100MB in \u003c1.5s (\u003e66MB/s)","acceptance_criteria":"- Throughput benchmarks created\n- Read 100MB benchmark passes \u003c1s target\n- Write 100MB benchmark passes \u003c1.5s target\n- Atomic write performance measured\n- Results documented in README\n- cargo bench runs successfully","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T17:17:52.51900859-06:00","updated_at":"2025-11-27T17:17:52.51900859-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-3q4","depends_on_id":"rivets-t0k","type":"blocks","created_at":"2025-11-27T17:20:24.32903356-06:00","created_by":"dwalleck"}]}
{"id":"rivets-3r7","content_hash":"955703375482cf59b73ee6129abe106c8920ff53ed63d113e27907fc7662de0a","title":"Add comprehensive unit tests for Phase 1","description":"Create comprehensive unit tests covering all Phase 1 functionality: reading, writing, streaming, and atomic writes.\n\nTests should cover happy paths, error cases, edge cases, and integration scenarios.","design":"Test categories:\n\n**Reader tests**:\n- read_line() with valid JSON\n- read_line() with malformed JSON\n- read_line() with empty lines\n- read_line() EOF handling\n- stream() with multiple records\n- stream() with errors mid-stream\n\n**Writer tests**:\n- write() single record\n- write_all() multiple records\n- flush() behavior\n- Serialization error handling\n\n**Integration tests**:\n- Round-trip: write then read\n- Atomic write success\n- Atomic write failure (temp file cleanup)\n- Large file streaming (memory usage)\n\nCreate tests/ directory with integration_tests.rs.","acceptance_criteria":"- Unit tests for all JsonlReader methods\n- Unit tests for all JsonlWriter methods\n- Integration tests for round-trip scenarios\n- Tests for error conditions\n- Tests for edge cases (empty files, large files)\n- All tests pass\n- Test coverage \u003e80% for Phase 1 code","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:15:03.058434829-06:00","updated_at":"2025-11-27T19:36:31.113700307-06:00","closed_at":"2025-11-27T19:36:31.113700307-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-3r7","depends_on_id":"rivets-zy0","type":"blocks","created_at":"2025-11-27T17:19:09.744817982-06:00","created_by":"dwalleck"},{"issue_id":"rivets-3r7","depends_on_id":"rivets-b1n","type":"blocks","created_at":"2025-11-27T17:19:15.528746481-06:00","created_by":"dwalleck"}]}
{"id":"rivets-40p","content_hash":"396cd26026ae631f9cad5582372038e1c242d43f67098d423e0323282222d667","title":"Add NO_COLOR environment variable support","description":"Support NO_COLOR environment variable per https://no-color.org/\n\nWhen NO_COLOR is set (to any value), disable all colored output. This ensures compatibility with:\n- CI/CD pipelines\n- Log aggregation systems\n- Users with accessibility needs\n- Piped output\n\nAlso auto-detect if stdout is a TTY and disable colors if not.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-30T12:34:58.392325579-06:00","updated_at":"2025-11-30T12:34:58.392325579-06:00","source_repo":".","labels":["accessibility","phase-1a","ux"],"dependencies":[{"issue_id":"rivets-40p","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:34:58.396152109-06:00","created_by":"dwalleck"}]}
{"id":"rivets-41t","content_hash":"f2ff8483072c015bfa2e96bdfee72bbbd4b15a10758b72dc8218a993c1b2d775","title":"Improve JSON output consistency across commands","description":"Review and potentially standardize JSON output patterns across CLI commands.\n\nCurrently there are two approaches:\n- `output.rs:260-266`: Uses `IssueDetails` struct with `#[serde(flatten)]` to embed issue fields\n- `execute.rs:320-323`: Creates inline `serde_json::json!()` objects for delete command\n\nBoth approaches work, but consider whether to standardize on one pattern for better consistency and maintainability. Options:\n1. Use dedicated structs with `#[serde(flatten)]` everywhere (more type-safe)\n2. Use inline `json!()` macros everywhere (more flexible)\n3. Keep mixed approach where appropriate (current state)\n\nThis is a low-priority code quality improvement.","status":"open","priority":4,"issue_type":"chore","created_at":"2025-11-30T11:42:48.770546385-06:00","updated_at":"2025-11-30T11:42:48.770546385-06:00","source_repo":".","labels":["code-quality","pr-feedback"]}
{"id":"rivets-43i","content_hash":"46cf70e72cd41aa5c6b20df928e3b14c700569145110f8bd67d552ecb25c639b","title":"Implement info command","description":"Add 'info' command to display database path, issue prefix, and system status. Should support --json flag for programmatic use. Example output: { \"database_path\": \".rivets/issues.jsonl\", \"issue_prefix\": \"rivets\" }","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T18:23:39.082722928-06:00","updated_at":"2025-12-27T18:33:28.505227293-06:00","closed_at":"2025-12-27T18:33:28.505227293-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-43i","depends_on_id":"rivets-v3s","type":"parent-child","created_at":"2025-12-27T18:23:39.113582293-06:00","created_by":"dwalleck"}]}
{"id":"rivets-4dw","content_hash":"c6fdf8593e869957053afd21d9fb38fd8ed4080575598719892b50d0b5b45b3e","title":"rivets-mcp: Rust MCP Server for Rivets","description":"Create a Rust-native MCP server that exposes rivets issue tracking functionality to AI assistants like Claude. This is a port of the beads-mcp Python server to Rust.\n\nKey decisions:\n- Library: rmcp v0.8.1 (official Rust MCP SDK)\n- Structure: New rivets-mcp crate in workspace\n- Storage: Direct IssueStorage trait access\n- Transport: stdio only (MVP)","notes":"Core MCP server implementation complete with all 10 tools functional. Remaining work is testing enhancements (rivets-8fe, rivets-2pn) and optional refactoring (rivets-o7o, rivets-1wn).","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-28T19:15:28.493045843-06:00","updated_at":"2025-12-07T18:02:28.855597106-06:00","closed_at":"2025-12-07T18:02:28.855597106-06:00","source_repo":"."}
{"id":"rivets-4il","content_hash":"a578615fda85d6d20d80d5f80fc3c316b184cbe9ef35d27cc132008912ccbabd","title":"Create git merge driver for .automerge files","description":"Implement CLI command and git configuration for automatic CRDT merging during git merge operations.\n\nIncludes:\n- `rv merge \u003cbase\u003e \u003cours\u003e \u003ctheirs\u003e` subcommand\n- .gitattributes configuration for *.automerge files\n- Documentation for git merge driver setup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T13:10:50.322609338-06:00","updated_at":"2025-12-22T22:45:22.910742278-06:00","closed_at":"2025-12-22T22:45:22.910742278-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-4il","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T13:10:50.32386227-06:00","created_by":"dwalleck"}]}
{"id":"rivets-4im","content_hash":"3cce53756b3da5755b877c361746caf6e76593031464098cb2d56cfacd0f5703","title":"Refactor: Extract notes-building helper for close/reopen","description":"The pattern for building notes with 'Closed: {reason}' or 'Reopened: {reason}' is duplicated in execute_close (lines 431-457) and execute_reopen (lines 527-553).\n\n**Recommendation:** Extract into helper:\n```rust\nfn append_note(existing: Option\u003c\u0026str\u003e, new_note: \u0026str) -\u003e String {\n    match existing {\n        Some(notes) =\u003e format!(\"{}\\n\\n{}\", notes, new_note),\n        None =\u003e new_note.to_string(),\n    }\n}\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T09:37:29.340092547-06:00","updated_at":"2025-12-28T11:01:02.38736527-06:00","closed_at":"2025-12-28T11:01:02.38736527-06:00","source_repo":".","labels":["DRY","execute.rs","refactor"],"dependencies":[{"issue_id":"rivets-4im","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:38:35.394887719-06:00","created_by":"dwalleck"}]}
{"id":"rivets-4iz","content_hash":"9b70376966d835363182ef473f4d9f76e8b368eb0b3c96d128de62c190b21876","title":"Add ratatui and crossterm dependencies for TUI","description":"Add TUI dependencies to rivets crate:\n- ratatui = \"0.29\" (TUI framework)\n- crossterm = \"0.28\" (cross-platform terminal backend)","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-30T12:36:55.243494646-06:00","updated_at":"2025-11-30T12:36:55.243494646-06:00","source_repo":".","labels":["phase-3","tui"],"dependencies":[{"issue_id":"rivets-4iz","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:36:55.274739208-06:00","created_by":"dwalleck"}]}
{"id":"rivets-4j2","content_hash":"598a58460ccf3b4e1fa9f66f7aa38e70c98cb07a5df45951d3366de2b25c3466","title":"Update MCP server for CLI parity","description":"Update rivets-mcp to expose new CLI functionality as MCP tools.\n\nRequired new tools:\n- reopen: Reopen closed issues (mirrors CLI reopen command)\n- stale: Find issues not updated recently\n- label_add: Add labels to issues\n- label_remove: Remove labels from issues  \n- label_list: List labels for an issue\n- label_list_all: List all labels in use across issues\n\nEnhancements:\n- Enhance where_am_i or add info tool with issue prefix, config details\n- Consider dep_tree tool for dependency visualization\n\nNote: Multi-ID support is optional for MCP since agents can call tools multiple times.\n\nThis should be done after the corresponding CLI commands are implemented.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T18:25:51.377507037-06:00","updated_at":"2025-12-27T23:16:27.368028795-06:00","closed_at":"2025-12-27T23:16:27.368028795-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-4j2","depends_on_id":"rivets-v3s","type":"parent-child","created_at":"2025-12-27T18:25:51.407588967-06:00","created_by":"dwalleck"},{"issue_id":"rivets-4j2","depends_on_id":"rivets-g25","type":"blocks","created_at":"2025-12-27T18:26:08.406285243-06:00","created_by":"dwalleck"},{"issue_id":"rivets-4j2","depends_on_id":"rivets-i2w","type":"blocks","created_at":"2025-12-27T18:26:14.243368878-06:00","created_by":"dwalleck"},{"issue_id":"rivets-4j2","depends_on_id":"rivets-cej","type":"blocks","created_at":"2025-12-27T18:26:20.08279193-06:00","created_by":"dwalleck"}]}
{"id":"rivets-4l2","content_hash":"f4caa91ea221786dae37c309159fcd728e82e21c70ee689e4dcbbea763914465","title":"Implement init command and workspace setup","description":"Implement the init command that creates the .rivets directory structure, initializes the SQLite database, and sets up configuration.","design":"Based on MVP architecture (in-memory + JSONL):\n\n**Directory Structure**:\n```\n.rivets/\n├── issues.jsonl        # JSONL data file\n├── config.yaml         # Project config\n└── .gitignore          # Ignore metadata files\n```\n\n**Init Process**:\n1. Check if already initialized (error if exists)\n2. Create .rivets/ directory\n3. Create default config.yaml with storage backend settings\n4. Set issue prefix (from flag or prompt)\n5. Create .gitignore\n6. Create empty issues.jsonl file\n\n**Git Integration**:\n- Add .rivets to .gitignore root if not present\n- Suggest git commit for initial setup\n\n**CLI**:\n```bash\nrivets init [--prefix \u003cprefix\u003e] [--quiet]\n```\n\n**Config Template**:\n```yaml\nissue-prefix: \"proj\"\nstorage:\n  backend: \"memory\"\n  data_file: \".rivets/issues.jsonl\"\n```","acceptance_criteria":"- Init creates .rivets directory\n- config.yaml created with storage backend = memory\n- issues.jsonl created (empty initially)\n- .gitignore created\n- Prefix validation (alphanumeric, 2-20 chars)\n- Error if already initialized\n- Integration test verifies complete setup\n- No database files created","status":"closed","priority":1,"issue_type":"task","assignee":"rust-developer","created_at":"2025-11-17T16:16:47.684395549-06:00","updated_at":"2025-11-29T19:41:23.084110706-06:00","closed_at":"2025-11-29T19:41:23.084110706-06:00","source_repo":"."}
{"id":"rivets-4q2","content_hash":"90145c7f13ed6765b55d1f7b3b92d3622459a0e33e8d277665549c1e6b7a82b1","title":"Integrate resilient JSONL loading with in_memory storage","description":"Update rivets in_memory::load_from_jsonl() to use the new rivets-jsonl library's resilient loading functionality.\n\nThis replaces the current manual JSONL parsing with the library implementation.","design":"Update in_memory.rs to use rivets-jsonl:\n\n```rust\nuse rivets_jsonl::read_jsonl_resilient;\n\npub async fn load_from_jsonl(\n    path: \u0026Path,\n    prefix: String,\n) -\u003e Result\u003c(Box\u003cdyn IssueStorage\u003e, Vec\u003cLoadWarning\u003e)\u003e {\n    let (issues, warnings) = read_jsonl_resilient::\u003cIssue, _\u003e(path).await?;\n    \n    // Convert rivets_jsonl::Warning to LoadWarning\n    let load_warnings: Vec\u003cLoadWarning\u003e = warnings\n        .into_iter()\n        .map(|w| match w {\n            rivets_jsonl::Warning::MalformedJson { line_number, error } =\u003e {\n                LoadWarning::MalformedJson { line_number, error }\n            }\n            rivets_jsonl::Warning::SkippedLine { line_number, reason } =\u003e {\n                // Map to appropriate LoadWarning variant\n                LoadWarning::MalformedJson { line_number, error: reason }\n            }\n        })\n        .collect();\n    \n    // Continue with existing dependency reconstruction logic\n    let storage = Arc::new(Mutex::new(InMemoryStorageInner::new(prefix)));\n    // ... existing code\n    \n    Ok((Box::new(storage), load_warnings))\n}\n```\n\nAdd rivets-jsonl as dependency in rivets/Cargo.toml.","acceptance_criteria":"- in_memory::load_from_jsonl uses rivets-jsonl library\n- Warnings correctly mapped between types\n- All existing tests still pass\n- No performance regression\n- Dependency added to Cargo.toml","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:16:06.671886113-06:00","updated_at":"2025-11-28T01:04:14.251308562-06:00","closed_at":"2025-11-28T01:04:14.251308562-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-4q2","depends_on_id":"rivets-uyg","type":"blocks","created_at":"2025-11-27T17:19:38.432794292-06:00","created_by":"dwalleck"}]}
{"id":"rivets-4tev","content_hash":"7f77dd55eb652310d1378ad048afbdd0fe30b1e029ae987ca81c99d098e0306a","title":"Implement Pass 2: resolve references against symbol DB","description":"After all files are indexed, run a second pass to resolve unresolved references:\n\n1. Query all references with symbol_id = NULL\n2. For each, look up import context from imports table\n3. Match reference name against symbols from imported modules\n4. Update reference with resolved symbol_id\n\nResolution priority:\n1. Same-file lookup\n2. Explicit import lookup\n3. Qualified path resolution\n4. Glob import search\n5. Leave unresolved (LSP candidate)","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:27:39.509250642-06:00","updated_at":"2026-01-28T12:09:44.894299963-06:00","closed_at":"2026-01-28T12:09:44.894299963-06:00","source_repo":".","labels":["phase1","tethys"],"dependencies":[{"issue_id":"rivets-4tev","depends_on_id":"rivets-itz7","type":"blocks","created_at":"2026-01-28T11:29:38.54299152-06:00","created_by":"dwalleck"},{"issue_id":"rivets-4tev","depends_on_id":"rivets-1p0f","type":"blocks","created_at":"2026-01-28T11:29:44.732047183-06:00","created_by":"dwalleck"},{"issue_id":"rivets-4tev","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:31:45.582383474-06:00","created_by":"dwalleck"}]}
{"id":"rivets-5an","content_hash":"7c0d1043ef6bc483ea311d3d2ff544643b3222fc97d58aecb979be305d9a6e18","title":"Add config file validation on load","description":"When loading config.yaml in commands, validate that manually-edited values (like prefix) are still valid. Currently, if a user edits the config file to have an invalid prefix, it won't be caught until issue creation.","design":"Add validation in RivetsConfig::load():\\n\\n1. After deserializing, call validate_prefix() on issue_prefix\\n2. Validate storage.backend is a known value\\n3. Validate storage.data_file path is reasonable\\n\\nReturn helpful error messages indicating which field is invalid and what the requirements are.","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T20:48:34.570179736-06:00","updated_at":"2025-11-29T20:48:34.570179736-06:00","source_repo":".","labels":["config","validation"]}
{"id":"rivets-5nz","content_hash":"593f6ae163644647c0c56a7d8b3d4d7359d9f58021f81212dbf6334b648de81d","title":"Add property-based tests with proptest for validators","description":"Use proptest crate to add property-based tests for CLI validators. This would help catch edge cases by generating random inputs:\n- validate_prefix: arbitrary alphanumeric strings of varying lengths\n- validate_issue_id: arbitrary prefix-suffix combinations\n- validate_title: arbitrary strings with control characters\n- validate_description: arbitrary multiline strings","status":"open","priority":4,"issue_type":"task","created_at":"2025-11-29T22:11:31.127884203-06:00","updated_at":"2025-11-29T22:11:31.127884203-06:00","source_repo":".","labels":["pr-feedback","testing"]}
{"id":"rivets-5vz","content_hash":"8da8f0efc96fb5e223f3c5e5f51a765e942fc01eb53e1a881bfbfddd1073068a","title":"Automerge CRDT Storage Backend","description":"Add Automerge-based storage backend to enable true concurrent access by multiple agents without file locking or merge conflicts. See docs/design/automerge-storage.md for full design.","design":"Architecture: IssueStorage trait abstraction remains unchanged. AutomergeStorage implements the trait with Automerge document as source of truth. JSONL remains as optional human-readable export.\n\nKey decisions:\n- Dual persistence: Automerge primary, JSONL secondary\n- Text fields use Automerge Text for character-level merging\n- Status/priority use last-writer-wins registers\n- Lists (labels, deps) merge additively\n- petgraph rebuilt from document on load/merge\n- Custom git merge driver for .automerge files","acceptance_criteria":"- [ ] AutomergeStorage implements IssueStorage trait\n- [ ] Multiple agents can modify issues concurrently without corruption (integration tests)\n- [ ] Git merge driver resolves .automerge conflicts automatically\n- [ ] JSONL export regenerated on save\n- [ ] Migration path from existing JSONL works\n- [ ] No performance regression for single-agent use\n- [ ] petgraph is rebuilt correctly after hydration/merge","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-30T13:10:01.27822602-06:00","updated_at":"2025-12-22T22:44:47.833139894-06:00","closed_at":"2025-12-22T22:44:47.833139894-06:00","source_repo":"."}
{"id":"rivets-6bc","content_hash":"2a82ceb84c4e94c00733b934b7edbb09133fd476c76defd8318dd7a59c33dc63","title":"Human-first UX Differentiation","description":"Position Rivets as \"equally powerful for both humans AND agents\" - addressing the gap in Beads' positioning where humans feel like secondary citizens.\n\nTarget: Solo developers and small teams using AI agents","status":"open","priority":1,"issue_type":"epic","created_at":"2025-11-30T12:34:01.044494126-06:00","updated_at":"2025-11-30T12:34:01.044494126-06:00","source_repo":".","labels":["differentiation","ux"]}
{"id":"rivets-6ep","content_hash":"492e0ed3a80032ee5f70cf795012358b2ac77b6b59904344b088ed65bcd8e54c","title":"Investigate lock contention in multi-workspace MCP scenarios","description":"The current `Arc\u003cRwLock\u003cContext\u003e\u003e` design serializes all storage access across workspaces. For typical single-workspace usage this is fine, but could become a bottleneck with many concurrent MCP requests to different workspaces.","design":"**Current behavior:**\n- Every tool call acquires context read lock to get storage\n- Lock ordering (release context before storage) is correct but adds overhead\n\n**Potential optimization:**\nReplace with lock-free workspace lookup using `DashMap`:\n```rust\nstorage_cache: Arc\u003cDashMap\u003cPathBuf, Arc\u003cRwLock\u003cBox\u003cdyn IssueStorage\u003e\u003e\u003e\u003e\u003e\n```\n\nThis allows concurrent reads from different workspaces without contention. Only `set_context` would need exclusive access.\n\n**Locations:**\n- `tools.rs:96-100`\n- `context.rs:32`","acceptance_criteria":"- [ ] Profile with realistic multi-workspace workload to confirm contention exists\n- [ ] If confirmed, implement DashMap-based approach\n- [ ] Benchmark before/after to verify improvement\n- [ ] No regression in single-workspace performance","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-28T22:28:36.847262094-06:00","updated_at":"2025-11-28T22:28:36.847262094-06:00","source_repo":".","labels":["future","optimization","performance"]}
{"id":"rivets-6mi","content_hash":"b58f6ceee82d4d980d3a9f4d1696ebbc2d983a52126ef60ae76c138203f7729f","title":"Add tracing and logging","description":"Integrate tracing for observability:\n- tracing-subscriber setup\n- Request/response logging\n- Debug logging for context and storage operations","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T19:16:39.610630301-06:00","updated_at":"2025-12-07T18:00:49.802877931-06:00","closed_at":"2025-12-07T18:00:49.802877931-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-6mi","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:17:57.013903581-06:00","created_by":"dwalleck"}]}
{"id":"rivets-6op","content_hash":"63e66ddd284e3947e525a2899fbcba60cfe275c40de502da9cdd2febb543e937","title":"Implement dependency system with cycle detection","description":"Implement the 4-type dependency system (blocks, related, parent-child, discovered-from) with recursive CTE-based cycle detection to prevent circular dependencies.","design":"Based on beads dependencies.go, adapted for Phase 1 (in-memory + petgraph):\n\n**Dependency Types**:\n1. blocks: Hard blocker (prevents work)\n2. related: Soft link (informational)\n3. parent-child: Hierarchical (epics→tasks)\n4. discovered-from: Found during work\n\n**Phase 1 Implementation (In-Memory + petgraph)**:\n```rust\nimpl InMemoryStorage {\n    fn add_dependency(\n        \u0026mut self, \n        from: \u0026IssueId, \n        to: \u0026IssueId, \n        dep_type: DependencyType\n    ) -\u003e Result\u003c()\u003e {\n        // Cycle detection using petgraph\n        if self.has_cycle(from, to)? {\n            return Err(Error::CircularDependency);\n        }\n        \n        // Add edge to graph\n        let from_node = self.node_map.get(from)?;\n        let to_node = self.node_map.get(to)?;\n        self.graph.add_edge(*from_node, *to_node, dep_type);\n        \n        // Update issue's dependency list\n        let issue = self.issues.get_mut(from)?;\n        issue.dependencies.push(Dependency { \n            depends_on_id: to.clone(), \n            dep_type \n        });\n        \n        Ok(())\n    }\n    \n    fn has_cycle(\u0026self, from: \u0026IssueId, to: \u0026IssueId) -\u003e Result\u003cbool\u003e {\n        use petgraph::algo;\n        let from_node = self.node_map.get(from)?;\n        let to_node = self.node_map.get(to)?;\n        \n        // Check if adding edge creates cycle\n        Ok(algo::has_path_connecting(\u0026self.graph, *to_node, *from_node, None))\n    }\n}\n```\n\n**Phase 3 (PostgreSQL)**: Will use recursive CTEs for cycle detection:\n```sql\nWITH RECURSIVE paths AS (\n    SELECT issue_id, depends_on_id, 1 as depth\n    FROM dependencies WHERE issue_id = ?\n    UNION ALL\n    SELECT d.issue_id, d.depends_on_id, p.depth + 1\n    FROM dependencies d JOIN paths p \n    ON d.issue_id = p.depends_on_id\n    WHERE p.depth \u003c 100\n)\nSELECT EXISTS(SELECT 1 FROM paths WHERE depends_on_id = ?)\n```","acceptance_criteria":"- All 4 dependency types supported\n- Add dependency with cycle pre-check using petgraph\n- Remove dependency operation\n- List dependencies (forward/reverse) \n- Cycle detection via petgraph has_path_connecting\n- Find dependency tree via graph traversal\n- Unit tests for cycles, trees, all dep types\n- Benchmark: cycle check for 1000 issues in \u003c10ms","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T16:15:21.434804051-06:00","updated_at":"2025-11-28T09:07:46.772048093-06:00","closed_at":"2025-11-28T09:07:46.772048093-06:00","source_repo":"."}
{"id":"rivets-6p4","content_hash":"9041f1459d0b32c729951e84a63676c6b05cb4127f77092afc4b391003df3209","title":"Implement query execution with filtering","description":"Implement the execute() method for JsonlQuery that applies filters during streaming.\n\nThis enables filtering JSONL records without loading entire file into memory.","design":"```rust\nimpl\u003cT\u003e JsonlQuery\u003cT\u003e\nwhere\n    T: DeserializeOwned + 'static,\n{\n    pub fn execute\u003cR\u003e(\n        self,\n        reader: R\n    ) -\u003e impl Stream\u003cItem = Result\u003cT\u003e\u003e\n    where\n        R: AsyncRead + Unpin,\n    {\n        let jsonl_reader = JsonlReader::new(reader);\n        let stream = jsonl_reader.stream::\u003cT\u003e();\n        \n        stream.filter_map(move |result| {\n            let matches = match \u0026result {\n                Ok(value) =\u003e self.matches(value),\n                Err(_) =\u003e true, // Pass errors through\n            };\n            \n            async move {\n                if matches {\n                    Some(result)\n                } else {\n                    None\n                }\n            }\n        })\n    }\n}\n```","acceptance_criteria":"- execute() method implemented\n- Returns Stream\u003cItem = Result\u003cT\u003e\u003e\n- Filters applied during streaming\n- Only matching records yielded\n- Errors passed through unchanged\n- Memory usage constant (streaming)\n- Unit tests verify filtering behavior\n- Integration test with large file","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T17:16:55.357983235-06:00","updated_at":"2025-11-27T17:16:55.357983235-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-6p4","depends_on_id":"rivets-83j","type":"blocks","created_at":"2025-11-27T17:19:55.646172247-06:00","created_by":"dwalleck"}]}
{"id":"rivets-6pi","content_hash":"d77bd80b53f88e6742b0ffd3213fc732141d4066c4877abfcc9a23449d46fd0e","title":"Implement JsonlWriter::write() and write_all() methods","description":"Implement write methods for JsonlWriter that serialize and write records to the output stream.\n\nIncludes both single-record write() and batch write_all() for efficiency.","design":"```rust\nuse serde::Serialize;\nuse tokio::io::AsyncWriteExt;\n\nimpl\u003cW: AsyncWrite + Unpin\u003e JsonlWriter\u003cW\u003e {\n    pub async fn write\u003cT: Serialize\u003e(\u0026mut self, value: \u0026T) -\u003e Result\u003c()\u003e {\n        let json = serde_json::to_string(value)?;\n        self.writer.write_all(json.as_bytes()).await?;\n        self.writer.write_all(b\"\\n\").await?;\n        Ok(())\n    }\n    \n    pub async fn write_all\u003cT: Serialize\u003e(\n        \u0026mut self,\n        values: impl IntoIterator\u003cItem = T\u003e,\n    ) -\u003e Result\u003c()\u003e {\n        for value in values {\n            self.write(\u0026value).await?;\n        }\n        Ok(())\n    }\n    \n    pub async fn flush(\u0026mut self) -\u003e Result\u003c()\u003e {\n        self.writer.flush().await?;\n        Ok(())\n    }\n}\n```","acceptance_criteria":"- write() method serializes and writes single record\n- write_all() writes multiple records efficiently\n- flush() method flushes buffered data\n- Each record terminated with newline\n- Proper error handling for serialization failures\n- Unit tests verify writing single/multiple records\n- Integration test with read/write round-trip","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:14:51.609289345-06:00","updated_at":"2025-11-27T18:21:22.277922663-06:00","closed_at":"2025-11-27T18:21:22.277922663-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-6pi","depends_on_id":"rivets-uo7","type":"blocks","created_at":"2025-11-27T17:18:58.168325594-06:00","created_by":"dwalleck"}]}
{"id":"rivets-6qm","content_hash":"3da551b0d04a0701be5cbaa8b42fa0638945f678ea426ea5458c381dbd4ee3ce","title":"Implement fuzzy search for issue selection","description":"Add fuzzy search for issue ID selection:\n\n```\n$ rivets show\n\u003e auth\n  rivets-abc Fix authentication bug\n  rivets-def Add OAuth support\n  rivets-ghi Auth token refresh\n```\n\nUse skim library for the fuzzy matching UI.\nAlso support label and assignee autocomplete.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:36:12.633939684-06:00","updated_at":"2025-11-30T12:36:12.633939684-06:00","source_repo":".","labels":["phase-2","ux"],"dependencies":[{"issue_id":"rivets-6qm","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:36:12.636026067-06:00","created_by":"dwalleck"}]}
{"id":"rivets-6tl","content_hash":"abfe3b87cb3c18b9c3d5544936c74218d0861206e5f293104f53a9c8e0956473","title":"Implement issue filtering and query system","description":"Implement the comprehensive filtering system for querying issues by status, priority, type, assignee, labels, dates, and text search.","design":"Based on beads IssueFilter struct and query builder:\n\n**Filter Dimensions**:\n- **Status**: open, in_progress, blocked, closed\n- **Priority**: 0-4, ranges (P0-P2), min/max\n- **Type**: bug, feature, task, epic, chore\n- **Assignee**: specific user, empty\n- **Labels**: AND (all required), OR (any match)\n- **Dates**: created_after/before, updated_after/before, closed_after/before\n- **Text**: title_contains, description_contains, notes_contains\n- **Flags**: empty_description, no_assignee, no_labels\n- **IDs**: specific list\n\n**Query Builder Pattern**:\n```rust\nIssueFilter::builder()\n    .status(vec![Status::Open, Status::InProgress])\n    .priority_range(0..=2)\n    .labels_all(vec![\"bug\", \"urgent\"])\n    .created_after(date)\n    .limit(100)\n    .build()\n```\n\n**SQL Generation**:\n- Dynamic WHERE clause construction\n- Parameterized queries (SQL injection safe)\n- Index-friendly query plans","acceptance_criteria":"- All filter dimensions functional\n- Complex multi-filter queries work\n- Query builder API type-safe\n- SQL generation correct and efficient\n- Performance acceptable (1000 issues in \u003c50ms)\n- Unit tests for edge cases\n- Integration tests for complex filters","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-17T16:16:47.522142136-06:00","updated_at":"2025-11-17T16:16:47.522142136-06:00","source_repo":"."}
{"id":"rivets-6u6","content_hash":"3c8b07b95286b08379a83fae129e0485831a58b349dbf3382e4cb49dc9d156be","title":"Implement set_context and where_am_i tools","description":"Implement context management tools:\n- set_context(workspace_root) - Set workspace and discover .rivets/\n- where_am_i() - Debug: show current workspace context\n\nThese are foundational tools that all other tools depend on.","acceptance_criteria":"- [ ] set_context tool registers and responds correctly\n- [ ] where_am_i returns current context state\n- [ ] Error handling for missing/invalid workspace\n- [ ] Unit tests: both tools with MockStorage","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T19:16:16.966340774-06:00","updated_at":"2025-11-29T19:19:11.657351433-06:00","closed_at":"2025-11-29T19:19:11.657351433-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-6u6","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:17:34.42091742-06:00","created_by":"dwalleck"},{"issue_id":"rivets-6u6","depends_on_id":"rivets-s3o","type":"blocks","created_at":"2025-11-28T19:18:35.775041212-06:00","created_by":"dwalleck"}]}
{"id":"rivets-6x7g","content_hash":"583aefb8dcf905d7608dd27bcaa235f1cbc53fc70db71554ba2229f2a10282a0","title":"Add CSharpLsProvider","description":"Fast follow after rust-analyzer is working:\n\n```rust\npub struct CSharpLsProvider;\nimpl LspProvider for CSharpLsProvider {\n    fn command(\u0026self) -\u003e \u0026str { \"csharp-ls\" }\n}\n```\n\nWire up to use csharp-ls for .cs files when --lsp is specified.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T11:29:09.273111083-06:00","updated_at":"2026-01-28T19:42:23.934741997-06:00","closed_at":"2026-01-28T19:42:23.934741997-06:00","source_repo":".","labels":["csharp","lsp","phase2","tethys"],"dependencies":[{"issue_id":"rivets-6x7g","depends_on_id":"rivets-1dza","type":"blocks","created_at":"2026-01-28T11:30:58.092624611-06:00","created_by":"dwalleck"},{"issue_id":"rivets-6x7g","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:49.243137366-06:00","created_by":"dwalleck"}]}
{"id":"rivets-6yc","content_hash":"a723511f30610613e1992a6610d2e1625addbdd21368c832a86706d15ea2e08a","title":"Evaluate lock holding duration in MCP tools","description":"Review the lock holding patterns in rivets-mcp tools to ensure we're not holding locks longer than necessary.\n\nContext from PR review:\n- Current pattern: Acquire context read lock, then acquire storage write lock for operations\n- Potential optimization: Clone the Arc\u003cStorage\u003e early and release the context lock immediately\n- Trade-off: Earlier lock release vs additional Arc clone overhead\n\nEvaluation should consider:\n1. Whether the current lock ordering prevents deadlocks (context -\u003e storage)\n2. If cloning Arc early provides meaningful concurrency benefits\n3. Actual contention patterns in typical MCP usage (single client vs multiple)\n4. Whether read locks on context could be held across storage operations safely","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T01:29:38.632289389-06:00","updated_at":"2025-11-29T01:29:38.632289389-06:00","source_repo":".","labels":["concurrency","performance","rivets-mcp"]}
{"id":"rivets-7ag","content_hash":"d9c2866618431376d1ed860b51abe18ae336b20c4a4ad82fccacb182f84e8a2f","title":"Add atomic append_notes operation to IssueStorage trait","description":"Address TOCTOU race condition in close command by adding atomic note appending.\n\nLocation: `execute.rs:241-263`\n\nCurrent behavior:\n- Two separate operations: `get_issue()` then `update_issue()` with appended notes\n- TOCTOU window exists between read and write\n- Documented as acceptable for single-user CLI\n\nEnhancement for multi-user scenarios:\n- Add `append_notes(\u0026self, id: \u0026IssueId, notes: \u0026str)` method to `IssueStorage` trait\n- Implement atomic append in storage backends\n- Update close command to use atomic operation\n\nThis would eliminate the race condition for future concurrent access scenarios.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-11-30T11:45:08.387504813-06:00","updated_at":"2025-11-30T11:45:08.387504813-06:00","source_repo":".","labels":["pr-feedback","storage"]}
{"id":"rivets-7nko","content_hash":"54fdc91c3e90f68c0759ebae500ec393f455b28e29fe1f41c2e2386527ffdd57","title":"Consider StorageResult type alias if helper pattern expands","description":"From PR #34 review: Consider adding a type alias for Result\u003cIssue, Error\u003e if more helper functions emerge that use this pattern. Currently only save_or_record_failure uses it, so not needed yet.\n\n```rust\ntype StorageResult = Result\u003ccrate::domain::Issue, crate::error::Error\u003e;\n```\n\nTrigger: Add this when a second helper function needs the same type signature.","status":"open","priority":4,"issue_type":"chore","created_at":"2025-12-28T10:53:22.966528697-06:00","updated_at":"2025-12-28T10:53:22.966528697-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-7nko","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T10:53:42.013492556-06:00","created_by":"dwalleck"}]}
{"id":"rivets-7nq","content_hash":"70315280c80d04cf64e223e7320d74d051dadc835c7ca60db518af2cb20a4fa1","title":"Create shared fixtures module (optional)","description":"Extract common fixtures used across multiple test files into shared modules.\n\nStructure:\n- crates/rivets-jsonl/tests/common/mod.rs\n- crates/rivets/tests/common/mod.rs\n\nThis task should be done after the conversion tasks to see what fixtures emerge as reusable.","acceptance_criteria":"- Common fixtures identified and extracted\n- Fixtures reused across test files where applicable\n- All tests pass","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-11-28T18:57:53.770663946-06:00","updated_at":"2025-11-28T20:11:28.565585029-06:00","closed_at":"2025-11-28T20:11:28.565585029-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-7nq","depends_on_id":"rivets-ans","type":"blocks","created_at":"2025-11-28T18:57:53.80236096-06:00","created_by":"dwalleck"},{"issue_id":"rivets-7nq","depends_on_id":"rivets-c0p","type":"blocks","created_at":"2025-11-28T18:57:53.802988455-06:00","created_by":"dwalleck"},{"issue_id":"rivets-7nq","depends_on_id":"rivets-dev","type":"blocks","created_at":"2025-11-28T18:57:53.803280703-06:00","created_by":"dwalleck"},{"issue_id":"rivets-7nq","depends_on_id":"rivets-dee","type":"blocks","created_at":"2025-11-28T18:57:53.803564344-06:00","created_by":"dwalleck"},{"issue_id":"rivets-7nq","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T18:58:03.88403921-06:00","created_by":"dwalleck"}]}
{"id":"rivets-7q6","content_hash":"30aee685cbc27c7411fb279d3743bc4a499aaa9f6efc00f774c7c6bc363547cf","title":"Add Send assertions for async futures (M-TYPES-SEND)","description":"The codebase uses async/await extensively but lacks explicit compile-time assertions that futures are Send, violating the M-TYPES-SEND guideline.\n\nCurrent State:\n- IssueStorage trait requires Send + Sync\n- Methods return futures implicitly\n- No compile-time verification that futures are actually Send\n- Could break multi-threaded async runtimes\n\nRisk:\n- If a future accidentally captures non-Send types, it won't be detected until runtime\n- Makes the library unsafe to use with work-stealing executors","design":"Add Send assertions in storage/mod.rs tests (after line 453):\n\n```rust\n#[test]\nfn assert_storage_futures_are_send() {\n    const fn assert_send\u003cT: Send\u003e() {}\n    \n    // Assert that all IssueStorage methods return Send futures\n    assert_send::\u003cBox\u003cdyn IssueStorage\u003e\u003e();\n    \n    // Can also test specific future types if needed\n    // This ensures futures work with multi-threaded runtimes\n}\n```\n\nThis pattern:\n- Runs at compile time (const fn)\n- Catches non-Send futures immediately\n- Documents the Send requirement\n- Zero runtime cost","acceptance_criteria":"- [ ] assert_send helper function added\n- [ ] Test verifies Box\u003cdyn IssueStorage\u003e is Send\n- [ ] Test verifies key future types are Send\n- [ ] Code compiles (proving assertion holds)\n- [ ] All tests pass","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T16:49:09.918623993-06:00","updated_at":"2025-11-27T16:49:09.918623993-06:00","source_repo":".","labels":["async","code-quality","testing"]}
{"id":"rivets-7qb","content_hash":"2771f3a324beb0e5d5fbb39b7216385985c5c1ac425fe215bf5441fb55baf0dc","title":"Memory profiling and optimization","description":"Profile memory usage of rivets-jsonl and optimize to meet the \u003c10MB target regardless of file size.\n\nUses memory profiling tools and techniques to verify streaming guarantees.","design":"Memory profiling approach:\n\n1. **Create test files**:\n   - 1MB (1K records)\n   - 10MB (10K records)\n   - 100MB (100K records)\n   - 1GB (1M records)\n\n2. **Profile streaming operations**:\n   ```rust\n   #[cfg(test)]\n   mod memory_tests {\n       use std::alloc::{GlobalAlloc, Layout, System};\n       use std::sync::atomic::{AtomicUsize, Ordering};\n       \n       struct TrackingAllocator;\n       \n       static ALLOCATED: AtomicUsize = AtomicUsize::new(0);\n       \n       unsafe impl GlobalAlloc for TrackingAllocator {\n           unsafe fn alloc(\u0026self, layout: Layout) -\u003e *mut u8 {\n               ALLOCATED.fetch_add(layout.size(), Ordering::SeqCst);\n               System.alloc(layout)\n           }\n           \n           unsafe fn dealloc(\u0026self, ptr: *mut u8, layout: Layout) {\n               ALLOCATED.fetch_sub(layout.size(), Ordering::SeqCst);\n               System.dealloc(ptr, layout);\n           }\n       }\n   }\n   ```\n\n3. **Optimization targets**:\n   - Buffer size tuning\n   - Reduce allocations in hot paths\n   - Reuse String buffers where possible\n\n4. **Verification**:\n   - Peak memory usage \u003c10MB for all file sizes\n   - Document peak memory in README","acceptance_criteria":"- Memory profiling tests created\n- Tested with 1MB, 10MB, 100MB, 1GB files\n- Peak memory \u003c10MB for all sizes\n- Buffer sizes optimized\n- Allocations minimized in hot paths\n- Results documented","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T17:17:46.767467084-06:00","updated_at":"2025-11-27T17:17:46.767467084-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-7qb","depends_on_id":"rivets-t0k","type":"blocks","created_at":"2025-11-27T17:20:18.598804542-06:00","created_by":"dwalleck"}]}
{"id":"rivets-7qr","content_hash":"0ff234d4ec5d958649b5a7e68d9cd5369819c39c489d71397f7dc68c87cc9386","title":"Fix limit parameter not working in list and ready tools","description":"The `limit` parameter in `list()` and `ready()` tools is not being applied. Tests create 5 issues, request limit=2, but get 5 results back.\n\nFailing tests:\n- `test_list_with_limit` - expected 2, got 5\n- `test_ready_with_limit` - expected 2, got 5\n\nFound during rivets-vdi implementation.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-29T17:40:57.038151966-06:00","updated_at":"2025-11-29T17:42:49.399935566-06:00","closed_at":"2025-11-29T17:42:49.399935566-06:00","source_repo":"."}
{"id":"rivets-7uw0","content_hash":"cf5470dda49cbb3a344f8b57910aee1ee6147fb918f8a9d639e42f90dada1bd2","title":"Performance benchmarking on rivets codebase","description":"After Phase 1 implementation, benchmark on the rivets codebase:\n\n- Index time with two-pass vs previous single-pass\n- Memory usage during Pass 2\n- Query performance for callers/impact\n\nDocument findings and optimize if needed.","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:27:58.427268019-06:00","updated_at":"2026-01-28T17:39:21.911663853-06:00","closed_at":"2026-01-28T17:39:21.911663853-06:00","source_repo":".","labels":["phase1","tethys"],"dependencies":[{"issue_id":"rivets-7uw0","depends_on_id":"rivets-ugg6","type":"blocks","created_at":"2026-01-28T11:30:03.480960189-06:00","created_by":"dwalleck"},{"issue_id":"rivets-7uw0","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:04.925194359-06:00","created_by":"dwalleck"}]}
{"id":"rivets-7v2","content_hash":"51ce6f8cbc00fd266406381717faa96fe78920b3103d25b95ffaa772f30b6c28","title":"Add interactive prompts for missing required fields","description":"When creating issues without required fields, prompt interactively:\n\n```\n$ rivets create\nTitle: Fix authentication bug\nPriority [2]: 1\nType [task]: bug\nCreated issue: rivets-abc\n```\n\nSkip prompts when --json flag is set (for agent compatibility).","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-30T12:35:36.843222609-06:00","updated_at":"2025-11-30T12:35:36.843222609-06:00","source_repo":".","labels":["phase-1b","ux"],"dependencies":[{"issue_id":"rivets-7v2","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:35:36.874166495-06:00","created_by":"dwalleck"}]}
{"id":"rivets-81c","content_hash":"58a6ddd6a566b0b2838efae80b1b705c9cbbaa9eadee7d5fd3629b0cb9fddbd4","title":"Implement IssueDocument type for Automerge","description":"Create the core IssueDocument struct that wraps AutoCommit and provides methods for issue CRUD operations on the document.\n\nIncludes:\n- Add autosurgeon Reconcile/Hydrate derives to domain types (Issue, Dependency, IssueStatus, IssueType, DependencyType)\n- Create IssueDocument wrapper struct\n- Implement hydrate/reconcile methods for document ↔ struct conversion","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T13:10:27.719020626-06:00","updated_at":"2025-12-22T22:44:59.580445491-06:00","closed_at":"2025-12-22T22:44:59.580445491-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-81c","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T13:10:27.72081892-06:00","created_by":"dwalleck"}]}
{"id":"rivets-83j","content_hash":"4552c2e9d372becf69a84f1ff3b1b01984e0b01f29a2fc3e7bfce10f5c162ab4","title":"Implement JsonlQuery builder pattern","description":"Implement the JsonlQuery struct with builder pattern for constructing query pipelines with filters and transformations.\n\nThis provides a fluent API for filtering JSONL streams during reading.","design":"```rust\nuse std::marker::PhantomData;\n\npub struct JsonlQuery\u003cT\u003e {\n    predicates: Vec\u003cBox\u003cdyn Fn(\u0026T) -\u003e bool + Send + Sync\u003e\u003e,\n    _phantom: PhantomData\u003cT\u003e,\n}\n\nimpl\u003cT\u003e JsonlQuery\u003cT\u003e\nwhere\n    T: DeserializeOwned + 'static,\n{\n    pub fn new() -\u003e Self {\n        Self {\n            predicates: Vec::new(),\n            _phantom: PhantomData,\n        }\n    }\n    \n    pub fn filter\u003cF\u003e(mut self, predicate: F) -\u003e Self\n    where\n        F: Fn(\u0026T) -\u003e bool + Send + Sync + 'static,\n    {\n        self.predicates.push(Box::new(predicate));\n        self\n    }\n    \n    fn matches(\u0026self, value: \u0026T) -\u003e bool {\n        self.predicates.iter().all(|pred| pred(value))\n    }\n}\n```","acceptance_criteria":"- JsonlQuery struct defined\n- new() constructor\n- filter() method adds predicates\n- Predicates stored as trait objects\n- Builder pattern allows chaining\n- Unit tests verify builder functionality\n- Compiles without errors","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T17:16:49.651063411-06:00","updated_at":"2025-11-27T17:16:49.651063411-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-83j","depends_on_id":"rivets-zy0","type":"blocks","created_at":"2025-11-27T17:19:49.936527243-06:00","created_by":"dwalleck"}]}
{"id":"rivets-84i","content_hash":"8b73fc70d7b74097def8c16a7ad51e3347d91e1612f992f493f136eeec552d7c","title":"Add Automerge sync protocol support","description":"Implement generate_sync_message and receive_sync_message for future P2P and server sync capabilities.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-30T13:10:55.978563339-06:00","updated_at":"2025-12-22T22:45:40.567472509-06:00","closed_at":"2025-12-22T22:45:40.567472509-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-84i","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T13:10:55.980843939-06:00","created_by":"dwalleck"}]}
{"id":"rivets-8fe","content_hash":"5ce55ef67d05f73d3ad316bb53aed91da528e7cc400303ef58fdfb89f6e2c508","title":"Add edge case filter tests for MCP integration tests","description":"Add comprehensive edge case tests for the filter functionality in MCP integration tests to ensure robust handling of boundary conditions and special scenarios.","design":"Add test cases to `crates/rivets-mcp/tests/integration.rs` covering:\n\n1. **Empty filter results**: Create issues that don't match any filter combination, verify empty vec returned without errors\n\n2. **Multiple labels**: Create issue with labels [\"frontend\", \"backend\", \"urgent\"], filter by \"backend\" should include it\n\n3. **Case sensitivity**: Test whether \"Alice\" matches assignee filter \"alice\" - document expected behavior\n\n4. **Unicode support**: Test with:\n   - Japanese title: \"バグ修正\"\n   - Emoji label: \"🔥hotfix\"\n   - Accented assignee: \"José García\"","acceptance_criteria":"- [ ] Empty filter results - verify graceful handling when no issues match filters\n- [ ] Multiple labels - test filtering when an issue has multiple labels and filter matches one\n- [ ] Case sensitivity - verify label/assignee filters handle case correctly (e.g., \"Alice\" vs \"alice\")\n- [ ] Unicode/special characters - ensure filters work with non-ASCII issue titles, labels, assignees","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-29T19:06:15.222446228-06:00","updated_at":"2025-11-30T12:09:22.615118183-06:00","closed_at":"2025-11-30T12:09:22.615118183-06:00","source_repo":".","labels":["mcp","testing"]}
{"id":"rivets-8j9u","content_hash":"95f4084acedfb2f643581f4e2b713d4c8c21885397cee958e7524e8146ea3d7b","title":"Add lsp-types dependency","description":"Add `lsp-types = \"0.97\"` to Cargo.toml for LSP protocol types.\n\nThis provides all the types we need: InitializeParams, GotoDefinitionParams, Location, etc.","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:28:31.060353746-06:00","updated_at":"2026-01-28T17:51:18.09716471-06:00","closed_at":"2026-01-28T17:51:18.09716471-06:00","source_repo":".","labels":["lsp","phase2","tethys"],"dependencies":[{"issue_id":"rivets-8j9u","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:11.445403392-06:00","created_by":"dwalleck"}]}
{"id":"rivets-8yl","content_hash":"1cd5a7d0246d80096f850801a100fd9e3c72d2e3b6d1400f0aacd3c064869655","title":"Implement resilient streaming for JsonlReader","description":"Implement stream_resilient() method that continues reading despite malformed JSON lines, collecting warnings instead of returning errors.\n\nThis provides the same resilient loading behavior as in_memory::load_from_jsonl().","design":"```rust\nimpl\u003cR: AsyncRead + Unpin\u003e JsonlReader\u003cR\u003e {\n    pub fn stream_resilient\u003cT\u003e(\n        self\n    ) -\u003e (impl Stream\u003cItem = T\u003e, WarningCollector)\n    where\n        T: DeserializeOwned + 'static,\n    {\n        let collector = WarningCollector::new();\n        let collector_clone = collector.clone();\n        \n        let stream = futures::stream::unfold(\n            (self, collector_clone),\n            |(mut reader, collector)| async move {\n                loop {\n                    match reader.read_line().await {\n                        Ok(Some(value)) =\u003e return Some((value, (reader, collector))),\n                        Ok(None) =\u003e return None, // EOF\n                        Err(e) =\u003e {\n                            // Collect warning and continue\n                            collector.add(Warning::MalformedJson {\n                                line_number: reader.line_number,\n                                error: e.to_string(),\n                            });\n                            // Continue to next line\n                            continue;\n                        }\n                    }\n                }\n            },\n        );\n        \n        (stream, collector)\n    }\n}\n```","acceptance_criteria":"- stream_resilient() method implemented\n- Returns (Stream\u003cItem = T\u003e, WarningCollector)\n- Continues reading on malformed JSON\n- Warnings collected for each error\n- Stream yields only successfully parsed records\n- Unit tests verify resilient behavior\n- Integration test with mixed valid/invalid JSONL","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:15:55.303102489-06:00","updated_at":"2025-11-27T20:05:48.560873847-06:00","closed_at":"2025-11-27T20:05:48.560873847-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-8yl","depends_on_id":"rivets-dgt","type":"blocks","created_at":"2025-11-27T17:19:27.008485366-06:00","created_by":"dwalleck"}]}
{"id":"rivets-8zq","content_hash":"a70deecac7f2319355ad1a0fa46aab1b037121a0d3ac3769e7d30c4cab1fc2c4","title":"Refactor stringly-typed errors to structured error enums","description":"Improve error handling by replacing stringly-typed error variants with structured enums for better type safety, pattern matching, and debugging.\n\nCurrent issues identified:\n1. `anyhow::anyhow!()` used in domain layer (cli/execute.rs:60) - loses type info\n2. `Config(String)` catch-all in rivets/src/error.rs\n3. `Storage(String)` catch-all in rivets/src/error.rs\n4. `Mcp(String)` unused variant in rivets-mcp/src/error.rs\n5. Error context lost when InvalidFormat → Storage(msg) in jsonl.rs:140-144","design":"Replace generic string variants with structured error enums:\n\n```rust\n// ConfigError enum\n#[derive(Debug, Error)]\npub enum ConfigError {\n    #[error(\"Invalid prefix: {0}\")]\n    InvalidPrefix(String),\n    #[error(\"Parse error: {0}\")]\n    Parse(String),\n    #[error(\"IO error: {0}\")]\n    Io(#[from] std::io::Error),\n}\n\n// StorageError enum\n#[derive(Debug, Error)]\npub enum StorageError {\n    #[error(\"JSONL error: {0}\")]\n    Jsonl(#[from] rivets_jsonl::Error),\n    #[error(\"Validation failed: {0}\")]\n    Validation(String),\n    #[error(\"ID generation failed: {0}\")]\n    IdGeneration(String),\n}\n\n// Add ValidationError variant for common case\n#[error(\"Validation error: {field}: {reason}\")]\nValidation { field: \u0026'static str, reason: String }\n```\n\nFiles to modify:\n- crates/rivets/src/error.rs\n- crates/rivets/src/cli/execute.rs\n- crates/rivets/src/commands/init.rs\n- crates/rivets/src/storage/in_memory/trait_impl.rs\n- crates/rivets/src/storage/in_memory/jsonl.rs\n- crates/rivets-mcp/src/error.rs","acceptance_criteria":"- [ ] Replace `anyhow::anyhow!()` with typed error in cli/execute.rs:60\n- [ ] Create ConfigError enum and update Config variant to use it\n- [ ] Create StorageError enum and update Storage variant to use it\n- [ ] Add ValidationError variant for validation failures\n- [ ] Remove unused Mcp(String) variant from rivets-mcp\n- [ ] Update all call sites constructing Config(String) and Storage(String)\n- [ ] Preserve InvalidFormat semantic instead of downgrading to Storage\n- [ ] All tests pass\n- [ ] No new compiler warnings","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-30T22:49:52.900240044-06:00","updated_at":"2025-11-30T22:49:52.900240044-06:00","source_repo":".","labels":["error-handling","refactor","type-safety"]}
{"id":"rivets-95l","content_hash":"5dbd8e98e9df95793addaaa023fbf234efc925fe1d1da759d7f6b55f0f3cc9c6","title":"Add local quality gates using cargo-husky","description":"Add cargo husky and formatting, linting, and testing as pre-commit gates","design":"Implemented pre-commit hook combining beads sync and cargo quality gates:\n\n**Hook Location**: `.git/hooks/pre-commit`\n\n**Quality Checks**:\n1. Beads sync flush (if in beads workspace)\n2. `cargo fmt -- --check` - Code formatting\n3. `cargo clippy --all-targets --all-features -- -D warnings` - Linting\n4. `cargo test --quiet` - All tests\n\n**Stub Code Handling**: Added `#[allow(dead_code)]` attributes to placeholder types/functions to prevent false positives during development.\n\n**Manual Execution**: Hook can be tested by running `.git/hooks/pre-commit` directly.","acceptance_criteria":"✓ Pre-commit hook installed at .git/hooks/pre-commit\n✓ Runs cargo fmt check before commits\n✓ Runs cargo clippy with -D warnings before commits\n✓ Runs cargo test before commits\n✓ Integrates with existing beads sync hook\n✓ Documentation added to README.md\n✓ Successfully passes all checks on current codebase","status":"closed","priority":2,"issue_type":"task","assignee":"Claude","created_at":"2025-11-17T15:55:30.160010922-06:00","updated_at":"2025-11-17T16:04:29.413337487-06:00","closed_at":"2025-11-17T16:04:29.413337487-06:00","source_repo":"."}
{"id":"rivets-9d4g","content_hash":"a43362da61987f4beda3a11a5944cef37cf5eed0430499992156695fb2bd1f5e","title":"Fix: Use MAX_PRIORITY constant instead of hardcoded 4 in validation","description":"In domain/mod.rs, the validate() functions use hardcoded `4` instead of the `MAX_PRIORITY` constant:\n\n**Line 133 (Issue::validate):**\n```rust\nif self.priority \u003e 4 {  // Should use MAX_PRIORITY\n    return Err(format!(\"Priority {} exceeds maximum of 4\", self.priority));\n}\n```\n\n**Line 336 (NewIssue::validate):**\n```rust\nif self.priority \u003e 4 {  // Should use MAX_PRIORITY\n    return Err(...);\n}\n```\n\nBut the constant is defined at line 274:\n```rust\npub const MAX_PRIORITY: u8 = 4;\n```\n\n**Fix:** Replace hardcoded `4` with `MAX_PRIORITY` for consistency and maintainability.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T09:50:58.776992958-06:00","updated_at":"2025-12-28T15:28:52.791035223-06:00","closed_at":"2025-12-28T15:28:52.791035223-06:00","source_repo":".","labels":["bug","consistency","domain"],"dependencies":[{"issue_id":"rivets-9d4g","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:51:43.295107953-06:00","created_by":"dwalleck"}]}
{"id":"rivets-9e3u","content_hash":"386bc73dd6959a8540218c71d73fc335ce57b6f7d36ed0ed65d42d70178a19f4","title":"Style: Standardize use statement placement in execute.rs","description":"Some functions have imports at the top of the function body, others inline. This is inconsistent.\n\n**Example of current inconsistency:**\n```rust\npub async fn execute_init(args: \u0026InitArgs) -\u003e Result\u003c()\u003e {\n    use crate::commands::init;  // ← Inside function\n    ...\n}\n```\n\n**Options:**\n1. Move all module-level imports to the top of the file\n2. Keep scoped imports but document the convention\n\n**Recommendation:** Evaluate which approach is preferred for this codebase and apply consistently.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T09:37:55.496327128-06:00","updated_at":"2025-12-28T09:37:55.496327128-06:00","source_repo":".","labels":["execute.rs","style"],"dependencies":[{"issue_id":"rivets-9e3u","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:38:58.832888676-06:00","created_by":"dwalleck"}]}
{"id":"rivets-9el","content_hash":"8535a02943d9cc13c0ffac38a569464df86867b2d3d5353ca8382692f03074b2","title":"Add multi-select for batch operations","description":"Add interactive multi-select for batch operations:\n\n```\n$ rivets close --interactive\nSelect issues to close:\n\u003e [x] rivets-abc Fix authentication bug\n  [ ] rivets-def Add dark mode\n\u003e [x] rivets-ghi Update dependencies\n```\n\nUse dialoguer's MultiSelect widget.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:36:18.376893061-06:00","updated_at":"2025-11-30T12:36:18.376893061-06:00","source_repo":".","labels":["phase-2","ux"],"dependencies":[{"issue_id":"rivets-9el","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:36:18.379850736-06:00","created_by":"dwalleck"}]}
{"id":"rivets-9mh","content_hash":"23eb8d64cc0ef7eeb517fc395f23b24a75570491d8a5e8615295c6d0a6ac3e33","title":"Implement daemon with auto-sync and RPC server","description":"Implement the background daemon process that provides auto-export (dirty issues to JSONL), auto-import (JSONL to SQLite), and serves RPC requests.","design":"Based on beads internal/daemon/:\n\n**Daemon Responsibilities**:\n1. Auto-export with debouncing (5s default)\n2. Auto-import on JSONL mtime changes\n3. RPC server for CLI commands\n4. PID file management\n5. Graceful shutdown on signals\n\n**Lifecycle**:\n- Auto-start on first CLI command (if not running)\n- Background detached process\n- Socket cleanup on exit\n- Lock file prevents multiple daemons\n\n**Rust Stack**:\n- `tokio` runtime for async event loop\n- `notify` crate for file watching (optional)\n- `signal-hook` for signal handling\n- `daemonize` crate for backgrounding\n\n**Features**:\n- Debounced exports (collect changes, flush after timeout)\n- File watcher for imports\n- Health monitoring\n- Log rotation","acceptance_criteria":"- Daemon starts in background\n- Auto-export triggers after changes\n- Auto-import on JSONL modification\n- RPC server responds to requests\n- PID file created and managed\n- Graceful shutdown on SIGTERM\n- Multiple daemon prevention\n- Integration tests verify auto-sync behavior","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-17T16:16:07.330511078-06:00","updated_at":"2025-11-17T16:16:07.330511078-06:00","source_repo":"."}
{"id":"rivets-9o82","content_hash":"bad31f20acdd65c3c83fecf34654af899c9be91063b4f1d1a15af6be5239467d","title":"Add gated integration tests for LSP","description":"Add #[ignore] tests that require rust-analyzer installed:\n\n- lsp_resolves_trait_method_call\n- lsp_resolves_method_on_inferred_type\n- lsp_index_increases_resolution_count\n\nRun with: `cargo test --ignored`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T11:29:15.445807729-06:00","updated_at":"2026-01-28T20:01:00.8456917-06:00","closed_at":"2026-01-28T20:01:00.8456917-06:00","source_repo":".","labels":["lsp","phase2","tethys"],"dependencies":[{"issue_id":"rivets-9o82","depends_on_id":"rivets-1dza","type":"blocks","created_at":"2026-01-28T11:31:04.336873914-06:00","created_by":"dwalleck"},{"issue_id":"rivets-9o82","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:55.461821241-06:00","created_by":"dwalleck"}]}
{"id":"rivets-9s4","content_hash":"69c2d3820bb42e6b6ba5ef9c6558acabf8221871aa37af2b0eec0819f1c1a735","title":"Make blocked issues assertion more precise in tests","description":"In the MCP integration tests, the dependency chain test uses a loose assertion:\n\n```rust\n// Line 2716\nassert!(blocked.len() \u003e= 2, \"At least 2 issues should be blocked\");\n```\n\nIf the behavior is deterministic, consider making this assertion more precise (e.g., `assert_eq!(blocked.len(), 2)`) to catch regressions more reliably.\n\nLocation: `crates/rivets-mcp/tests/integration.rs:2716`","status":"open","priority":4,"issue_type":"chore","created_at":"2025-11-30T12:29:43.002652297-06:00","updated_at":"2025-11-30T12:29:43.002652297-06:00","source_repo":".","labels":["pr-feedback","testing"]}
{"id":"rivets-9tff","content_hash":"90d9e51b8d741824fbf00144d01c03b6264c9c1a547265837f0bb60103844bf6","title":"Refactor: Split execute_dep and execute_label into smaller functions","description":"Per the principle of keeping functions focused and manageable:\n\n| Function | Lines | Issue |\n|----------|-------|-------|\n| execute_dep | ~174 | Too long, handles 4 different actions |\n| execute_label | ~234 | Too long, handles 4 different actions |\n\n**Recommendation:**\n- Split execute_dep into: execute_dep_add, execute_dep_remove, execute_dep_list, execute_dep_tree\n- Split execute_label into: execute_label_add, execute_label_remove, execute_label_list, execute_label_list_all\n\nEach action handler should be a separate function called from the main dispatch function.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T09:37:46.704194257-06:00","updated_at":"2025-12-28T13:14:11.042762217-06:00","closed_at":"2025-12-28T13:14:11.042762217-06:00","source_repo":".","labels":["execute.rs","refactor"],"dependencies":[{"issue_id":"rivets-9tff","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:38:52.982072995-06:00","created_by":"dwalleck"}]}
{"id":"rivets-aaw","content_hash":"6c38a9d00681c597aaeb9ab4cbc7dda5aa8d837eb9928748189aa3ed3516cfb3","title":"Add compact vs detailed view modes","description":"Add view modes for issue listing:\n\nCompact (default): Single line per issue\n```\n[ ] rivets-abc Fix auth bug P1 @alice\n[\u003e] rivets-def Add OAuth P2\n```\n\nDetailed (--detailed/-d): Multi-line with description preview\n```\n[ ] rivets-abc Fix authentication bug\n    P1 | task | @alice | urgent, backend\n    Authentication fails when token expires...\n```","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:36:30.01994023-06:00","updated_at":"2025-11-30T12:36:30.01994023-06:00","source_repo":".","labels":["phase-2","ux"],"dependencies":[{"issue_id":"rivets-aaw","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:36:30.050137506-06:00","created_by":"dwalleck"}]}
{"id":"rivets-aic","content_hash":"902e3ee18d8024bd336f49e7db7fb1be6ca266338ed3f69fdcb2ab32a997c5a2","title":"Add version field to RivetsConfig for migration support","description":"Add a version field to config.yaml to support future config format migrations. This allows the application to detect older config formats and migrate them automatically.","design":"Add a version field to RivetsConfig:\\n\\n```yaml\\nversion: 1\\nissue-prefix: proj\\nstorage:\\n  backend: memory\\n  data_file: .rivets/issues.jsonl\\n```\\n\\nImplementation:\\n1. Add `version: u32` field to RivetsConfig (default to 1)\\n2. On load, check version and apply migrations if needed\\n3. Migrations should be idempotent and well-tested\\n4. Consider semver for version if schema changes significantly\\n\\nThis enables:\\n- Backwards compatibility with older configs\\n- Automatic migration on first run after upgrade\\n- Clear error messages for unsupported versions","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T20:51:51.756750966-06:00","updated_at":"2025-11-29T20:51:51.756750966-06:00","source_repo":".","labels":["config","migration"],"dependencies":[{"issue_id":"rivets-aic","depends_on_id":"rivets-5an","type":"related","created_at":"2025-11-29T20:52:01.89702034-06:00","created_by":"dwalleck"}]}
{"id":"rivets-anc","content_hash":"e75bf60842bd2a642b7404133bfb10c99f8f8547eb90c841b1ab555fbd147403","title":"Improve publishing instructions visibility in README","description":"The crates.io publishing instructions mention waiting for indexing after the code block. Consider moving or inlining this note with the commands for better visibility.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T20:29:24.701631594-06:00","updated_at":"2025-12-17T20:29:24.701631594-06:00","source_repo":".","labels":["documentation"]}
{"id":"rivets-ans","content_hash":"eb1ab2db3b8b988aadaddef819b15d624bd4938285a75cf2c02a9ef5918f5422","title":"Convert roundtrip.rs to rstest","description":"Replace 11 similar roundtrip tests with parameterized #[rstest] test. Create fixture for buffer setup pattern.\n\nFile: crates/rivets-jsonl/tests/roundtrip.rs\nEstimated reduction: ~150 lines → ~50 lines\n\nThis is the highest-impact conversion - the buffer setup pattern is repeated 11 times.","acceptance_criteria":"- All roundtrip tests converted to use #[rstest] with #[case] parameterization\n- Buffer setup extracted to fixture or helper\n- All tests pass\n- Significant line count reduction achieved","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T18:56:19.405900112-06:00","updated_at":"2025-11-28T20:08:24.172376961-06:00","closed_at":"2025-11-28T20:08:24.172376961-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-ans","depends_on_id":"rivets-xi4","type":"blocks","created_at":"2025-11-28T18:56:19.407881145-06:00","created_by":"dwalleck"},{"issue_id":"rivets-ans","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T18:57:21.343282678-06:00","created_by":"dwalleck"}]}
{"id":"rivets-azn","content_hash":"08d6b95be302f095481d6773f7e9548e2d26d02d9ab7c4c81bc92906a809cd7b","title":"Document rivets architecture and API design","description":"Create comprehensive architecture documentation for rivets including crate structure, module organization, data flow diagrams, and public API documentation.","design":"Create docs/architecture.md covering:\n\n**1. System Architecture**:\n- Crate dependency graph\n- Component interaction diagram\n- Data flow (CLI → RPC → Storage → JSONL)\n\n**2. Storage Layer**:\n- Database schema diagram\n- Table relationships\n- Index strategy\n- Migration system\n\n**3. ID Generation**:\n- Hash algorithm explanation\n- Collision handling\n- Hierarchical ID format\n\n**4. Dependency System**:\n- 4 dependency types\n- Cycle detection algorithm\n- Ready work calculation\n\n**5. JSONL Sync**:\n- Export flow diagram\n- Import flow diagram\n- Conflict resolution\n\n**6. RPC Protocol**:\n- Message format\n- Operation list\n- Error handling\n\nUse mermaid diagrams for visual clarity","acceptance_criteria":"- architecture.md created in docs/\n- All major components documented\n- Mermaid diagrams included\n- Data flow clearly explained\n- API surfaces documented\n- Design decisions justified\n- Future extensibility noted","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-17T16:16:47.84827462-06:00","updated_at":"2025-11-27T18:37:44.421525809-06:00","closed_at":"2025-11-27T18:37:44.421525809-06:00","source_repo":"."}
{"id":"rivets-azq","content_hash":"854322476b0104a31dc4a0016c2b7a527cf40fa429bc3a6eb264c9c2fba45f02","title":"Support multiple issue IDs in update/close/show commands","description":"Modify update, close, and show commands to accept multiple issue IDs. Examples:\\n- rivets update id1 id2 id3 --status in_progress\\n- rivets close id1 id2 --reason 'Batch completion'\\n- rivets show id1 id2 --json","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T18:23:45.022427513-06:00","updated_at":"2025-12-27T18:38:18.113840018-06:00","closed_at":"2025-12-27T18:38:18.113840018-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-azq","depends_on_id":"rivets-v3s","type":"parent-child","created_at":"2025-12-27T18:23:45.052141726-06:00","created_by":"dwalleck"}]}
{"id":"rivets-b1n","content_hash":"8a55900d447dff49576f6f3c4e3673b9ae9de6a88546eea72e3e77f565bba7ee","title":"Implement atomic write functionality","description":"Implement write_jsonl_atomic() convenience function that writes to a temp file then atomically renames it. This provides crash safety for JSONL persistence.\n\nUses the temp file + rename pattern for atomic writes on POSIX systems.","design":"```rust\nuse std::path::Path;\nuse tokio::fs::File;\n\npub async fn write_jsonl_atomic\u003cT, P\u003e(path: P, values: \u0026[T]) -\u003e Result\u003c()\u003e\nwhere\n    T: Serialize,\n    P: AsRef\u003cPath\u003e,\n{\n    let path = path.as_ref();\n    let temp_path = path.with_extension(\"tmp\");\n    \n    // Write to temp file\n    {\n        let file = File::create(\u0026temp_path).await?;\n        let mut writer = JsonlWriter::new(file);\n        writer.write_all(values.iter()).await?;\n        writer.flush().await?;\n    }\n    \n    // Atomic rename\n    tokio::fs::rename(\u0026temp_path, path).await?;\n    \n    Ok(())\n}\n```","acceptance_criteria":"- write_jsonl_atomic() function implemented\n- Writes to temp file with .tmp extension\n- Atomically renames temp file to target path\n- Temp file cleaned up on success\n- Proper error handling if write fails\n- Integration test verifies atomicity\n- Test verifies crash during write leaves original file intact","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:14:57.33389314-06:00","updated_at":"2025-11-27T19:04:56.754496296-06:00","closed_at":"2025-11-27T19:04:56.754496296-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-b1n","depends_on_id":"rivets-6pi","type":"blocks","created_at":"2025-11-27T17:19:03.964270123-06:00","created_by":"dwalleck"}]}
{"id":"rivets-bi2","content_hash":"22f5b811d2d5acce3b7408c7f97ab19e516b08a28c04f3bf1617a76f4ddae53f","title":"Implement RPC system for daemon communication","description":"Implement the RPC server/client system using Unix domain sockets (or named pipes on Windows) for CLI-daemon communication with JSON-RPC protocol.","design":"Based on beads internal/rpc/:\n\n**Architecture**:\n- Server runs in daemon process\n- Client in each CLI invocation\n- Transport: Unix sockets (Linux/macOS), Named pipes (Windows)\n- Protocol: JSON-RPC over newline-delimited messages\n\n**Operations Exposed**:\n- Full CRUD (create, read, update, delete)\n- Queries (list, ready, blocked, stats)\n- Import/export triggers\n- Health checks\n\n**Rust Stack**:\n- `tokio` for async I/O\n- `serde_json` for JSON-RPC\n- `interprocess` crate for IPC\n- Custom error types for RPC failures\n\n**Features**:\n- Version compatibility checks\n- Connection timeouts\n- Graceful shutdown\n- Request/response correlation","acceptance_criteria":"- RPC server accepts connections\n- RPC client can call server methods\n- JSON-RPC protocol implemented\n- All CRUD operations exposed\n- Health check endpoint works\n- Connection errors handled gracefully\n- Concurrent requests supported\n- Integration tests for RPC round-trips","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-17T16:16:07.159548647-06:00","updated_at":"2025-11-17T16:16:07.159548647-06:00","source_repo":"."}
{"id":"rivets-bsp","content_hash":"2ddc9fbe18f8ec129286a4931e364cc2f251434f59c315118b3ca0b3e0b36620","title":"Implement core CLI commands (create, list, show, update, close, delete)","description":"Implement the essential CLI commands for basic issue management using clap for argument parsing. These are the most frequently used commands.","design":"Based on beads cmd/bd/:\n\n**Commands**:\n1. **create**: Create new issues (interactive or flags)\n2. **list**: Query issues with filters (status, priority, assignee, labels, etc.)\n3. **show**: Display full issue details with dependencies\n4. **update**: Modify issue fields\n5. **close**: Mark issues as closed with reason\n6. **delete**: Remove issues (with cascade confirmation)\n\n**Clap Structure**:\n```rust\n#[derive(Parser)]\nenum Commands {\n    Create(CreateArgs),\n    List(ListArgs),\n    Show(ShowArgs),\n    Update(UpdateArgs),\n    Close(CloseArgs),\n    Delete(DeleteArgs),\n}\n```\n\n**Features**:\n- Interactive prompts for missing data\n- JSON output mode (--json flag)\n- Batch operations where applicable\n- Validation and error messages","acceptance_criteria":"- All 6 commands implemented and working\n- --help shows usage for each command\n- Filters work correctly (status, priority, etc.)\n- JSON output mode functional\n- Interactive mode for create command\n- Error messages are clear and helpful\n- Integration tests verify command behavior","notes":"## Implementation Notes (2025-11-29)\n\n### Completed Work\n\nAll 6 core CLI commands have been implemented and integrated with the storage trait:\n\n1. **create** - Creates new issues with full option support\n   - Interactive prompt for title if not provided\n   - Supports all fields: title, description, priority, type, assignee, labels, design, acceptance criteria\n   - Dependency specification via --deps flag\n\n2. **list** - Queries issues with filters\n   - Status filter with in_progress alias support\n   - Priority, type, assignee, label filters\n   - Sorting: priority, newest, oldest, updated\n   - Limit option\n\n3. **show** - Displays full issue details\n   - Shows all fields with formatted output\n   - Displays dependencies and dependents\n   - Supports JSON output mode\n\n4. **update** - Modifies issue fields\n   - All fields updateable\n   - Status transitions supported\n\n5. **close** - Marks issues as closed\n   - Custom reason support\n   - Updates status to closed\n\n6. **delete** - Removes issues\n   - Interactive confirmation by default\n   - --force flag to skip confirmation\n   - Proper error on dependents\n\n### Additional Commands\n\nAlso implemented bonus commands:\n- **ready** - Find ready-to-work issues (no blockers)\n- **dep** - Dependency management (add/remove/list)\n- **blocked** - Show blocked issues\n- **stats** - Project statistics\n\n### Architecture\n\n- Created `App` struct for storage lifecycle management\n- Created `output` module for consistent formatting (text/JSON modes)\n- Commands find rivets root by searching up directory tree\n- Auto-save after mutations\n\n### Testing\n\n- 33 integration tests using rstest\n- All tests pass\n- Tests properly initialize repositories before testing","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T16:16:06.835605991-06:00","updated_at":"2025-11-29T21:09:14.214873854-06:00","closed_at":"2025-11-29T21:09:14.214873854-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-bsp","depends_on_id":"rivets-cgl","type":"blocks","created_at":"2025-11-17T17:02:47.758985777-06:00","created_by":"daemon"}]}
{"id":"rivets-bz5","content_hash":"7e3855ad9c10eef8a05a609878fe3a1c94ee014b624ed079260bfac97f0f7958","title":"Implement InMemoryStorage with petgraph for dependency graph","description":"Create the InMemoryStorage implementation using HashMap for issues and petgraph for the dependency graph. This is the first storage backend and enables fast MVP development.","design":"Based on storage trait from rivets-0gc, implement in-memory backend:\n\n**Structure (following rivets-0gc architecture):**\n\n```rust\n// Private inner storage (not thread-safe)\nstruct InMemoryStorageInner {\n    issues: HashMap\u003cIssueId, Issue\u003e,\n    graph: DiGraph\u003cIssueId, DependencyType\u003e,  // petgraph\n    node_map: HashMap\u003cIssueId, NodeIndex\u003e,\n}\n\n// Public thread-safe type alias\npub type InMemoryStorage = Arc\u003cMutex\u003cInMemoryStorageInner\u003e\u003e;\n```\n\n**Async Trait Implementation (blocking operations in async methods):**\n\n```rust\n#[async_trait]\nimpl IssueStorage for InMemoryStorage {\n    async fn create(\u0026mut self, new: NewIssue) -\u003e Result\u003cIssue\u003e {\n        let mut inner = self.lock().await;\n        let id = generate_hash_id(\u0026new);  // Uses rivets-x1e\n        let issue = Issue::from(new, id.clone());\n        inner.issues.insert(id.clone(), issue.clone());\n        let node = inner.graph.add_node(id.clone());\n        inner.node_map.insert(id.clone(), node);\n        Ok(issue)\n    }\n    \n    async fn has_cycle(\u0026self, from: \u0026IssueId, to: \u0026IssueId) -\u003e Result\u003cbool\u003e {\n        let inner = self.lock().await;\n        // Use petgraph's has_path_connecting\n        let from_node = inner.node_map.get(from)\n            .ok_or_else(|| Error::IssueNotFound(from.clone()))?;\n        let to_node = inner.node_map.get(to)\n            .ok_or_else(|| Error::IssueNotFound(to.clone()))?;\n        Ok(algo::has_path_connecting(\u0026inner.graph, *to_node, *from_node, None))\n    }\n    \n    async fn ready_to_work(\u0026self, filter: Option\u003c\u0026IssueFilter\u003e) -\u003e Result\u003cVec\u003cIssue\u003e\u003e {\n        let inner = self.lock().await;\n        // Graph traversal to find issues with no blocking dependencies\n        // Filter by status=open or in_progress\n        // Check all incoming edges for blocking dependencies\n        // Return issues with no blockers\n        // ... implementation\n    }\n}\n```\n\n**Key Implementation Notes:**\n- Use `Arc::new(Mutex::new(InMemoryStorageInner { ... }))` for initialization\n- Lock mutex for all operations: `let inner = self.lock().await;`\n- All petgraph and HashMap operations are blocking (acceptable for MVP)\n- Graph operations use petgraph::algo for cycle detection and traversal\n- Maintain node_map synchronization when adding/removing issues\n\n**Dependencies**: `petgraph = \\\"0.6\\\"` for graph algorithms, `async-trait` for trait implementation, `tokio` for Mutex","acceptance_criteria":"- InMemoryStorage implements all trait methods\n- Uses petgraph for dependency graph\n- Cycle detection working with graph algorithms\n- Ready work calculation via graph traversal\n- All CRUD operations functional\n- Unit tests for all operations\n- Benchmark: 1000 issues in \u003c10ms","notes":"## Clarifications\n\n### Session 2025-11-17\n\n- Q: The task design shows `pub struct InMemoryStorage` but rivets-0gc specifies `InMemoryStorageInner` wrapped in `Arc\u003cMutex\u003c\u003e\u003e`. Which approach should this task implement? → A: Follow rivets-0gc: implement InMemoryStorageInner + Arc\u003cMutex\u003c\u003e\u003e wrapper (ensures thread safety, matches architecture from trait design)\n- Q: The task shows synchronous trait methods (`fn create_issue`) but rivets-0gc defines async trait methods (`async fn create`). How should InMemoryStorage implement the trait? → A: Use blocking operations in async methods (simple for MVP, matches Phase 1 approach from rivets-0gc)","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T16:41:41.594099121-06:00","updated_at":"2025-11-17T20:58:07.492885986-06:00","closed_at":"2025-11-17T20:58:07.492885986-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-bz5","depends_on_id":"rivets-0gc","type":"blocks","created_at":"2025-11-17T16:41:41.595147022-06:00","created_by":"daemon"},{"issue_id":"rivets-bz5","depends_on_id":"rivets-x1e","type":"blocks","created_at":"2025-11-17T16:41:41.595557209-06:00","created_by":"daemon"},{"issue_id":"rivets-bz5","depends_on_id":"rivets-06w","type":"blocks","created_at":"2025-11-17T16:46:29.597245914-06:00","created_by":"daemon"}]}
{"id":"rivets-c0p","content_hash":"ac1379bf16c693c35b8d8f928a5adfd3dccd36f1cddd7ac6cf32fd7b8ce7614e","title":"Convert resilient_loading.rs to rstest","description":"Extract common fixtures for temp file creation. Parameterize error frequency tests with #[case].\n\nFile: crates/rivets-jsonl/tests/resilient_loading.rs","acceptance_criteria":"- Temp file creation extracted to fixture\n- Error frequency tests parameterized with #[case]\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T18:56:25.053725065-06:00","updated_at":"2025-11-28T20:09:12.153724641-06:00","closed_at":"2025-11-28T20:09:12.153724641-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-c0p","depends_on_id":"rivets-xi4","type":"blocks","created_at":"2025-11-28T18:56:25.056330687-06:00","created_by":"dwalleck"},{"issue_id":"rivets-c0p","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T18:57:26.934530574-06:00","created_by":"dwalleck"}]}
{"id":"rivets-cbm","content_hash":"299118a479b13bd6a08c0c452597dc54c65d36cfa2e34dcca514c71ef3c6fb59","title":"Add vim-style keyboard navigation to TUI","description":"Implement vim-style keyboard navigation:\n- h/j/k/l for movement\n- / for search\n- c for create\n- e for edit\n- d for delete (with confirmation)\n- Enter for details\n- Space for toggle status\n- Tab for switch views\n- q for quit\n- ? for help\n\nAlso support arrow keys and mouse.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:37:24.109173058-06:00","updated_at":"2025-11-30T12:37:24.109173058-06:00","source_repo":".","labels":["phase-3","tui"],"dependencies":[{"issue_id":"rivets-cbm","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:37:24.139491255-06:00","created_by":"dwalleck"}]}
{"id":"rivets-ceg","content_hash":"b02a1d42543814c3ebbb0f4623567232357ea763d9885018a0aae655bf36e621","title":"Implement CLI argument parsing with clap validation","description":"Extend the CLI skeleton (rivets-p7v) with complete argument parsing, validation, error handling, and help text generation for all commands.\n\nThis task implements the argument parsing layer that sits between the CLI entry point and command execution. Each command gets proper args structs with validation.\n\n**Commands to implement**:\n- create: --title, --description, --priority, --type, --assignee, --deps\n- list: --status, --priority, --type, --assignee, --label, --limit\n- show: \u003cissue-id\u003e, --json\n- update: \u003cissue-id\u003e, --title, --description, --status, --priority, --assignee\n- close: \u003cissue-id\u003e, --reason\n- delete: \u003cissue-id\u003e, --force\n- init: --prefix, --quiet\n- ready: --assignee, --limit, --sort\n\n**Features**:\n- Validation for all flag values (priority 0-4, valid status enum, etc.)\n- Helpful error messages with suggestions\n- Auto-generated help text via clap derives\n- Subcommand structure with shared global flags\n- Interactive prompts for missing required fields (create command)","design":"Use clap derive API for argument parsing:\n\n```rust\nuse clap::{Parser, Subcommand, ValueEnum};\n\n#[derive(Parser)]\n#[command(name = \"rivets\")]\n#[command(author, version, about, long_about = None)]\npub struct Cli {\n    /// Output in JSON format\n    #[arg(long, global = true)]\n    pub json: bool,\n    \n    #[command(subcommand)]\n    pub command: Option\u003cCommands\u003e,\n}\n\n#[derive(Subcommand)]\npub enum Commands {\n    /// Initialize a new rivets repository\n    Init(InitArgs),\n    \n    /// Create a new issue\n    Create(CreateArgs),\n    \n    /// List issues with optional filters\n    List(ListArgs),\n    \n    /// Show detailed issue information\n    Show(ShowArgs),\n    \n    /// Update an existing issue\n    Update(UpdateArgs),\n    \n    /// Close an issue\n    Close(CloseArgs),\n    \n    /// Delete an issue\n    Delete(DeleteArgs),\n    \n    /// Show ready-to-work issues\n    Ready(ReadyArgs),\n}\n\n#[derive(Parser)]\npub struct CreateArgs {\n    /// Issue title\n    #[arg(short, long)]\n    pub title: Option\u003cString\u003e,\n    \n    /// Issue description\n    #[arg(short, long)]\n    pub description: Option\u003cString\u003e,\n    \n    /// Priority (0-4)\n    #[arg(short, long, value_parser = clap::value_parser!(u8).range(0..=4))]\n    pub priority: Option\u003cu8\u003e,\n    \n    /// Issue type\n    #[arg(short = 't', long)]\n    pub issue_type: Option\u003cIssueTypeArg\u003e,\n    \n    /// Assignee\n    #[arg(short, long)]\n    pub assignee: Option\u003cString\u003e,\n}\n\n#[derive(ValueEnum, Clone)]\npub enum IssueTypeArg {\n    Bug,\n    Feature,\n    Task,\n    Epic,\n    Chore,\n}\n\n// ... more arg structs\n```\n\n**Validation**:\n- Priority range checking (0-4)\n- Issue ID format validation\n- Enum value validation via ValueEnum\n- Required vs optional field handling\n- Custom validators for complex types","acceptance_criteria":"- All CLI commands have argument structs defined\n- Clap derive attributes configured correctly\n- Priority validation enforces 0-4 range\n- Issue ID validation checks format\n- Enum arguments use ValueEnum for type safety\n- Help text auto-generated and informative\n- Error messages are clear with examples\n- Unit tests for argument parsing\n- Integration tests verify --help output\n- Invalid arguments produce helpful error messages","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T17:04:11.868192762-06:00","updated_at":"2025-11-28T08:22:51.079089079-06:00","closed_at":"2025-11-28T08:22:51.079089079-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-ceg","depends_on_id":"rivets-p7v","type":"blocks","created_at":"2025-11-17T17:04:17.995576498-06:00","created_by":"daemon"}]}
{"id":"rivets-cej","content_hash":"1f0b0a73af96e91f23823ae4e70f52aa46024bd6d89b0c368139bac425dc2e2c","title":"Implement stale command","description":"Add 'stale' command to find issues not updated recently.\\n\\nFlags:\\n- --days N (default: 30)\\n- --status \u003cstatus\u003e (filter by status)\\n- --limit N\\n- --json\\n\\nExample: rivets stale --days 30 --status in_progress --json","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T18:23:56.751583711-06:00","updated_at":"2025-12-27T18:44:18.799743031-06:00","closed_at":"2025-12-27T18:44:18.799743031-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-cej","depends_on_id":"rivets-v3s","type":"parent-child","created_at":"2025-12-27T18:23:56.783158083-06:00","created_by":"dwalleck"}]}
{"id":"rivets-cfx","content_hash":"3523b2a640fd442eb73d18623a572188d457c3d53d93e598b8f70de64c8d73cc","title":"Implement MCP server with stdio transport","description":"Implement the basic MCP server skeleton using rmcp:\n- main.rs entry point with tokio runtime\n- ServerHandler implementation\n- stdio transport setup\n- Graceful shutdown handling","design":"**Tool Registration Pattern:**\nUse rmcp's tool registration with handler functions:\n```rust\nserver\n    .tool(\"set_context\", |params| {\n        // Deserialize params, call tools.set_context()\n    })\n    .tool(\"ready\", |params| {\n        // Call tools.ready()\n    })\n    // ... etc\n```\n\n**Schema Generation:**\nUse the `JsonSchema` derives in `models.rs` to auto-generate tool input/output schemas. rmcp can use these for MCP tool discovery.\n\n**Server Structure:**\n```rust\npub struct RivetsServer {\n    context: Arc\u003cRwLock\u003cContext\u003e\u003e,\n    tools: Tools,\n}\n\nimpl ServerHandler for RivetsServer {\n    // Tool dispatch\n}\n```\n\n**Transport:**\n- stdio only for MVP\n- Use rmcp's stdio transport utilities","acceptance_criteria":"- [ ] MCP server starts with stdio transport\n- [ ] ServerHandler implementation compiles\n- [ ] Graceful shutdown on SIGINT/SIGTERM\n- [ ] Unit tests: server creation, basic lifecycle","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T19:16:05.632602712-06:00","updated_at":"2025-11-28T23:29:56.252223505-06:00","closed_at":"2025-11-28T23:29:56.252223505-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-cfx","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:17:23.105819249-06:00","created_by":"dwalleck"},{"issue_id":"rivets-cfx","depends_on_id":"rivets-rg0","type":"blocks","created_at":"2025-11-28T19:18:24.439206386-06:00","created_by":"dwalleck"}]}
{"id":"rivets-cgl","content_hash":"bc7742c1d1d7ac8e6c31eb555da4d79c633deff7b59b20aa6e4a63de0dc04ab0","title":"Integrate storage trait with CLI commands","description":"Update CLI commands to use the storage trait instead of direct storage access. Add storage initialization and lifecycle management.","design":"Update rivets CLI to use async storage trait (following rivets-0gc architecture):\n\n**Async CLI Structure:**\n\n```rust\npub struct App {\n    storage: Box\u003cdyn IssueStorage\u003e,\n    config: Config,\n}\n\nimpl App {\n    pub async fn new(config: Config) -\u003e Result\u003cSelf\u003e {\n        let storage = Self::create_storage(\u0026config).await?;\n        Ok(Self { storage, config })\n    }\n    \n    async fn create_storage(config: \u0026Config) -\u003e Result\u003cBox\u003cdyn IssueStorage\u003e\u003e {\n        match config.storage_backend {\n            StorageBackend::InMemory =\u003e {\n                let storage = if let Some(path) = \u0026config.data_file {\n                    if path.exists() {\n                        let (storage, warnings) = InMemoryStorage::load_from_jsonl(path).await?;\n                        if !warnings.is_empty() {\n                            eprintln!(\"Warning: Loaded with {} warnings. Check logs.\", warnings.len());\n                        }\n                        storage\n                    } else {\n                        InMemoryStorage::new()\n                    }\n                } else {\n                    InMemoryStorage::new()\n                };\n                Ok(Box::new(storage))\n            }\n            // Future: PostgreSQL, SQLite\n        }\n    }\n}\n```\n\n**Update IssueStorage trait to include save():**\n\nAdd to rivets-0gc trait definition:\n```rust\n#[async_trait]\npub trait IssueStorage: Send + Sync {\n    // ... existing methods ...\n    \n    /// Persist storage state (for backends that need explicit persistence)\n    async fn save(\u0026self) -\u003e Result\u003c()\u003e;\n}\n```\n\n**Command execution with auto-save:**\n\n```rust\nimpl Commands {\n    pub async fn execute(\u0026self, app: \u0026mut App) -\u003e Result\u003c()\u003e {\n        match self {\n            Commands::Create(args) =\u003e {\n                let issue = app.storage.create(args.into()).await?;\n                app.storage.save().await?;  // Auto-save after mutation\n                println!(\"Created: {}\", issue.id);\n            }\n            Commands::Update(args) =\u003e {\n                let issue = app.storage.update(\u0026args.id, args.into()).await?;\n                app.storage.save().await?;  // Auto-save after mutation\n                println!(\"Updated: {}\", issue.id);\n            }\n            Commands::Close(args) =\u003e {\n                app.storage.delete(\u0026args.id).await?;\n                app.storage.save().await?;  // Auto-save after mutation\n                println!(\"Closed: {}\", args.id);\n            }\n            Commands::Delete(args) =\u003e {\n                app.storage.delete(\u0026args.id).await?;\n                app.storage.save().await?;  // Auto-save after mutation\n                println!(\"Deleted: {}\", args.id);\n            }\n            Commands::List(args) =\u003e {\n                let filter = args.into();\n                let issues = app.storage.list(\u0026filter).await?;\n                // ... display (no save needed for read-only)\n            }\n            Commands::Show(args) =\u003e {\n                let issue = app.storage.get(\u0026args.id).await?;\n                // ... display (no save needed for read-only)\n            }\n            // ... other commands\n        }\n        Ok(())\n    }\n}\n```\n\n**Main.rs with async runtime:**\n\n```rust\n#[tokio::main(flavor = \"current_thread\")]\nasync fn main() -\u003e Result\u003c()\u003e {\n    let cli = Cli::parse();\n    let config = Config::load().await?;\n    let mut app = App::new(config).await?;\n    \n    cli.command.execute(\u0026mut app).await?;\n    \n    Ok(())\n}\n```\n\n**Backend-specific save() implementations:**\n\n```rust\n// InMemoryStorage\n#[async_trait]\nimpl IssueStorage for InMemoryStorage {\n    async fn save(\u0026self) -\u003e Result\u003c()\u003e {\n        if let Some(path) = \u0026self.data_file {\n            self.save_to_jsonl(path).await?;\n        }\n        Ok(())\n    }\n}\n\n// PostgreSQL (future)\n#[async_trait]\nimpl IssueStorage for PostgresStorage {\n    async fn save(\u0026self) -\u003e Result\u003c()\u003e {\n        Ok(())  // No-op: PostgreSQL commits on each operation\n    }\n}\n```\n\n**Key Design Points:**\n- All App methods are async to match storage trait\n- save() added to IssueStorage trait (each backend implements appropriately)\n- Auto-save after every mutating command (create, update, delete, close)\n- Read-only commands (list, show) don't trigger save\n- JSONL load warnings displayed to user\n- Uses tokio current-thread runtime as specified in rivets-0gc","acceptance_criteria":"- CLI uses storage trait, not concrete type\n- Storage initialized on CLI startup\n- Data loaded from JSONL at startup (if exists)\n- Data saved to JSONL on exit\n- All commands work via trait methods\n- Error handling for storage failures\n- Integration tests with InMemoryStorage","notes":"## Clarifications\n\n### Session 2025-11-17\n\n- Q: The storage trait from rivets-0gc is async, but the design shows synchronous App methods. Should the CLI App and command execution be async? → A: Make App and command execution async (matches storage trait pattern, use #[tokio::main] as specified in rivets-0gc)\n- Q: With InMemoryStorage as Arc\u003cMutex\u003cInMemoryStorageInner\u003e\u003e, the design's downcast pattern won't work. How should the CLI trigger save on exit for in-memory backend? → A: Add save() method to IssueStorage trait (trait-based approach, each backend implements appropriately, works with Box\u003cdyn IssueStorage\u003e)\n- Q: When should the in-memory backend persist to JSONL - only on exit, after every command, or periodically? → A: Save after every mutating command (resilient to crashes, better durability guarantee)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-17T16:41:42.102424622-06:00","updated_at":"2025-11-29T21:09:08.310600427-06:00","closed_at":"2025-11-29T21:09:08.310600427-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-cgl","depends_on_id":"rivets-0gc","type":"blocks","created_at":"2025-11-17T16:46:29.880494761-06:00","created_by":"daemon"},{"issue_id":"rivets-cgl","depends_on_id":"rivets-bz5","type":"blocks","created_at":"2025-11-17T16:46:29.964261698-06:00","created_by":"daemon"},{"issue_id":"rivets-cgl","depends_on_id":"rivets-l66","type":"blocks","created_at":"2025-11-17T17:02:47.898552194-06:00","created_by":"daemon"}]}
{"id":"rivets-cjz","content_hash":"4780e1423e35a5771d0091920d44f135dda7eb18aed6081462a26fcece79fed8","title":"Replace println! with tracing::info! in CLI commands","description":"The execute_init function uses println! for user output. Consider using tracing::info! for more flexible logging that can be configured at runtime.","design":"Replace direct println! calls in CLI command execution with tracing macros:\\n\\n- Use tracing::info! for success messages\\n- Use tracing::warn! for warnings\\n- Use tracing::error! for errors\\n\\nThis enables:\\n- Structured logging\\n- Log level filtering\\n- Integration with observability tools\\n- Consistent logging across all commands","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T20:48:28.716762764-06:00","updated_at":"2025-11-29T20:48:28.716762764-06:00","source_repo":".","labels":["cli","observability"],"dependencies":[{"issue_id":"rivets-cjz","depends_on_id":"rivets-0dw","type":"related","created_at":"2025-11-29T20:48:45.50307193-06:00","created_by":"dwalleck"}]}
{"id":"rivets-cr9","content_hash":"9481cabfce081d1d49c19435f2ae73ae4686d884970b104ae2b2a57f9ece1636","title":"Research beads project and create tasks to implement the project in rust as rivets","description":"We are going to convert the project beads to rust and call it rivets. You should have context to the beads project. Create all needed research and development tasks that you become aware of in beads so that we can begin development","design":"## Beads Research Complete\n\nConducted comprehensive analysis of beads codebase (~19,243 LOC storage layer alone). \n\n**Key Findings**:\n- Hash-based ID generation (SHA256 + base36, adaptive 4-6 chars)\n- 4 dependency types (blocks, related, parent-child, discovered-from)  \n- Recursive CTE algorithms for cycle detection and ready work\n- SQLite with 14 tables, WAL mode, foreign key constraints\n- JSONL import/export with content hash deduplication\n- RPC system (JSON-RPC over Unix sockets)\n- Background daemon with auto-sync\n\n**Created 13 Implementation Tasks**:\n1. rivets-x1e: Hash-based ID generation\n2. rivets-0gc: SQLite storage layer  \n3. rivets-6op: Dependency system with cycle detection\n4. rivets-qeb: Ready work algorithm\n5. rivets-x51: JSONL import/export\n6. rivets-bsp: Core CLI commands\n7. rivets-xy9: Configuration system\n8. rivets-bi2: RPC system\n9. rivets-9mh: Daemon process\n10. rivets-37y: Labels and comments\n11. rivets-6tl: Filtering and queries\n12. rivets-4l2: Init command\n13. rivets-azn: Architecture documentation\n\nFull analysis documented in agent output.","acceptance_criteria":"✓ Beads codebase explored thoroughly\n✓ Core features documented (ID generation, dependencies, ready work, etc.)\n✓ Key algorithms identified (cycle detection, hash IDs, recursive CTEs)\n✓ 13 implementation tasks created in beads\n✓ Tasks cover all major beads functionality\n✓ Each task has design notes from beads source","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T15:01:56.182254064-06:00","updated_at":"2025-11-17T16:17:10.318274001-06:00","closed_at":"2025-11-17T16:17:10.318274001-06:00","source_repo":"."}
{"id":"rivets-cs4","content_hash":"a7a34cd3fb03f786e65b1e3c34e3b58694949130b0f0287ca5a525e8ee7d4968","title":"Improve tracing field visibility in rivets-mcp tools","description":"Several #[instrument] attributes in crates/rivets-mcp/src/tools.rs skip fields that could be useful for debugging (e.g., assignee, label). Consider including them in the tracing output for better observability.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-17T20:29:30.588563048-06:00","updated_at":"2025-12-17T20:29:30.588563048-06:00","source_repo":".","labels":["enhancement","observability"]}
{"id":"rivets-cux","content_hash":"4a2d45574a629d8951ed593c861acbf5a6401f91df184eb5b28b39e429fd4e1d","title":"Add interactive prompt tests with mock stdin","description":"Add tests for interactive prompts in execute.rs by mocking stdin input. This ensures the interactive title/description prompts handle various inputs correctly including:\n- Valid inputs\n- Invalid inputs that should be rejected\n- Empty inputs\n- Multiline inputs for descriptions","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T22:11:25.383605039-06:00","updated_at":"2025-11-29T22:11:25.383605039-06:00","source_repo":".","labels":["pr-feedback","testing"]}
{"id":"rivets-cxq","content_hash":"b9a4c3673daea50b8eb9817d2f3c3d7df70de1ba7608aed60e9a0c727aa698bc","title":"Add priority constants (M-DOCUMENTED-MAGIC)","description":"Priority validation in domain/mod.rs uses magic number `4` without named constants, violating the M-DOCUMENTED-MAGIC guideline.\n\nLocations:\n- Line 133: `if self.priority \u003e 4`\n- Line 269: `if self.priority \u003e 4`\n- Line 500-512: Test using raw numbers 0..=4\n\nCurrent Issues:\n- Magic number repeated in multiple places\n- No single source of truth for valid priority range\n- Unclear to readers what the valid range is","design":"Add public constants in domain/mod.rs after MAX_TITLE_LENGTH (line 207):\n\n```rust\n/// Minimum priority value (highest urgency)\npub const MIN_PRIORITY: u8 = 0;\n\n/// Maximum priority value (lowest urgency)\npub const MAX_PRIORITY: u8 = 4;\n```\n\nUpdate validation code:\n\n```rust\nif self.priority \u003e MAX_PRIORITY {\n    return Err(format!(\n        \"Priority must be in range {}-{} (got {})\",\n        MIN_PRIORITY, MAX_PRIORITY, self.priority\n    ));\n}\n```\n\nUpdate tests to use constants.","acceptance_criteria":"- [ ] MIN_PRIORITY and MAX_PRIORITY constants defined\n- [ ] All validation code uses constants instead of magic numbers\n- [ ] Error messages reference constants\n- [ ] Tests use constants (e.g., `for priority in MIN_PRIORITY..=MAX_PRIORITY`)\n- [ ] Constants are documented\n- [ ] All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T16:48:58.565187568-06:00","updated_at":"2025-11-28T09:00:31.345213766-06:00","closed_at":"2025-11-28T09:00:31.345213766-06:00","source_repo":".","labels":["code-quality","documentation","refactoring"]}
{"id":"rivets-d06","content_hash":"47b53d97842adfc9d83733e0b63575fa42a47d84f6ea60d9a6c63038f189329b","title":"Write tests for MCP tools","description":"Integration and end-to-end tests for the MCP server:\n- Integration tests with actual MCP protocol messages\n- Multi-workspace scenario tests\n- Error response format verification\n- Full workflow tests (create -\u003e update -\u003e close)\n- Test with real InMemoryStorage (not mocks)","acceptance_criteria":"- [ ] Integration test harness for MCP protocol\n- [ ] Tests for complete issue lifecycle via MCP\n- [ ] Multi-workspace context switching tests\n- [ ] Error response format matches MCP spec\n- [ ] All tools tested with real storage backend","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T19:16:45.284084681-06:00","updated_at":"2025-11-30T12:09:34.327560198-06:00","closed_at":"2025-11-30T12:09:34.327560198-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-d06","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:18:02.665653116-06:00","created_by":"dwalleck"}]}
{"id":"rivets-d71","content_hash":"7fdcc106230845f1449bd8305ea03e56f3271bd37b7a5d57a0c1fc7748fadb04","title":"Implement PostgreSQL storage backend with recursive CTEs","description":"Create PostgresStorage implementation using sqlx with connection pooling. Use recursive CTEs for cycle detection and ready work queries. This is the production multi-user backend.","design":"Implement PostgreSQL backend:\n\n```rust\npub struct PostgresStorage {\n    pool: PgPool,\n}\n\nimpl IssueStorage for PostgresStorage {\n    fn create_issue(\u0026mut self, new: NewIssue) -\u003e Result\u003cIssue\u003e {\n        let id = generate_hash_id(\u0026new);\n        sqlx::query!(\n            \"INSERT INTO issues (id, title, description, ...) VALUES ($1, $2, $3, ...)\",\n            id, new.title, new.description\n        ).execute(\u0026self.pool).await?;\n        \n        self.get_issue(\u0026id)?.ok_or(Error::NotFound)\n    }\n    \n    fn check_cycle(\u0026self, from: \u0026IssueId, to: \u0026IssueId) -\u003e Result\u003cbool\u003e {\n        let exists = sqlx::query_scalar!(\n            r#\"\n            WITH RECURSIVE paths AS (\n                SELECT issue_id, depends_on_id, 1 as depth\n                FROM dependencies WHERE issue_id = $1\n                UNION ALL\n                SELECT d.issue_id, d.depends_on_id, p.depth + 1\n                FROM dependencies d JOIN paths p \n                ON d.issue_id = p.depends_on_id\n                WHERE p.depth \u003c 100\n            )\n            SELECT EXISTS(SELECT 1 FROM paths WHERE depends_on_id = $2)\n            \"#,\n            to, from\n        ).fetch_one(\u0026self.pool).await?;\n        \n        Ok(exists.unwrap_or(false))\n    }\n    \n    fn find_ready(\u0026self, filter: \u0026IssueFilter) -\u003e Result\u003cVec\u003cIssue\u003e\u003e {\n        // Recursive CTE from beads ready.go\n        // ... implementation\n    }\n}\n```\n\n**Schema**: Similar to beads SQLite schema, optimized for PostgreSQL\n**Dependencies**: `sqlx` with `runtime-tokio-rustls`, `postgres` features\n**Migrations**: Use sqlx migrations","acceptance_criteria":"- PostgresStorage implements all trait methods\n- Connection pooling configured\n- Recursive CTEs for cycle detection and ready work\n- All CRUD operations functional\n- Indexes for performance\n- Migration system working\n- Integration tests with test database\n- Performance: \u003c50ms for complex queries","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-17T16:41:42.669213538-06:00","updated_at":"2025-11-17T16:41:42.669213538-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-d71","depends_on_id":"rivets-0gc","type":"blocks","created_at":"2025-11-17T16:41:42.670260497-06:00","created_by":"daemon"}]}
{"id":"rivets-d8s3","content_hash":"f8010e41a6226149b96251c1d12a66a8775e7fbc7496072c01fbb4a43574c0ef","title":"Consider shared test utilities module","description":"From PR #34 review: The create_test_issue helper in execute.rs tests could be moved to a shared test utilities module if other test modules need similar issue creation.\n\nCurrent location: crates/rivets/src/cli/execute.rs (in #[cfg(test)] mod tests)\n\nTrigger: Move to a shared module when a second test file needs to create test Issue instances.","status":"open","priority":4,"issue_type":"chore","created_at":"2025-12-28T10:53:28.930793949-06:00","updated_at":"2025-12-28T10:53:28.930793949-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-d8s3","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T10:53:47.856660583-06:00","created_by":"dwalleck"}]}
{"id":"rivets-dee","content_hash":"faa0b85a49be40c940dac172193b738adad02366258a3e69410810739d9be70e","title":"Convert in_memory_resilient_loading.rs to rstest","description":"Extract JSON construction into fixtures. Parameterize multi-issue loading tests.\n\nFile: crates/rivets/tests/in_memory_resilient_loading.rs","acceptance_criteria":"- JSON construction fixtures created\n- Multi-issue loading tests parameterized\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T18:56:36.382550325-06:00","updated_at":"2025-11-28T20:10:43.723213826-06:00","closed_at":"2025-11-28T20:10:43.723213826-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-dee","depends_on_id":"rivets-xi4","type":"blocks","created_at":"2025-11-28T18:56:36.413058289-06:00","created_by":"dwalleck"},{"issue_id":"rivets-dee","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T18:57:38.584825095-06:00","created_by":"dwalleck"}]}
{"id":"rivets-dev","content_hash":"315850c010a611751a5247685a95ed9f10e8402f6e837587ac96b06e8ebaf0ff","title":"Convert in_memory_storage.rs to rstest","description":"Create test_issue fixture to replace create_test_issue() helpers. Parameterize priority/status tests with #[values].\n\nFile: crates/rivets/tests/in_memory_storage.rs","acceptance_criteria":"- test_issue fixture created\n- Priority/status tests use #[values] for matrix testing\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T18:56:30.726310933-06:00","updated_at":"2025-11-28T20:09:45.806681348-06:00","closed_at":"2025-11-28T20:09:45.806681348-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-dev","depends_on_id":"rivets-xi4","type":"blocks","created_at":"2025-11-28T18:56:30.72844925-06:00","created_by":"dwalleck"},{"issue_id":"rivets-dev","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T18:57:32.882715312-06:00","created_by":"dwalleck"}]}
{"id":"rivets-dgt","content_hash":"2192c39188de16c635319a4a32ba93fadd6ad3cf75e3fc0d3d2042afb22c0864","title":"Define Warning types and collection system","description":"Define the Warning enum and WarningCollector for tracking non-fatal errors during JSONL loading. This enables resilient loading that continues despite malformed data.\n\nBased on the research API design and existing LoadWarning pattern from in_memory.rs.","design":"```rust\n#[derive(Debug, Clone)]\npub enum Warning {\n    MalformedJson { line_number: usize, error: String },\n    SkippedLine { line_number: usize, reason: String },\n}\n\npub struct WarningCollector {\n    warnings: Arc\u003cMutex\u003cVec\u003cWarning\u003e\u003e\u003e,\n}\n\nimpl WarningCollector {\n    pub fn new() -\u003e Self {\n        Self {\n            warnings: Arc::new(Mutex::new(Vec::new())),\n        }\n    }\n    \n    pub fn add(\u0026self, warning: Warning) {\n        self.warnings.lock().unwrap().push(warning);\n    }\n    \n    pub fn into_warnings(self) -\u003e Vec\u003cWarning\u003e {\n        Arc::try_unwrap(self.warnings)\n            .unwrap_or_else(|arc| (*arc.lock().unwrap()).clone())\n    }\n}\n```","acceptance_criteria":"- Warning enum defined with MalformedJson and SkippedLine variants\n- WarningCollector struct with thread-safe add()\n- into_warnings() method to extract collected warnings\n- Clone and Debug impls for Warning\n- Unit tests for warning collection\n- Compiles without errors","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:15:49.553769651-06:00","updated_at":"2025-11-27T19:42:18.645501372-06:00","closed_at":"2025-11-27T19:42:18.645501372-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-dgt","depends_on_id":"rivets-3r7","type":"blocks","created_at":"2025-11-27T17:19:21.272459877-06:00","created_by":"dwalleck"}]}
{"id":"rivets-dhs","content_hash":"895dddb8834cb7e4ed7cb1ccf4887abbd1620c8b4d6bee6482109cc0e2c02a85","title":"Add query performance benchmarks","description":"Create benchmarks to measure query/filter performance and verify the \"1M records in \u003c5s\" target from research.\n\nUses criterion for benchmarking.","design":"Create benches/query_benchmarks.rs:\n\n```rust\nuse criterion::{criterion_group, criterion_main, Criterion, BenchmarkId};\nuse rivets_jsonl::*;\n\nfn query_benchmarks(c: \u0026mut Criterion) {\n    let mut group = c.benchmark_group(\"query\");\n    \n    // Benchmark: filter 1M records\n    group.bench_function(\"filter_1m_records\", |b| {\n        b.iter(|| {\n            // ... benchmark code\n        });\n    });\n    \n    // Benchmark: filter + map pipeline\n    group.bench_function(\"filter_map_pipeline\", |b| {\n        b.iter(|| {\n            // ... benchmark code\n        });\n    });\n    \n    // Benchmark: complex multi-predicate filter\n    group.bench_function(\"complex_filter\", |b| {\n        b.iter(|| {\n            // ... benchmark code\n        });\n    });\n}\n\ncriterion_group!(benches, query_benchmarks);\ncriterion_main!(benches);\n```\n\nAdd criterion as dev-dependency.","acceptance_criteria":"- Benchmarks created in benches/\n- Measures filter performance\n- Measures map performance  \n- Measures complex query pipelines\n- 1M records benchmark runs\n- Results documented in comments\n- cargo bench runs successfully","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T17:17:06.817308399-06:00","updated_at":"2025-11-27T17:17:06.817308399-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-dhs","depends_on_id":"rivets-6p4","type":"blocks","created_at":"2025-11-27T17:20:07.101126653-06:00","created_by":"dwalleck"},{"issue_id":"rivets-dhs","depends_on_id":"rivets-08u","type":"blocks","created_at":"2025-11-27T17:20:12.837887431-06:00","created_by":"dwalleck"}]}
{"id":"rivets-djr","content_hash":"6b76a50270142df3c28cd52ab356dd753c655119f1750cad65d979bcd344d4cd","title":"Evaluate rstest for rivets/src/cli.rs inline tests","description":"Evaluate and apply rstest improvements to inline unit tests in cli.rs.\n\nFile: crates/rivets/src/cli.rs (lines ~873+)","acceptance_criteria":"- Inline tests evaluated for rstest opportunities\n- Parameterization applied where beneficial\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:19:36.464605033-06:00","updated_at":"2025-11-28T19:31:25.950082366-06:00","closed_at":"2025-11-28T19:31:25.950082366-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-djr","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T19:20:28.794857749-06:00","created_by":"dwalleck"}]}
{"id":"rivets-dp5","content_hash":"5b9f44da1aae1a45fb065a6e2b563da8efaa857f0a48868872c53e1be0cc40e9","title":"Add nu-ansi-term dependency for colored output","description":"Add nu-ansi-term crate to workspace dependencies for terminal color support.\n\nThis is the foundation for all colored output features.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-30T12:34:29.450981296-06:00","updated_at":"2025-11-30T12:34:29.450981296-06:00","source_repo":".","labels":["phase-1a","ux"],"dependencies":[{"issue_id":"rivets-dp5","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:34:29.480845362-06:00","created_by":"dwalleck"}]}
{"id":"rivets-dr0b","content_hash":"51605f55ff37251f4d0d4f13727dc11993d127179ff451be94ce96530e5efb7c","title":"Refactor: Add structured logging per M-LOG-STRUCTURED","description":"The code uses raw println!/eprintln! instead of structured logging:\n\n```rust\neprintln!(\"Warning: Failed to reload after save error: {}\", reload_err);\n```\n\nPer M-LOG-STRUCTURED guideline, should use a logging crate with named properties:\n\n```rust\ntracing::warn!(\n    name: \"storage.reload.failed\",\n    error = %reload_err,\n    \"Failed to reload after save error: {{error}}\"\n);\n```\n\n**Scope:** Review all eprintln! calls in execute.rs and convert to structured tracing events.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T09:37:40.909394132-06:00","updated_at":"2025-12-28T11:26:55.645651081-06:00","closed_at":"2025-12-28T11:26:55.645651081-06:00","source_repo":".","labels":["M-LOG-STRUCTURED","execute.rs","refactor"],"dependencies":[{"issue_id":"rivets-dr0b","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:38:47.139090342-06:00","created_by":"dwalleck"}]}
{"id":"rivets-dve","content_hash":"e6c2a5e49613a4561bb10997c7b00f11b5ba30d27a98c5f6f65c07e030115728","title":"Add test-util feature for MockStorage (M-TEST-UTIL)","description":"MockStorage in storage/mod.rs (lines 284-390) should be feature-gated to allow downstream crates to use it for testing their own code that depends on the IssueStorage trait.\n\nCurrent State:\n- MockStorage is only available with #[cfg(test)]\n- Downstream crates cannot access it for their own tests\n\nImpact:\n- Makes library harder to use for external consumers who need to test code using IssueStorage\n- Forces users to write their own mocks","design":"Add a `test-util` feature to Cargo.toml:\n\n```toml\n[features]\ntest-util = []\n```\n\nMove MockStorage to public API under feature gate:\n\n```rust\n#[cfg(any(test, feature = \"test-util\"))]\npub struct MockStorage;\n\n#[cfg(any(test, feature = \"test-util\"))]\nimpl MockStorage {\n    pub fn new() -\u003e Self { Self }\n}\n```\n\nUpdate documentation to explain the feature and its usage.","acceptance_criteria":"- [ ] `test-util` feature added to Cargo.toml\n- [ ] MockStorage is `pub` and available with `feature = \"test-util\"`\n- [ ] MockStorage includes constructor and helper methods\n- [ ] Documentation updated with usage example\n- [ ] Existing tests still pass","notes":"PR #20 created: https://github.com/dwalleck/rivets/pull/20","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T16:48:52.858336885-06:00","updated_at":"2025-12-07T17:55:59.025020672-06:00","closed_at":"2025-12-07T17:55:59.025020672-06:00","source_repo":".","labels":["code-quality","public-api","testing"]}
{"id":"rivets-dw3","content_hash":"c6fd15c2e8894c082fe5dd28dc63c856235a1ae3cf72bbae65b2d258693dd16d","title":"Evaluate rstest for rivets-jsonl/src/writer.rs inline tests","description":"Evaluate and apply rstest improvements to inline unit tests in writer.rs.\n\nFile: crates/rivets-jsonl/src/writer.rs (lines ~250+)","acceptance_criteria":"- Inline tests evaluated for rstest opportunities\n- Parameterization applied where beneficial\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:19:08.122330884-06:00","updated_at":"2025-11-28T19:26:43.698535623-06:00","closed_at":"2025-11-28T19:26:43.698535623-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-dw3","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T19:20:00.658072921-06:00","created_by":"dwalleck"}]}
{"id":"rivets-e3j","content_hash":"1eb9534da08e843d42d3b01c9a17758aaf9f7a94e4a83337c89b2964059f0d4a","title":"Implement TUI Kanban board view","description":"Create Kanban board view for TUI with columns:\n- Open\n- In Progress\n- Blocked\n- Closed\n\nFeatures:\n- Issue cards with title, priority, assignee\n- Move issues between columns\n- Color-coded by priority\n- Scrollable columns","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:37:06.816842488-06:00","updated_at":"2025-11-30T12:37:06.816842488-06:00","source_repo":".","labels":["phase-3","tui"],"dependencies":[{"issue_id":"rivets-e3j","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:37:06.820055181-06:00","created_by":"dwalleck"}]}
{"id":"rivets-e55","content_hash":"436df0e7eb8f5bf02654856362eff4c0fce28b203c1100868932fc522a8742fe","title":"Implement JSONL to Automerge migration","description":"Create migration utilities to convert existing JSONL databases to Automerge format.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T13:10:44.625658946-06:00","updated_at":"2025-12-22T22:45:17.074168648-06:00","closed_at":"2025-12-22T22:45:17.074168648-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-e55","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T13:10:44.655909445-06:00","created_by":"dwalleck"}]}
{"id":"rivets-e8c","content_hash":"a42ab31a6f157afe079b3ac887e1c6e1f4acfc1ae243a444c157fe8013028a12","title":"Add confirmation dialogs for destructive operations","description":"Require confirmation for destructive operations:\n\n```\n$ rivets delete rivets-abc\nDelete issue 'rivets-abc' (Fix authentication bug)?\nThis will also remove 3 dependencies.\n[y/N]: \n```\n\nAdd --force/-f flag to skip confirmation for scripting.\nSkip prompts when --json flag is set.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-30T12:35:42.629554393-06:00","updated_at":"2025-11-30T12:35:42.629554393-06:00","source_repo":".","labels":["phase-1b","safety","ux"],"dependencies":[{"issue_id":"rivets-e8c","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:35:42.658980891-06:00","created_by":"dwalleck"}]}
{"id":"rivets-e8t","content_hash":"e617371f39ab926caa8922a3d3df411f40d3d85ddf0240749882e8a3b6a6af28","title":"Implement ASCII dependency tree rendering","description":"Implement ASCII art dependency tree visualization:\n\n```\nrivets-abc \"Main Epic\"\n├── rivets-def \"Subtask 1\" [\u003e] P1\n│   └── rivets-ghi \"Dependency\" [✓] P2\n└── rivets-jkl \"Subtask 2\" [ ] P2\n    ├── rivets-mno \"Blocked by\" [X] P1\n    └── rivets-pqr \"Related\" [ ] P3\n```\n\nFeatures:\n- Box-drawing characters for tree structure\n- Color-coded status and priority\n- Collapsible for large trees\n- Support for all dependency types (blocks, related, parent-child, discovered-from)","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-30T12:34:52.660367062-06:00","updated_at":"2025-11-30T12:34:52.660367062-06:00","source_repo":".","labels":["phase-1a","ux"],"dependencies":[{"issue_id":"rivets-e8t","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:34:52.661903985-06:00","created_by":"dwalleck"}]}
{"id":"rivets-f07","content_hash":"8ada66f4b937eefb0963be278d6d9837c43a2dd7c105ede386240eafc8bb0fb6","title":"Add trace logging for workspace cache operations","description":"Add observability to the workspace storage cache to help debug multi-workspace scenarios.\n\nSuggested trace logging points:\n- Cache hits: when a workspace is found in the cache\n- Cache misses: when a workspace needs to be loaded from disk\n- Cache evictions: when a workspace is removed due to capacity limits\n- Cache size: periodic or on-change logging of current cache utilization\n\nThis would help with:\n1. Debugging issues in multi-workspace agent scenarios\n2. Validating cache eviction strategy effectiveness (relates to rivets-zkb)\n3. Understanding real-world usage patterns\n4. Identifying potential performance bottlenecks\n\nImplementation notes:\n- Use tracing crate with appropriate log levels (trace/debug for hits, info for evictions)\n- Consider structured logging with workspace paths and cache stats\n- Ensure logging doesn't impact performance (use trace! level for high-frequency events)","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T01:30:55.370591744-06:00","updated_at":"2025-11-29T01:30:55.370591744-06:00","source_repo":".","labels":["observability","rivets-mcp"],"dependencies":[{"issue_id":"rivets-f07","depends_on_id":"rivets-zkb","type":"related","created_at":"2025-11-29T01:31:05.607485077-06:00","created_by":"dwalleck"}]}
{"id":"rivets-f5f","content_hash":"be06b4952fbb8e94be0fe6dec880f4f9a063e2493da6ba6838a0500782082d0e","title":"Add error handling and MCP error responses","description":"Implement proper error handling:\n- Map rivets errors to MCP error responses\n- Structured error types for MCP\n- Helpful error messages for common failures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:16:33.957289146-06:00","updated_at":"2025-11-29T08:41:30.508649115-06:00","closed_at":"2025-11-29T08:41:30.508649115-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-f5f","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:17:51.379492118-06:00","created_by":"dwalleck"}]}
{"id":"rivets-fk9","content_hash":"f81f4504609749d2ae904450922cfb215474b0b8d3fe0bd90b7a579702e0298b","title":"Research and design JSONL library architecture","description":"Design a standalone Rust library for efficient JSONL (JSON Lines) operations that can be used by rivets and potentially other projects. The library should handle reading, writing, querying, and streaming JSONL data structures.","design":"Research key features needed:\n- Efficient line-by-line reading and writing\n- Streaming support for large files\n- Querying/filtering capabilities\n- Schema validation (optional)\n- Error handling for malformed JSON\n- Memory-efficient operations\n- Concurrent access patterns\n\nConsider existing Rust JSONL libraries and what gaps exist. Determine if we build from scratch or extend existing solutions.","acceptance_criteria":"- Document listing key features and API design\n- Comparison of existing Rust JSONL libraries (evaluated on: performance benchmarks, API ergonomics, maintenance status, license compatibility, feature completeness)\n- Decision matrix showing trade-offs\n- Decision on whether to build new library or extend existing one\n- Performance requirements documented (targets: streaming 100MB file \u003c1s, memory usage \u003c10MB regardless of file size)\n- Public API surface designed with examples\n- Compatibility with serde ecosystem verified","notes":"## Research Complete (2025-11-27)\n\nComprehensive research documented in `docs/rivets-jsonl-research.md`.\n\n**Key Findings**:\n- Evaluated 4 existing Rust JSONL libraries (jsonl, serde-jsonlines, json-lines, json-stream)\n- None fully meet rivets' needs (async-first, streaming queries, resilient loading)\n- **Decision**: Build custom implementation borrowing proven patterns\n\n**Performance Targets**:\n- 100MB file in \u003c1s (read)\n- \u003c10MB memory regardless of file size\n- Match or exceed current in_memory.rs baseline\n\n**API Design**:\n- Async-native with tokio\n- Extension traits for ergonomics\n- Streaming via futures::Stream\n- Resilient loading with warning collection\n- Query/filter during stream\n\n**Next**: Implement Phase 1 (Core Read/Write)","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T15:08:44.178736229-06:00","updated_at":"2025-11-27T17:01:29.152853238-06:00","closed_at":"2025-11-27T17:01:29.152853238-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-fk9","depends_on_id":"rivets-cr9","type":"blocks","created_at":"2025-11-17T15:08:44.179627634-06:00","created_by":"daemon"}]}
{"id":"rivets-fn7","content_hash":"4e99a287c0a5b43b195f8c6662f8841f1699f0f0e6090cb01c36ff41f521d98f","title":"Consider case-insensitive assignee matching","description":"The current assignee filtering is case-sensitive (\"alice\" does not match \"Alice\"). Consider whether case-insensitive matching would be more user-friendly.\n\nLocation: Documented in test at `crates/rivets-mcp/tests/integration.rs` line 1863-1869\n\nOptions to consider:\n1. Make assignee matching case-insensitive (more user-friendly)\n2. Keep case-sensitive but normalize on input (e.g., lowercase all assignees)\n3. Keep current behavior (explicit, predictable)","status":"open","priority":4,"issue_type":"task","created_at":"2025-11-30T12:29:37.222874542-06:00","updated_at":"2025-11-30T12:29:37.222874542-06:00","source_repo":".","labels":["pr-feedback","ux"]}
{"id":"rivets-fwy","content_hash":"25f022fc311f22e7a25f3885c39b4120155667673a44116dcae026f82ad7181f","title":"Add skim dependency for fuzzy search","description":"Add skim crate to workspace dependencies for fuzzy finding functionality.","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-30T12:36:06.747113999-06:00","updated_at":"2025-11-30T12:36:06.747113999-06:00","source_repo":".","labels":["phase-2","ux"],"dependencies":[{"issue_id":"rivets-fwy","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:36:06.777555084-06:00","created_by":"dwalleck"}]}
{"id":"rivets-fxy","content_hash":"72c8c4f72a089df8f1fb3616f653997754217cf85e63e4e7e8b0fafb050f836d","title":"Implement semantic color theme","description":"Implement color theme with semantic colors:\n\nStatus colors:\n- Open: Blue\n- In Progress: Yellow/Gold\n- Ready: Green (new status indicator)\n- Blocked: Red\n- Closed: Gray/dim\n\nPriority colors:\n- P0: Red (critical)\n- P1: Orange\n- P2: Yellow\n- P3: Blue\n- P4: Gray\n\nIssue type colors:\n- Bug: Red\n- Feature: Green\n- Task: Blue\n- Epic: Purple\n- Chore: Gray","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-30T12:34:41.241090815-06:00","updated_at":"2025-11-30T12:34:41.241090815-06:00","source_repo":".","labels":["phase-1a","ux"],"dependencies":[{"issue_id":"rivets-fxy","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:34:41.272092706-06:00","created_by":"dwalleck"}]}
{"id":"rivets-g25","content_hash":"36d5243546bf136ff3225937ddd05260a734da8ae9b43d6fa7f2141bcff7921a","title":"Implement reopen command","description":"Add 'reopen' command to reopen closed issues. Should support multiple issue IDs and --reason flag. Example: rivets reopen id1 id2 --reason 'Reopening for further work'","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T18:23:33.144141194-06:00","updated_at":"2025-12-27T18:30:58.643711846-06:00","closed_at":"2025-12-27T18:30:58.643711846-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-g25","depends_on_id":"rivets-v3s","type":"parent-child","created_at":"2025-12-27T18:23:33.174201825-06:00","created_by":"dwalleck"}]}
{"id":"rivets-gut","content_hash":"292c41f512b4cd9d61559ed4734e482d31a3aae11247454808f32b34b58fd476","title":"Implement rivets done workflow command","description":"Add `rivets done` command for completing work:\n\n```\n$ rivets done rivets-abc\nClosing rivets-abc...\nAdd completion notes (optional, Ctrl+D to finish):\n\u003e Fixed authentication flow, added token refresh.\n\u003e PR: #42\n\nClosed: rivets-abc\n  - Added close reason\n  - Status: in_progress -\u003e closed\n\n2 issues are now unblocked:\n  - rivets-def Add OAuth support\n  - rivets-ghi User profile update\n```","status":"open","priority":4,"issue_type":"feature","created_at":"2025-11-30T12:37:56.117458877-06:00","updated_at":"2025-11-30T12:37:56.117458877-06:00","source_repo":".","labels":["phase-4","workflow"],"dependencies":[{"issue_id":"rivets-gut","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:37:56.148350705-06:00","created_by":"dwalleck"}]}
{"id":"rivets-h1va","content_hash":"84e1f5f3fc493de3d106188ab5b92243179fb574d5f07156852ac54e18a2bd19","title":"Implement LspClient with JSON-RPC transport","description":"Create `src/lsp/mod.rs` with:\n\n- `LspClient` struct (process handle, stdin/stdout, request_id)\n- `send_request\u003cR: Request\u003e()` - generic JSON-RPC request\n- `read_response\u003cT\u003e()` - parse Content-Length header + JSON body\n- `start()` - spawn process, do initialize handshake\n- `shutdown()` - graceful shutdown\n\nUse lsp-types for all protocol types, just implement the transport (~100 lines).","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:28:37.453815533-06:00","updated_at":"2026-01-28T18:00:09.362735526-06:00","closed_at":"2026-01-28T18:00:09.362735526-06:00","source_repo":".","labels":["lsp","phase2","tethys"],"dependencies":[{"issue_id":"rivets-h1va","depends_on_id":"rivets-8j9u","type":"blocks","created_at":"2026-01-28T11:30:20.321919473-06:00","created_by":"dwalleck"},{"issue_id":"rivets-h1va","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:17.817446248-06:00","created_by":"dwalleck"}]}
{"id":"rivets-hnf","content_hash":"c328a4b05dbe7dea247ff8a466eb27623adc9fbece79823b248f63658607b2de","title":"Refactor: Extract batch processing helper to reduce duplication","description":"The batch processing pattern with save-after-success and reload-on-failure is duplicated ~6 times across:\n- execute_update\n- execute_close  \n- execute_reopen\n- execute_label (Add)\n- execute_label (Remove)\n\n**Pattern:**\n```rust\nmatch app.storage_mut().update(\u0026issue_id, update).await {\n    Ok(issue) =\u003e {\n        if let Err(save_err) = app.save().await {\n            if let Err(reload_err) = app.storage_mut().reload().await {\n                eprintln!(\"Warning: Failed to reload...\");\n            }\n            result.failed.push(BatchError { ... });\n        } else {\n            result.succeeded.push(issue);\n        }\n    }\n    Err(e) =\u003e { result.failed.push(...); }\n}\n```\n\n**Recommendation:** Extract into a helper function like `save_or_record_failure()`.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T09:37:23.533238227-06:00","updated_at":"2025-12-28T10:15:44.346630821-06:00","closed_at":"2025-12-28T10:15:44.346630821-06:00","source_repo":".","labels":["DRY","execute.rs","refactor"],"dependencies":[{"issue_id":"rivets-hnf","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:38:29.531610413-06:00","created_by":"dwalleck"}]}
{"id":"rivets-hzul","content_hash":"be85dac8d08ece1d028b14aa603d05b1c4b7bf81b7de37f76f61ca1b1ad493f1","title":"`rivets update` with no field arguments should error","description":"Currently `rivets update ISSUE-1` succeeds silently even when no fields are updated. Should fail with a message explaining what arguments can be used.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-11T16:47:28.086230193-06:00","updated_at":"2026-01-11T16:55:43.729972424-06:00","closed_at":"2026-01-11T16:55:43.729972424-06:00","source_repo":".","labels":["cli","ux"]}
{"id":"rivets-i2w","content_hash":"98f03e8639e07e6df4d99aaf70a5070f03186dbae8b5ea059c421f05eabe9fe9","title":"Implement label subcommand","description":"Add 'label' subcommand with add/remove/list/list-all actions. Should support multiple issue IDs.\\n\\nExamples:\\n- rivets label add id1 id2 urgent --json\\n- rivets label remove id1 bug --json\\n- rivets label list id1 --json\\n- rivets label list-all --json","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T18:23:50.950734701-06:00","updated_at":"2025-12-27T18:42:19.285302354-06:00","closed_at":"2025-12-27T18:42:19.285302354-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-i2w","depends_on_id":"rivets-v3s","type":"parent-child","created_at":"2025-12-27T18:23:50.981573217-06:00","created_by":"dwalleck"}]}
{"id":"rivets-i8g","content_hash":"afe753cc5b33eeefa96b7c95ccf7adb15d9cedceeae2c3fabacc4593c50eb7c4","title":"Clarify blocked tool semantics for status-blocked vs dependency-blocked","description":"The MCP integration tests have a comment indicating uncertainty about expected behavior:\n\n```rust\n// Lines 2398-2399\n// Note: Issue is blocked by status, not by dependency, so it may or may not appear\n// in blocked_issues depending on implementation\n```\n\nShould clarify and document the intended semantics:\n- Should `blocked` tool return issues with status=blocked?\n- Should it only return issues blocked by dependencies?\n- Should it return both?\n\nLocation: `crates/rivets-mcp/tests/integration.rs:2398-2399`","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-30T12:29:48.790471346-06:00","updated_at":"2025-11-30T12:29:48.790471346-06:00","source_repo":".","labels":["documentation","pr-feedback"]}
{"id":"rivets-itz7","content_hash":"12b808047613cb718ddc428626b17399f812c4047ed185d01b4b2a1846535f62","title":"Store imports during indexing (Rust + C#)","description":"During file indexing, extract import statements and store them in the imports table.\n\nFor Rust: parse `use` statements via existing `extract_use_statements()`\nFor C#: parse `using` directives via existing `extract_using_directives()`\n\nMap both to the common imports table format.","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:27:26.855812694-06:00","updated_at":"2026-01-28T11:49:54.9967178-06:00","closed_at":"2026-01-28T11:49:54.9967178-06:00","source_repo":".","labels":["phase1","tethys"],"dependencies":[{"issue_id":"rivets-itz7","depends_on_id":"rivets-lxbg","type":"blocks","created_at":"2026-01-28T11:29:32.311561096-06:00","created_by":"dwalleck"},{"issue_id":"rivets-itz7","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:31:32.70391321-06:00","created_by":"dwalleck"}]}
{"id":"rivets-iwsc","content_hash":"cf13d12bc16475058546d21ce0218ad6290ae399eed9b906d9f171235f5365e6","title":"Docs: Add rationale for prefix length and traversal depth constants","description":"In commands/init.rs, the constants at lines 57-63 have minimal documentation:\n\n```rust\n/// Minimum prefix length\npub const MIN_PREFIX_LENGTH: usize = 2;\n\n/// Maximum prefix length\npub const MAX_PREFIX_LENGTH: usize = 20;\n\n/// Maximum directory depth to traverse when searching for rivets root\npub const MAX_TRAVERSAL_DEPTH: usize = 256;\n```\n\nPer M-DOCUMENTED-MAGIC guideline, these should explain WHY these values were chosen:\n\n- Why 2 minimum? (single char too ambiguous?)\n- Why 20 maximum? (readability in issue IDs?)\n- Why 256 traversal depth? (matches typical filesystem limits? performance?)\n\n**Example fix:**\n```rust\n/// Minimum prefix length.\n///\n/// Set to 2 to ensure prefixes are meaningful and distinguishable.\n/// Single-character prefixes would be too ambiguous and harder to type.\npub const MIN_PREFIX_LENGTH: usize = 2;\n```","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T09:50:43.658996271-06:00","updated_at":"2025-12-28T09:50:43.658996271-06:00","source_repo":".","labels":["M-DOCUMENTED-MAGIC","docs","init.rs"],"dependencies":[{"issue_id":"rivets-iwsc","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:51:31.591626863-06:00","created_by":"dwalleck"}]}
{"id":"rivets-j20","content_hash":"c572e678ae04d6765df918be01cc1eac330b7282b080264feeab5bb779713409","title":"Verify path traversal protection in rivets directory resolution","description":"Audit and verify that the rivets directory resolution logic properly handles path traversal attempts like \"../\" in user inputs. Add tests to confirm that malicious paths cannot escape the intended directory boundaries.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-29T22:11:42.751822201-06:00","updated_at":"2025-11-29T22:11:42.751822201-06:00","source_repo":".","labels":["pr-feedback","security"]}
{"id":"rivets-j3a","content_hash":"eea9abbdd765918e86531d5b20dac8e4fd3a2bd99b5abbf1b02b2914c200dfaf","title":"Evaluate rstest for rivets-jsonl/src/reader.rs inline tests","description":"Evaluate and apply rstest improvements to inline unit tests in reader.rs.\n\nFile: crates/rivets-jsonl/src/reader.rs (lines ~448-568)","acceptance_criteria":"- Inline tests evaluated for rstest opportunities\n- Parameterization applied where beneficial\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:19:02.49988506-06:00","updated_at":"2025-11-28T19:25:34.36677348-06:00","closed_at":"2025-11-28T19:25:34.36677348-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-j3a","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T19:19:55.014631669-06:00","created_by":"dwalleck"}]}
{"id":"rivets-j5e7","content_hash":"d34dcae1290d38eff66029ef05e423d337c7444af96ec16fe873fce009aa6bb9","title":"Feature: Implement --no-assignee flag for explicit unassignment","description":"In args.rs (lines 149-156), there's a TODO for implementing a --no-assignee flag:\n\n```rust\n/// New assignee\n///\n/// Note: To unassign, use `--no-assignee` flag instead. Clap does not\n/// support empty strings (\"\") as argument values by default.\n///\n/// TODO: Implement --no-assignee flag for explicit unassignment\n#[arg(short, long)]\npub assignee: Option\u003cString\u003e,\n```\n\n**Problem:** Users cannot unassign an issue via the CLI because clap doesn't accept empty strings.\n\n**Solution:** Add a `--no-assignee` boolean flag that explicitly clears the assignee field when updating an issue.\n\n**Implementation notes:**\n- Add `#[arg(long, conflicts_with = \"assignee\")]` for the new flag\n- In execute_update, check if no_assignee is true and set assignee to Some(None) to clear it","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T09:42:13.371513935-06:00","updated_at":"2025-12-28T15:37:19.178243668-06:00","closed_at":"2025-12-28T15:37:19.178243668-06:00","source_repo":".","labels":["args.rs","cli","enhancement"],"dependencies":[{"issue_id":"rivets-j5e7","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:45:30.697144003-06:00","created_by":"dwalleck"}]}
{"id":"rivets-jfs","content_hash":"2501eaad83aea4f3aecaa6b36ed8bf5c22f8e324fba1da833d2398c307c827c9","title":"Fix remaining list/ready call compilation errors in integration tests","description":"After adding label/issue_type parameters to list() and ready() tools, some integration test calls still have wrong parameter counts.\n\nRemaining ready() calls to fix (need 6 params: limit, priority, issue_type, assignee, label, workspace_root):\n- Line 988: `.ready(None, Some(0), None, None)` - priority filter\n- Line 1035: `.ready(None, None, Some(\"alice\".to_string()), None)` - assignee filter  \n- Line 1057: `.ready(Some(2), None, None, None)` - limit filter\n\nThese need issue_type and label parameters added.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T17:57:34.115965496-06:00","updated_at":"2025-11-29T18:00:52.311358389-06:00","closed_at":"2025-11-29T18:00:52.311358389-06:00","source_repo":"."}
{"id":"rivets-js1","content_hash":"ba6134f655b1ed8dcada4e011e8bef7764fced9d575f43266f2fd87c4f6fdf6f","title":"Implement issue templates system","description":"Add YAML-based issue templates:\n\n```yaml\n# .rivets/templates/bug.yaml\ntype: bug\npriority: 1\nlabels: [bug, needs-triage]\ndescription: |\n  ## Bug Description\n  [Describe the bug]\n  \n  ## Steps to Reproduce\n  1. \n  2. \n  3. \n  \n  ## Expected Behavior\n  [What should happen]\n  \n  ## Actual Behavior\n  [What actually happens]\n```\n\nUsage:\n```\n$ rivets create --template bug \"Login fails on Safari\"\nCreated: rivets-xyz\n  Type: bug\n  Priority: P1\n  Labels: bug, needs-triage\n  \nOpen in editor to fill description? [Y/n]: \n```","status":"open","priority":4,"issue_type":"feature","created_at":"2025-11-30T12:38:01.99305725-06:00","updated_at":"2025-11-30T12:38:01.99305725-06:00","source_repo":".","labels":["phase-4","workflow"],"dependencies":[{"issue_id":"rivets-js1","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:38:01.995336853-06:00","created_by":"dwalleck"}]}
{"id":"rivets-k3mv","content_hash":"4540569dc58d16cd896e5fa63e873f65269a93418fcb015c0e2999aa59f3708b","title":"Integrate LSP into index --lsp","description":"When `--lsp` flag is set during indexing:\n\n1. After Pass 2, identify still-unresolved references\n2. For each, call LSP goto_definition to find the target\n3. Update reference with resolved symbol_id\n\nLSP is spawned lazily, kept alive for batch queries, shutdown on completion.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T11:28:56.529556093-06:00","updated_at":"2026-01-28T18:57:33.035836992-06:00","closed_at":"2026-01-28T18:57:33.035836992-06:00","source_repo":".","labels":["lsp","phase2","tethys"],"dependencies":[{"issue_id":"rivets-k3mv","depends_on_id":"rivets-oeu5","type":"blocks","created_at":"2026-01-28T11:30:39.427830148-06:00","created_by":"dwalleck"},{"issue_id":"rivets-k3mv","depends_on_id":"rivets-7uw0","type":"blocks","created_at":"2026-01-28T11:30:45.646672842-06:00","created_by":"dwalleck"},{"issue_id":"rivets-k3mv","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:36.763616234-06:00","created_by":"dwalleck"}]}
{"id":"rivets-kln","content_hash":"a55d64c912441029900da4c05242819d940a51a85b28fecf4dfbf87fb955ffa2","title":"Add dialoguer dependency for interactive prompts","description":"Add dialoguer crate to workspace dependencies for interactive CLI prompts.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-30T12:35:31.001190538-06:00","updated_at":"2025-11-30T12:35:31.001190538-06:00","source_repo":".","labels":["phase-1b","ux"],"dependencies":[{"issue_id":"rivets-kln","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:35:31.031522174-06:00","created_by":"dwalleck"}]}
{"id":"rivets-kr3","content_hash":"5812bc8743423a9af5f2fb2197962df0277b0570a28445978b34108bcf2ff036","title":"Design rivets project structure with two-crate architecture","description":"Plan the overall project structure splitting rivets into two crates: a JSONL library (general-purpose) and the rivets CLI application (issue tracking). Define workspace layout, dependencies, and inter-crate relationships.","design":"## Workspace Design\n\n### Directory Structure\n```\nrivets/\n├── Cargo.toml              # Workspace config (resolver=3)\n├── crates/\n│   ├── rivets-jsonl/       # JSONL library crate\n│   │   ├── src/ (lib.rs, reader.rs, writer.rs, query.rs, stream.rs, error.rs)\n│   │   ├── tests/, benches/, examples/\n│   │   └── Cargo.toml\n│   └── rivets/             # CLI application crate\n│       ├── src/ (main.rs, cli.rs, commands/, domain/, storage.rs, config.rs)\n│       ├── tests/\n│       └── Cargo.toml\n├── docs/\n└── target/                 # Shared build output\n```\n\n### Separation of Concerns\n\n**rivets-jsonl**: Generic JSONL operations (read, write, stream, query), no domain knowledge\n**rivets**: Issue tracking domain (CLI, commands, business logic), uses rivets-jsonl for storage\n\n### Dependencies\n- One-way: rivets → rivets-jsonl\n- Shared deps via [workspace.dependencies]: serde, serde_json, thiserror, anyhow, clap\n- rivets-jsonl internally referenced via { workspace = true }\n\n### Naming\n- Library: rivets-jsonl (crates.io)\n- Binary: rivets (crates.io), installs 'rivets' command\n- Modules: snake_case, one primary type per file\n\n### Testing\n- Unit: #[cfg(test)] modules\n- Integration: crates/*/tests/\n- Benchmarks: crates/rivets-jsonl/benches/\n- Doc tests: /// examples in public APIs\n\n### Future Extensibility\nWorkspace supports: rivets-tui, rivets-server, rivets-web, rivets-sync","acceptance_criteria":"- Cargo.toml workspace configuration designed\n- Directory structure planned and documented\n- Clear separation of concerns between crates defined\n- Naming conventions established\n- Inter-crate dependency strategy documented","notes":"Design complete with comprehensive workspace structure. Ready for implementation. Directory structure uses flat 'crates/' layout per Rust best practices. Resolver 3 for modern dependency resolution. Clean separation between generic JSONL library and domain-specific CLI application.","status":"closed","priority":1,"issue_type":"task","assignee":"Claude","created_at":"2025-11-17T15:08:45.002094002-06:00","updated_at":"2025-11-17T15:47:19.541529556-06:00","closed_at":"2025-11-17T15:43:27.115215646-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-kr3","depends_on_id":"rivets-cr9","type":"blocks","created_at":"2025-11-17T15:08:45.002895148-06:00","created_by":"daemon"}]}
{"id":"rivets-kuf","content_hash":"831b7e59dca2abe251fe64d5e8165b4c52a9f8b5840ec5fef8d6bfb7f83f11ef","title":"Create comprehensive examples","description":"Create examples demonstrating all major rivets-jsonl features.\n\nExamples should be runnable and well-documented.","design":"Create in examples/:\n\n1. **basic.rs** - Simple read/write\n2. **streaming.rs** - Large file streaming\n3. **resilient.rs** - Resilient loading with warnings\n4. **query.rs** - Filtering and querying\n5. **atomic_write.rs** - Atomic writes\n6. **integration.rs** - Integration with rivets\n\nEach example should:\n- Be fully runnable with `cargo run --example \u003cname\u003e`\n- Include inline documentation\n- Demonstrate best practices\n- Show error handling","acceptance_criteria":"- All 6 examples created\n- Each example compiles and runs\n- Examples well-documented\n- README lists all examples with descriptions\n- Examples demonstrate key features","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T17:17:58.239786888-06:00","updated_at":"2025-11-27T17:17:58.239786888-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-kuf","depends_on_id":"rivets-t0k","type":"blocks","created_at":"2025-11-27T17:20:30.06094014-06:00","created_by":"dwalleck"},{"issue_id":"rivets-kuf","depends_on_id":"rivets-dhs","type":"blocks","created_at":"2025-11-27T17:20:35.736904071-06:00","created_by":"dwalleck"}]}
{"id":"rivets-l56","content_hash":"4ed459de22c265b7b14d0294f7e7fe1c44647b287892bce5486da8e1efa8effe","title":"Replace #[allow] with #[expect] (M-LINT-OVERRIDE-EXPECT)","description":"storage/mod.rs:233 uses `#[allow(dead_code)]` on the PostgreSQL enum variant, violating the M-LINT-OVERRIDE-EXPECT guideline.\n\nCurrent Code (line 233):\n```rust\n#[allow(dead_code)]\nPostgreSQL(String),\n```\n\nIssues:\n- #[allow] silently suppresses warnings\n- No explanation for why the warning is acceptable\n- Will continue to suppress warning even if PostgreSQL gets implemented\n\nGuideline Requirement:\n- Use #[expect] with reason to document intent\n- Fails loudly if expectation becomes invalid","design":"Replace #[allow] with #[expect] and add reason:\n\n```rust\n#[expect(dead_code, reason = \"PostgreSQL backend not yet implemented (tracked in TODO)\")]\nPostgreSQL(String),\n```\n\nThis:\n- Documents why the variant is currently unused\n- Will cause a warning if PostgreSQL gets implemented but attribute isn't removed\n- Makes the temporary nature explicit","acceptance_criteria":"- [ ] #[allow(dead_code)] replaced with #[expect]\n- [ ] Reason documented explaining temporary nature\n- [ ] Code compiles without warnings\n- [ ] All tests pass","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T16:49:04.233675714-06:00","updated_at":"2025-11-27T16:49:04.233675714-06:00","source_repo":".","labels":["code-quality","lints"]}
{"id":"rivets-l66","content_hash":"656b27cd18c016d01f4a2da6d824e546aab6f7730aded3bfcaf1a3a99b029c67","title":"Implement JSONL persistence for InMemoryStorage","description":"Add save/load functionality to InMemoryStorage to persist data to JSONL files. This provides durability for the in-memory backend.","design":"Extend InMemoryStorage with async persistence (matches rivets-0gc async trait pattern):\n\n**Async Implementation:**\n\n```rust\nimpl InMemoryStorage {\n    pub async fn load_from_jsonl(path: \u0026Path) -\u003e Result\u003c(Self, Vec\u003cLoadWarning\u003e)\u003e {\n        use tokio::fs::File;\n        use tokio::io::{AsyncBufReadExt, BufReader};\n        \n        let file = BufReader::new(File::open(path).await?);\n        let storage = Arc::new(Mutex::new(InMemoryStorageInner::new()));\n        let mut warnings = Vec::new();\n        let mut lines = file.lines();\n        \n        // First pass: import all issues (without dependencies)\n        while let Some(line) = lines.next_line().await? {\n            match serde_json::from_str::\u003cIssue\u003e(\u0026line) {\n                Ok(issue) =\u003e {\n                    let mut inner = storage.lock().await;\n                    let id = issue.id.clone();\n                    inner.issues.insert(id.clone(), issue);\n                    let node = inner.graph.add_node(id.clone());\n                    inner.node_map.insert(id, node);\n                }\n                Err(e) =\u003e {\n                    warnings.push(LoadWarning::MalformedJson { line, error: e });\n                    log::warn!(\"Skipping malformed JSON: {}\", e);\n                }\n            }\n        }\n        \n        // Second pass: add dependency edges with orphan/cycle detection\n        let mut inner = storage.lock().await;\n        for issue in inner.issues.values() {\n            for dep in \u0026issue.dependencies {\n                // Check if dependency target exists\n                if !inner.issues.contains_key(\u0026dep.depends_on_id) {\n                    warnings.push(LoadWarning::OrphanedDependency {\n                        from: issue.id.clone(),\n                        to: dep.depends_on_id.clone(),\n                    });\n                    log::warn!(\"Skipping orphaned dependency: {} -\u003e {}\", \n                              issue.id, dep.depends_on_id);\n                    continue;\n                }\n                \n                // Check for cycles before adding edge\n                if inner.has_cycle_internal(\u0026issue.id, \u0026dep.depends_on_id)? {\n                    warnings.push(LoadWarning::CircularDependency {\n                        from: issue.id.clone(),\n                        to: dep.depends_on_id.clone(),\n                    });\n                    log::warn!(\"Skipping circular dependency: {} -\u003e {}\", \n                              issue.id, dep.depends_on_id);\n                    continue;\n                }\n                \n                // Add edge to graph\n                inner.add_dependency_edge_internal(dep)?;\n            }\n        }\n        \n        Ok((storage, warnings))\n    }\n    \n    pub async fn save_to_jsonl(\u0026self, path: \u0026Path) -\u003e Result\u003c()\u003e {\n        use tokio::fs::File;\n        use tokio::io::{AsyncWriteExt, BufWriter};\n        \n        // Atomic write: temp file + rename\n        let temp_path = path.with_extension(\"tmp\");\n        let file = BufWriter::new(File::create(\u0026temp_path).await?);\n        \n        let inner = self.lock().await;\n        for issue in inner.issues.values() {\n            let json = serde_json::to_string(issue)?;\n            file.write_all(json.as_bytes()).await?;\n            file.write_all(b\"\\n\").await?;  // Newline-delimited\n        }\n        file.flush().await?;\n        \n        // Atomic rename\n        tokio::fs::rename(\u0026temp_path, path).await?;\n        Ok(())\n    }\n}\n```\n\n**Error Handling:**\n- Malformed JSON: Skip line, log warning, continue loading\n- Orphaned dependencies: Skip edge, log warning, import issue without that dependency\n- Circular dependencies: Skip edge, log warning, prevent cycle creation\n- Returns (Storage, Vec\u003cLoadWarning\u003e) to communicate warnings to caller\n\n**File format**: Standard JSONL (newline-delimited JSON)\n**Atomicity**: Write to temp file, then rename (atomic on POSIX systems)\n**Dependencies**: tokio with fs feature for async file I/O","acceptance_criteria":"- load_from_jsonl reads and reconstructs storage\n- save_to_jsonl writes all issues\n- Dependency graph correctly rebuilt on load\n- Atomic writes (temp file + rename)\n- Round-trip test: save → load → verify\n- Handles large files (streaming read)\n- Error handling for malformed JSON","notes":"## Clarifications\n\n### Session 2025-11-17\n\n- Q: The design shows synchronous methods (`pub fn load_from_jsonl`, `pub fn save_to_jsonl`) but rivets-0gc defines an async storage trait. Should these persistence methods be async? → A: Make persistence methods async (matches async trait pattern from rivets-0gc, enables non-blocking file I/O for large JSONL files)\n- Q: During JSONL import, what should happen if an issue references dependencies that don't exist in the file (orphaned dependency references)? → A: Skip orphaned dependencies with warning (allows partial recovery from corrupted/incomplete files, resilient approach)\n- Q: If the JSONL file contains issues that form circular dependencies, how should load_from_jsonl handle this? → A: Detect and reject circular dependencies during import (ensures loaded data has no cycles, maintains data integrity)","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T16:41:41.842178005-06:00","updated_at":"2025-11-27T16:55:23.560905657-06:00","closed_at":"2025-11-27T16:55:23.560905657-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-l66","depends_on_id":"rivets-bz5","type":"blocks","created_at":"2025-11-17T16:46:29.806550029-06:00","created_by":"daemon"}]}
{"id":"rivets-len","content_hash":"407ab354fce286d6f5cf2e7bd9e9b1fef012d5793dd84476b524464f6e6c64d8","title":"Implement JsonlReader::read_line() method","description":"Implement the read_line() async method that reads a single JSONL line and deserializes it into type T.\n\nThis is the foundational read operation that all other reading functionality builds on.","design":"```rust\nuse serde::de::DeserializeOwned;\nuse tokio::io::AsyncBufReadExt;\n\nimpl\u003cR: AsyncRead + Unpin\u003e JsonlReader\u003cR\u003e {\n    pub async fn read_line\u003cT: DeserializeOwned\u003e(\u0026mut self) -\u003e Result\u003cOption\u003cT\u003e\u003e {\n        let mut line = String::new();\n        let bytes_read = self.reader.read_line(\u0026mut line).await?;\n        \n        if bytes_read == 0 {\n            return Ok(None); // EOF\n        }\n        \n        self.line_number += 1;\n        \n        let trimmed = line.trim();\n        if trimmed.is_empty() {\n            // Skip empty lines, read next\n            return self.read_line().await;\n        }\n        \n        let value: T = serde_json::from_str(trimmed)\n            .map_err(|e| Error::Json(e))?;\n        \n        Ok(Some(value))\n    }\n}\n```","acceptance_criteria":"- read_line() method implemented\n- Returns Result\u003cOption\u003cT\u003e\u003e (None for EOF)\n- Increments line_number on each line\n- Skips empty lines\n- Deserializes JSON using serde_json\n- Proper error handling for malformed JSON\n- Unit tests verify reading single/multiple lines\n- Unit tests verify EOF handling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:14:40.175422639-06:00","updated_at":"2025-11-27T18:05:52.845896777-06:00","closed_at":"2025-11-27T18:05:52.845896777-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-len","depends_on_id":"rivets-uo7","type":"blocks","created_at":"2025-11-27T17:18:46.616472736-06:00","created_by":"dwalleck"}]}
{"id":"rivets-ljj","content_hash":"74b375204ffb399d499733e719b9ac43d9890d75ab8627f634ca6f90ff6780ab","title":"Refactor output.rs into module structure","description":"Refactor output.rs into a module structure:\n- output/mod.rs - Main exports\n- output/color.rs - Color theme and utilities\n- output/tree.rs - ASCII tree rendering\n- output/table.rs - Table formatting (future)","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-30T12:34:35.368560579-06:00","updated_at":"2025-11-30T12:34:35.368560579-06:00","source_repo":".","labels":["phase-1a","refactor","ux"],"dependencies":[{"issue_id":"rivets-ljj","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:34:35.400167477-06:00","created_by":"dwalleck"}]}
{"id":"rivets-lmh","content_hash":"3954bf3e70d391081e4f99ee7afa3beea2744a6e050e359c146a43cbd5d834d4","title":"Documentation and integration guide","description":"Write documentation:\n- README.md with usage instructions\n- Integration guide for Claude Code\n- API documentation for tools","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T19:16:50.94917515-06:00","updated_at":"2025-12-07T18:02:07.288716558-06:00","closed_at":"2025-12-07T18:02:07.288716558-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-lmh","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:18:08.321412946-06:00","created_by":"dwalleck"}]}
{"id":"rivets-lryg","content_hash":"0ca7c2ffcb947c96158ed2f65559b267baa5756e37e11df213017a2f9f3e3c53","title":"Warn when closing/reopening already closed/open issues","description":"Running `rivets close` on an already-closed issue or `rivets reopen` on an already-open issue silently succeeds. Should inform the user the issue is already in that state.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-11T16:47:34.156430368-06:00","updated_at":"2026-01-11T16:58:47.138653682-06:00","closed_at":"2026-01-11T16:58:47.138653682-06:00","source_repo":".","labels":["cli","ux"]}
{"id":"rivets-lxbg","content_hash":"bc1131f8db5d29657125c4d785a715cf19cdc51cc33cb026a605403c30a26de8","title":"Add imports table to schema","description":"Add `imports` table to track what each file imports:\n\n```sql\nCREATE TABLE imports (\n    file_id INTEGER NOT NULL REFERENCES files(id) ON DELETE CASCADE,\n    symbol_name TEXT NOT NULL,\n    source_module TEXT NOT NULL,\n    alias TEXT,\n    PRIMARY KEY (file_id, symbol_name, source_module)\n);\nCREATE INDEX idx_imports_file ON imports(file_id);\nCREATE INDEX idx_imports_symbol ON imports(symbol_name);\n```\n\nUpdate db.rs with methods to insert/query imports.","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:27:20.547791398-06:00","updated_at":"2026-01-28T11:38:55.129203575-06:00","closed_at":"2026-01-28T11:38:55.129203575-06:00","source_repo":".","labels":["phase1","tethys"],"dependencies":[{"issue_id":"rivets-lxbg","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:31:26.273876098-06:00","created_by":"dwalleck"}]}
{"id":"rivets-lyt","content_hash":"59ba49eb15c203b3830d786b55907d6ee6871c3f7933d664dc377b38cfee4d4a","title":"Add TOCTOU scenario tests for close command","description":"Add tests that verify behavior when notes are modified between read and write operations in the close command. While the TOCTOU window is documented as acceptable for single-user CLI, tests should verify the append behavior works correctly.","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T22:11:19.620773682-06:00","updated_at":"2025-11-29T22:11:19.620773682-06:00","source_repo":".","labels":["pr-feedback","testing"]}
{"id":"rivets-mb5x","content_hash":"433356339a1b9560023f82d54d2c6a04935b72ebcf345cc9593f3df686d1747f","title":"Docs: Add documentation for MAX_VISUAL_DEPTH magic number","description":"Per M-DOCUMENTED-MAGIC guideline, the constant at line 855 lacks explanation:\n\n```rust\nconst MAX_VISUAL_DEPTH: usize = 10;\n```\n\n**Guideline states:**\n\u003e Hardcoded magic values in production code must be accompanied by a comment outlining why this value was chosen.\n\n**Fix:**\n```rust\n/// Maximum indentation depth for tree visualization.\n/// Set to 10 to prevent extremely wide output on terminals while\n/// still showing meaningful hierarchy for most dependency trees.\nconst MAX_VISUAL_DEPTH: usize = 10;\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-28T09:37:35.134166836-06:00","updated_at":"2025-12-28T09:37:35.134166836-06:00","source_repo":".","labels":["M-DOCUMENTED-MAGIC","docs","execute.rs"],"dependencies":[{"issue_id":"rivets-mb5x","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:38:41.231471727-06:00","created_by":"dwalleck"}]}
{"id":"rivets-n08s","content_hash":"531647bbd89833a52720b3c41ab9110ffcee0e687476c0b814cdc77d331974f8","title":"Prompt for prefix in `rivets init` when not provided","description":"When running `rivets init` without a prefix argument, prompt users to enter one interactively (similar to how we prompt when creating an issue).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T16:47:22.022380598-06:00","updated_at":"2026-01-11T16:54:29.05216718-06:00","closed_at":"2026-01-11T16:54:29.05216718-06:00","source_repo":".","labels":["cli","ux"]}
{"id":"rivets-n3w","content_hash":"b381b90017e64721cef9cbeaa958c1ee433640694935323edab1318fc6ef1f45","title":"Add smart suggestions after operations","description":"Show context-aware suggestions after operations:\n\n```\n$ rivets close rivets-abc\nClosed issue: rivets-abc\n\nTip: rivets-def is now unblocked. Run 'rivets ready' to see available work.\n```\n\nAlso show warnings for risky operations:\n```\n$ rivets update rivets-abc --status closed\nWarning: Use 'rivets close' instead for proper close workflow.\nContinue anyway? [y/N]:\n```","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:36:24.182937809-06:00","updated_at":"2025-11-30T12:36:24.182937809-06:00","source_repo":".","labels":["phase-2","ux"],"dependencies":[{"issue_id":"rivets-n3w","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:36:24.212771351-06:00","created_by":"dwalleck"}]}
{"id":"rivets-nwwm","content_hash":"33018c355a8699240f79e849898b01257095d1c8fcafb275094b5e9e896abe62","title":"Implement LspProvider trait + RustAnalyzerProvider","description":"Create abstraction for language-specific LSP configuration:\n\n```rust\npub trait LspProvider: Send + Sync {\n    fn command(\u0026self) -\u003e \u0026str;\n    fn initialize_options(\u0026self) -\u003e Value;\n}\n\npub struct RustAnalyzerProvider;\nimpl LspProvider for RustAnalyzerProvider {\n    fn command(\u0026self) -\u003e \u0026str { \"rust-analyzer\" }\n}\n```\n\nThis allows adding csharp-ls later without changing LspClient.","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:28:43.848216481-06:00","updated_at":"2026-01-28T18:00:15.77362804-06:00","closed_at":"2026-01-28T18:00:15.77362804-06:00","source_repo":".","labels":["lsp","phase2","tethys"],"dependencies":[{"issue_id":"rivets-nwwm","depends_on_id":"rivets-h1va","type":"blocks","created_at":"2026-01-28T11:30:26.809962725-06:00","created_by":"dwalleck"},{"issue_id":"rivets-nwwm","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:24.234784184-06:00","created_by":"dwalleck"}]}
{"id":"rivets-o7o","content_hash":"af3868d28f6378a10010a8364eb516398426a87e7083e31af6a4d1bc2e53fe55","title":"Consider splitting integration.rs by test category","description":"The integration test file has grown to 1,638 lines. Consider splitting it into separate files organized by test category for better maintainability.","design":"Potential split structure for `crates/rivets-mcp/tests/`:\n\n```\ntests/\n├── common/\n│   └── mod.rs          # Shared fixtures, helpers (IssueSetup, FilterParams, etc.)\n├── crud_tests.rs       # Basic create/show/update/close operations\n├── list_filter_tests.rs # List filter combinations\n├── ready_filter_tests.rs # Ready filter combinations  \n├── dependency_tests.rs  # Dependency management tests\n├── context_tests.rs     # Workspace context tests\n└── edge_case_tests.rs   # Edge cases (empty results, unicode, etc.)\n```\n\nBenefits:\n- Easier to find relevant tests\n- Faster incremental compilation when modifying one category\n- Clearer test organization\n\nThis is low priority - the current single file works fine, just harder to navigate as it grows.","acceptance_criteria":"- [ ] Evaluate whether splitting improves maintainability\n- [ ] If splitting, organize tests into logical categories\n- [ ] Ensure shared test utilities are extracted to a common module\n- [ ] All tests continue to pass after reorganization","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-29T19:07:57.543771055-06:00","updated_at":"2025-11-29T19:07:57.543771055-06:00","source_repo":".","labels":["mcp","refactoring","testing"]}
{"id":"rivets-oeu5","content_hash":"bcc5e880efb59052e7eb3764cd8618f908961c0d70ca84da0ee8fe73b30a83ef","title":"Add --lsp flag to CLI commands","description":"Add `--lsp` flag to: index, callers, impact\n\nBehavior:\n- If --lsp and LSP available: use LSP\n- If --lsp and LSP missing: error and halt with helpful message\n- No flag: tree-sitter only\n\nError message should include installation instructions for rust-analyzer.","status":"closed","priority":2,"issue_type":"task","assignee":"claude","created_at":"2026-01-28T11:28:50.1588665-06:00","updated_at":"2026-01-28T18:31:18.920171795-06:00","closed_at":"2026-01-28T18:31:18.920171795-06:00","source_repo":".","labels":["lsp","phase2","tethys"],"dependencies":[{"issue_id":"rivets-oeu5","depends_on_id":"rivets-nwwm","type":"blocks","created_at":"2026-01-28T11:30:33.164024454-06:00","created_by":"dwalleck"},{"issue_id":"rivets-oeu5","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:32:30.531317104-06:00","created_by":"dwalleck"}]}
{"id":"rivets-p4n","content_hash":"c1e0136ed9098c4314d5f8601fc87c8aecfb2f28725a63c6a917f35b7dad2eb0","title":"Implement TUI dependency graph view","description":"Create dependency graph visualization in TUI:\n- ASCII art graph of issue dependencies\n- Color-coded nodes by status\n- Navigate graph with keyboard\n- Show dependency types (blocks, related, parent-child, discovered-from)\n- Highlight current issue and its connections","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:37:12.590091097-06:00","updated_at":"2025-11-30T12:37:12.590091097-06:00","source_repo":".","labels":["phase-3","tui"],"dependencies":[{"issue_id":"rivets-p4n","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:37:12.592716669-06:00","created_by":"dwalleck"}]}
{"id":"rivets-p7v","content_hash":"fb1cffffd0c6fb9671ec97213ec54b966cd33de6e80b0d6e9bf37d24ab45afff","title":"Implement rivets CLI skeleton with basic command structure","description":"Create the initial implementation of the rivets CLI application including main.rs, CLI argument parsing with clap, and stub modules for commands and domain logic. Create a hello-world style application that compiles and runs as `bd`.","design":"Based on rivets-kr3 design:\n- Create src/main.rs with CLI entry point\n- Create src/cli.rs with clap-based argument parsing\n- Create src/commands/ module with stub command implementations\n- Create src/domain/ module for issue tracking domain types\n- Create src/storage.rs stub for storage layer\n- Create src/config.rs stub for configuration\n- Create src/error.rs for CLI-specific errors\n- Ensure binary is named 'rivets' in Cargo.toml\n- Add basic integration test that runs the CLI","acceptance_criteria":"- Application compiles and runs as `rivets` command\n- CLI argument parsing works with clap\n- Help message displays correctly with `rivets --help`\n- All module stubs created with proper exports\n- Basic integration test runs the CLI successfully\n- `cargo test --package rivets` passes\n- `cargo run --package rivets` executes without errors","status":"closed","priority":1,"issue_type":"task","assignee":"Claude","created_at":"2025-11-17T15:45:33.081597765-06:00","updated_at":"2025-11-17T16:08:32.126908789-06:00","closed_at":"2025-11-17T16:08:32.126908789-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-p7v","depends_on_id":"rivets-kr3","type":"blocks","created_at":"2025-11-17T15:45:33.08312916-06:00","created_by":"daemon"}]}
{"id":"rivets-pae","content_hash":"3315ba4a42c05bcf4390bfd7b3493537486a6d478f99352c9f5a9a74c5132307","title":"Block ANSI escape sequences in title validation","description":"Explicitly block ANSI escape sequences in validate_title() to prevent terminal manipulation attacks. Current validation blocks control characters 0x00-0x1F and 0x7F-0x9F, but ANSI sequences starting with ESC (0x1B) followed by [ could still be used for terminal manipulation.","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T22:11:36.937708941-06:00","updated_at":"2025-11-29T22:11:36.937708941-06:00","source_repo":".","labels":["pr-feedback","security"]}
{"id":"rivets-pex","content_hash":"27a37a882bbdb87f98b4006f76545fb3d220a60ec674bc1cd845f3524394dd94","title":"Add progress spinners for long operations","description":"Add progress spinners for operations that may take time:\n- List command with many issues\n- Dependency tree calculation\n- Ready work calculation\n- Import/export operations\n\nShow elapsed time for operations \u003e500ms.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-30T12:35:25.358698235-06:00","updated_at":"2025-11-30T12:35:25.358698235-06:00","source_repo":".","labels":["phase-1b","ux"],"dependencies":[{"issue_id":"rivets-pex","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:35:25.361236379-06:00","created_by":"dwalleck"}]}
{"id":"rivets-q3z","content_hash":"8d0d42117908749e3530109185868b34a1f6a788cac23d665beb68459fc4b36b","title":"Consider lazy storage initialization","description":"Currently `set_workspace()` creates the storage instance immediately. Consider lazy initialization where storage is only created on first actual use.\n\nThis could reduce startup overhead for multi-workspace scenarios where not all workspaces are actively used.","design":"**Current behavior:**\n- `set_workspace()` calls `create_storage()` immediately\n- Storage is cached but created eagerly\n\n**Potential optimization:**\nStore workspace config without initializing storage until first tool call needs it:\n\n```rust\nenum CachedWorkspace {\n    Pending { db_path: PathBuf },\n    Initialized { storage: Arc\u003cRwLock\u003cBox\u003cdyn IssueStorage\u003e\u003e\u003e },\n}\n```\n\n**Trade-offs:**\n- Pro: Faster `set_context` calls\n- Pro: Less memory for unused workspaces\n- Con: First tool call per workspace has latency\n- Con: More complex code\n\n**When to consider:**\nProfile first - may not matter for typical usage patterns.","acceptance_criteria":"- [ ] Profile to determine if eager initialization is actually a bottleneck\n- [ ] If needed, implement lazy initialization pattern\n- [ ] Ensure first-use latency is acceptable\n- [ ] No regression for single-workspace usage","status":"open","priority":4,"issue_type":"task","created_at":"2025-11-28T22:41:25.3886956-06:00","updated_at":"2025-11-28T22:41:25.3886956-06:00","source_repo":".","labels":["future","optimization","performance"]}
{"id":"rivets-q82","content_hash":"c168068f16f1d0d92d16e92b5b606f265ab169cbbef6c93cb98a816047d42ea0","title":"Apply Microsoft Pragmatic Rust Guidelines to rivets crate","description":"Code review findings from analyzing the rivets crate against the Pragmatic Rust Guidelines.\n\n**Modules reviewed:**\n- cli/ (args.rs, execute.rs, mod.rs, types.rs, validators.rs)\n- commands/ (init.rs, mod.rs)\n- domain/ (mod.rs)\n- storage/in_memory/ (graph.rs, inner.rs, jsonl.rs, mod.rs, sorting.rs, trait_impl.rs)\n\nThese issues address code quality, maintainability, DRY violations, magic number documentation, and adherence to Rust best practices.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-28T09:36:35.212044095-06:00","updated_at":"2025-12-28T09:52:28.492032788-06:00","source_repo":"."}
{"id":"rivets-qeb","content_hash":"c160001aeab01b9792473ae5b7c838e086d3dc73d9f28389adf39d63d46a430a","title":"Implement ready work algorithm with recursive blocking","description":"Implement the ready work detection algorithm that finds unblocked issues by recursively propagating blocks through parent-child hierarchies using CTEs.","design":"Based on beads ready.go, adapted for Phase 1 (in-memory + petgraph):\n\n**Algorithm** (Phase 1 - petgraph):\n1. Find directly blocked issues (via 'blocks' deps to open/in_progress issues)\n2. Recursively propagate blockage through parent-child deps (depth limit 50)\n3. Exclude all blocked issues from results\n\n**Phase 1 Implementation**:\n```rust\nimpl InMemoryStorage {\n    fn find_ready(\u0026self, filter: Option\u003c\u0026IssueFilter\u003e) -\u003e Result\u003cVec\u003cIssue\u003e\u003e {\n        use petgraph::Direction;\n        \n        // Find all blocked issues\n        let mut blocked = HashSet::new();\n        \n        // Direct blocks: issues with blocking dependencies\n        for (id, issue) in \u0026self.issues {\n            if issue.status == Status::Closed {\n                continue;\n            }\n            \n            for dep in \u0026issue.dependencies {\n                if dep.dep_type == DependencyType::Blocks {\n                    let blocker = self.issues.get(\u0026dep.depends_on_id)?;\n                    if blocker.status == Status::Open || blocker.status == Status::InProgress {\n                        blocked.insert(id.clone());\n                    }\n                }\n            }\n        }\n        \n        // Transitive blocking via parent-child (BFS with depth limit)\n        let mut to_process: VecDeque\u003c(IssueId, usize)\u003e = blocked.iter()\n            .map(|id| (id.clone(), 0))\n            .collect();\n        \n        while let Some((id, depth)) = to_process.pop_front() {\n            if depth \u003e= 50 { continue; }\n            \n            // Find children (issues that depend on this one via parent-child)\n            let node = self.node_map.get(\u0026id)?;\n            for edge in self.graph.edges_directed(*node, Direction::Incoming) {\n                if edge.weight() == \u0026DependencyType::ParentChild {\n                    let child_node = edge.source();\n                    let child_id = \u0026self.graph[child_node];\n                    if blocked.insert(child_id.clone()) {\n                        to_process.push_back((child_id.clone(), depth + 1));\n                    }\n                }\n            }\n        }\n        \n        // Filter out blocked issues\n        let mut ready: Vec\u003cIssue\u003e = self.issues.values()\n            .filter(|issue| {\n                issue.status != Status::Closed \n                \u0026\u0026 !blocked.contains(\u0026issue.id)\n            })\n            .cloned()\n            .collect();\n        \n        // Apply additional filter if provided\n        if let Some(filter) = filter {\n            ready = self.apply_filter(ready, filter)?;\n        }\n        \n        // Sort by policy (hybrid default)\n        self.sort_by_policy(\u0026mut ready, SortPolicy::Hybrid);\n        \n        Ok(ready)\n    }\n}\n```\n\n**Sort Policies**:\n- `hybrid` (default): Recent (48h) by priority, older by age\n- `priority`: P0→P1→P2→P3→P4 strict\n- `oldest`: Creation date ascending\n\n**Phase 3 (PostgreSQL)**: Will use recursive CTEs for blocking propagation (see design notes)","acceptance_criteria":"- Ready issues query excludes blocked work using petgraph\n- Recursive parent-child blocking via BFS traversal\n- All 3 sort policies implemented\n- Depth limit (50) prevents infinite loops\n- Performance: \u003c10ms for 1000 issues\n- Unit tests for complex blocking scenarios\n- Integration test with various dependency graphs","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T16:15:21.592668862-06:00","updated_at":"2025-11-28T13:38:24.156494963-06:00","closed_at":"2025-11-28T13:38:24.156494963-06:00","source_repo":"."}
{"id":"rivets-ql0","content_hash":"a91af33fd6d72fb0e752f34963ce69442a14f3296dd010e3fa85769119910c7b","title":"Implement rivets tui subcommand","description":"Add `rivets tui` subcommand that launches the terminal UI.\n\nCreate module structure:\n- src/tui/mod.rs - TUI module entry\n- src/tui/app.rs - Application state (Elm-like Model-View-Update)\n- src/tui/ui/ - View components\n- src/tui/widgets/ - Reusable widgets\n\nUse ratatui with crossterm backend.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T12:37:01.0655948-06:00","updated_at":"2025-11-30T12:37:01.0655948-06:00","source_repo":".","labels":["phase-3","tui"],"dependencies":[{"issue_id":"rivets-ql0","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:37:01.067594028-06:00","created_by":"dwalleck"}]}
{"id":"rivets-rg0","content_hash":"f0f68050c1bf7f7260435e346f0f39773fb06a8e17c693a54fe76648a5265ec9","title":"Create rivets-mcp crate structure","description":"Create the rivets-mcp crate directory structure:\n- crates/rivets-mcp/src/{lib.rs, main.rs, server.rs, tools.rs, context.rs, models.rs, error.rs}\n- Add to workspace Cargo.toml\n- Configure dependencies (rmcp, schemars, etc.)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T19:16:00.027928947-06:00","updated_at":"2025-11-28T21:06:21.145518766-06:00","closed_at":"2025-11-28T21:06:21.145518766-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-rg0","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:17:17.457052348-06:00","created_by":"dwalleck"}]}
{"id":"rivets-rg8","content_hash":"a842775b284e396c188bd16d05de99470b65e4e55feedc0b8112ce13aca7fe73","title":"Implement AutomergeStorage: IssueStorage trait","description":"Implement the full IssueStorage trait for AutomergeStorage, including all CRUD, dependency, and query methods.\n\nIncludes:\n- AutomergeStorage struct with in-memory cache (HashMap + petgraph)\n- Implement rebuild_dependency_graph() for post-hydration graph construction\n- All IssueStorage trait methods\n- Wire into storage factory and config (StorageBackend::Automerge variant)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T13:10:33.301178192-06:00","updated_at":"2025-12-22T22:45:05.425292273-06:00","closed_at":"2025-12-22T22:45:05.425292273-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-rg8","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T13:10:33.331887167-06:00","created_by":"dwalleck"}]}
{"id":"rivets-rndz","content_hash":"316cea28e53bf11d482e57881a683bb8b1e5c94cf32b8b157aaf71a9c399b1d5","title":"Update get_callers/get_symbol_impact to use resolved refs","description":"The graph operations should now pick up cross-file references since they're stored with proper symbol_id after Pass 2.\n\nVerify that:\n- `get_callers()` returns callers from other files\n- `get_symbol_impact()` shows transitive dependents across files","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T11:27:45.836727912-06:00","updated_at":"2026-01-28T12:10:27.543232953-06:00","closed_at":"2026-01-28T12:10:27.543232953-06:00","source_repo":".","labels":["phase1","tethys"],"dependencies":[{"issue_id":"rivets-rndz","depends_on_id":"rivets-4tev","type":"blocks","created_at":"2026-01-28T11:29:51.002383912-06:00","created_by":"dwalleck"},{"issue_id":"rivets-rndz","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:31:52.048272737-06:00","created_by":"dwalleck"}]}
{"id":"rivets-ry6","content_hash":"188f8b0e8fa678bb4fc082986006ffb5019a69254496ee2c4ae5b794dabb9122","title":"Adopt rstest for test improvement","description":"Adopt the rstest crate to improve test code quality and reduce duplication. rstest provides fixtures, parameterized tests, and matrix testing capabilities that will eliminate 20-30% of test code duplication.","acceptance_criteria":"- rstest dependency added to both crates\n- High-impact test files converted to use rstest fixtures and parameterization\n- All tests pass after conversion\n- Measurable reduction in test code lines","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-28T18:55:47.850281116-06:00","updated_at":"2025-11-28T20:11:34.462327431-06:00","closed_at":"2025-11-28T20:11:34.462327431-06:00","source_repo":"."}
{"id":"rivets-s15r","content_hash":"a1083c3c7c49abba5cbfa62a8ed9b04a518dae7ac1af076bcae62c2af32ecb94","title":"Implement deferred dependency resolution for circular dependencies","description":"Currently, dependency detection fails silently when the target file hasn't been indexed yet. This happens with circular dependencies (A→B, B→A) where the first-indexed file's dependency on the second file is lost.\n\n**Current behavior**: Dependencies can only be recorded to files already in the database. Files indexed earlier may not have their dependencies to later-indexed files recorded.\n\n**Proposed solution**: Instead of two full passes, queue unresolved dependencies and retry after the initial pass:\n\n1. First pass: Index all files, queue dependencies that fail to resolve (target not in DB)\n2. Resolution passes: Retry pending queue until it stops shrinking\n3. Log any remaining unresolved (external crates or truly missing files)\n\n**Convergence check**: `pending.len() \u003c prev_count` ensures we don't loop forever.\n\n**Benefits**:\n- More efficient than re-indexing everything\n- Handles circular dependencies elegantly\n- Minimal code change to existing `index()` flow","design":"```rust\nstruct PendingDependency {\n    from_file_id: i64,\n    dep_path: PathBuf,\n}\n\nfn index(\u0026mut self) -\u003e Result\u003cIndexStats\u003e {\n    let files = self.discover_files()?;\n    let mut pending: Vec\u003cPendingDependency\u003e = Vec::new();\n    \n    // First pass: index all files, queue failed dependencies\n    for file in \u0026files {\n        self.index_file_atomic(file, \u0026mut pending)?;\n    }\n    \n    // Resolution passes: retry pending until stable\n    let mut prev_count = pending.len() + 1;\n    while !pending.is_empty() \u0026\u0026 pending.len() \u003c prev_count {\n        prev_count = pending.len();\n        pending = self.resolve_pending(pending)?;\n    }\n    \n    // Log remaining unresolved\n    for p in \u0026pending {\n        debug!(from_file = p.from_file_id, dep = %p.dep_path.display(), \n               \"Dependency unresolved after all passes\");\n    }\n    \n    Ok(stats)\n}\n```","acceptance_criteria":"- [ ] `PendingDependency` struct created\n- [ ] `index_file_atomic` modified to return pending dependencies instead of silently dropping\n- [ ] `resolve_pending()` method implemented\n- [ ] Convergence loop in `index()` with shrinking check\n- [ ] Test: circular dependency (A→B, B→A) both directions detected\n- [ ] Test: convergence terminates for external crates\n- [ ] Debug logging for unresolved dependencies after all passes","status":"closed","priority":2,"issue_type":"feature","assignee":"claude","created_at":"2026-01-22T21:27:52.579637343-06:00","updated_at":"2026-01-22T22:12:37.921123478-06:00","closed_at":"2026-01-22T22:12:37.921123478-06:00","source_repo":".","labels":["enhancement","phase-2.5","tethys"]}
{"id":"rivets-s3o","content_hash":"2933f2d71d2b0699e30ef014cb0536738afa36910a43c5e3bd1b2ccf369fd5ef","title":"Implement context management module","description":"Implement workspace context management:\n- Workspace detection (walk up to find .rivets/)\n- Path canonicalization\n- Per-workspace storage instance management\n- Context state storage (Arc\u003cRwLock\u003c\u003e\u003e)","acceptance_criteria":"- [ ] Workspace detection walks up to find .rivets/\n- [ ] Path canonicalization handles symlinks\n- [ ] Storage instances cached per workspace\n- [ ] Unit tests: discover_workspace, set_workspace, storage caching","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T19:16:11.298145823-06:00","updated_at":"2025-11-29T08:41:24.606759038-06:00","closed_at":"2025-11-29T08:41:24.606759038-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-s3o","depends_on_id":"rivets-4dw","type":"parent-child","created_at":"2025-11-28T19:17:28.764815773-06:00","created_by":"dwalleck"},{"issue_id":"rivets-s3o","depends_on_id":"rivets-cfx","type":"blocks","created_at":"2025-11-28T19:18:30.099861775-06:00","created_by":"dwalleck"}]}
{"id":"rivets-sv1x","content_hash":"4d1a2e0c42bc3ad17433b1024f1b041c044afad127eeb883f2c4c530afde3956","title":"Refactor: Extract App initialization pattern in Cli::execute()","description":"In mod.rs, the pattern `App::from_directory(\u0026std::env::current_dir()?)` is repeated 13 times in the execute() method (lines 186-240):\n\n```rust\nSome(Commands::Info(args)) =\u003e {\n    let app = App::from_directory(\u0026std::env::current_dir()?).await?;\n    execute::execute_info(\u0026app, args, output_mode).await\n}\nSome(Commands::Create(args)) =\u003e {\n    let mut app = App::from_directory(\u0026std::env::current_dir()?).await?;\n    execute::execute_create(\u0026mut app, args, output_mode).await\n}\n// ... repeated 11 more times\n```\n\n**Recommendation:** Consider one of these approaches:\n\n1. **Helper method approach:**\n```rust\nasync fn with_app\u003cF, Fut, R\u003e(\u0026self, f: F) -\u003e Result\u003cR\u003e\nwhere\n    F: FnOnce(App) -\u003e Fut,\n    Fut: Future\u003cOutput = Result\u003cR\u003e\u003e,\n{\n    let app = App::from_directory(\u0026std::env::current_dir()?).await?;\n    f(app).await\n}\n```\n\n2. **Early initialization:** Initialize the app once before the match (for commands that need it)\n\n3. **Macro approach:** Create a macro to reduce boilerplate\n\nThis reduces duplication and makes the execute method more readable.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T09:45:13.765152589-06:00","updated_at":"2025-12-28T15:15:09.942608111-06:00","closed_at":"2025-12-28T15:15:09.942608111-06:00","source_repo":".","labels":["DRY","cli","mod.rs","refactor"],"dependencies":[{"issue_id":"rivets-sv1x","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:45:36.660083874-06:00","created_by":"dwalleck"}]}
{"id":"rivets-sxl","content_hash":"5baa714c22f97d09282ee02da3b1fe7078841d388c2bc2151cae108a8650fdcc","title":"Add integration test for set_workspace cache eviction","description":"The `evict_oldest()` method is tested in isolation, but the actual eviction trigger in `set_workspace()` (lines 104-107) has no test coverage. The existing `test_cache_eviction` uses `set_test_workspace()` which bypasses eviction logic.","design":"Create an async integration test that:\n1. Creates `MAX_CACHED_WORKSPACES + 1` real temp directories with `.rivets/` structure\n2. Calls `set_workspace()` for each\n3. Verifies the cache stays at the limit and oldest entry is evicted\n\n```rust\n#[tokio::test]\nasync fn test_set_workspace_evicts_when_full() {\n    let temps: Vec\u003cTempDir\u003e = (0..=MAX_CACHED_WORKSPACES)\n        .map(|_| TempDir::new().unwrap())\n        .collect();\n    \n    // Initialize .rivets/ in each\n    for temp in \u0026temps {\n        std::fs::create_dir(temp.path().join(\".rivets\")).unwrap();\n    }\n    \n    let mut context = Context::new();\n    \n    // Fill cache to limit\n    for temp in \u0026temps[..MAX_CACHED_WORKSPACES] {\n        context.set_workspace(temp.path()).await.unwrap();\n    }\n    assert_eq!(context.cache_size(), MAX_CACHED_WORKSPACES);\n    \n    let first_workspace = temps[0].path().canonicalize().unwrap();\n    \n    // Add one more - should trigger eviction\n    context.set_workspace(temps[MAX_CACHED_WORKSPACES].path()).await.unwrap();\n    \n    assert_eq!(context.cache_size(), MAX_CACHED_WORKSPACES);\n    assert!(!context.storage_cache.contains_key(\u0026first_workspace));\n}\n```\n\n**Location:** `context.rs` tests module","acceptance_criteria":"- [ ] Integration test exercises actual `set_workspace()` eviction path\n- [ ] Test uses real temp directories (not `set_test_workspace`)\n- [ ] Verifies cache size stays at `MAX_CACHED_WORKSPACES`\n- [ ] Verifies oldest workspace is removed from cache","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-28T22:32:31.990408907-06:00","updated_at":"2025-11-28T22:32:31.990408907-06:00","source_repo":".","labels":["coverage","testing"]}
{"id":"rivets-t0k","content_hash":"d80696ae63fc2a72d1c148fe88572204cc4a11e03f85f9b65ebb63d32fbac962","title":"Add comprehensive tests for resilient loading","description":"Create comprehensive tests for Phase 2 resilient loading functionality.\n\nTests should verify warning collection, error recovery, and integration with in_memory storage.","design":"Test categories:\n\n**Warning collection tests**:\n- Collect warnings for malformed JSON\n- Collect warnings for skipped lines\n- Warning contains correct line numbers\n- Multiple warnings collected\n\n**Resilient streaming tests**:\n- stream_resilient() continues on errors\n- stream_resilient() yields only valid records\n- Mixed valid/invalid records handled correctly\n\n**Integration tests**:\n- read_jsonl_resilient() with corrupted file\n- in_memory::load_from_jsonl with warnings\n- Verify existing in_memory tests still pass","acceptance_criteria":"- Unit tests for warning collection\n- Unit tests for stream_resilient()\n- Integration tests for read_jsonl_resilient()\n- Integration tests for in_memory integration\n- All tests pass\n- Test coverage \u003e80% for Phase 2 code","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:16:12.327924224-06:00","updated_at":"2025-11-28T01:16:42.034792534-06:00","closed_at":"2025-11-28T01:16:42.034792534-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-t0k","depends_on_id":"rivets-4q2","type":"blocks","created_at":"2025-11-27T17:19:44.169696383-06:00","created_by":"dwalleck"}]}
{"id":"rivets-tri","content_hash":"62c4df58d4e60b4ea2ea7e7f2d4341083334c14491ef766b44653f38e77ef0ca","title":"Find domain name for Rivets","description":"Research and select an appropriate domain name for the Rivets project. Use the domain name brainstormer skill to generate and evaluate potential domain options that align with the project's identity as a Rust-based project tracking system.","notes":"## Domain Name Research for Rivets (Updated 2025-11-30)\n\n### Project Context\n- Rivets is a Rust-based issue tracking system using JSONL storage\n- CLI-first developer tool\n- Human-readable, version-control friendly\n- Alternative to traditional issue trackers\n\n---\n\n## DECISION: rivets.rs\n\nSelected **rivets.rs** as the official domain for the Rivets project.\n\n### Why This Choice\n- Perfect alignment with Rust ecosystem (.rs = Rust file extension)\n- Follows precedent of other Rust projects (docs.rs, lib.rs, crates.io)\n- Short, memorable, and brandable\n- Available via Serbian registrars (ISTanCo, EuroDNS, etc.)\n- ~€10-18/year pricing\n\n### Registration Notes\n- .rs domains available from: ISTanCo (istanco.rs), SkyHosting, EuroDNS, Gandi\n- No local presence required - open to worldwide registration\n- Note: Some corporate firewalls may block .rs TLD (Serbia)\n\n---\n\n## Research Summary (for reference)\n\n### Domains Checked - TAKEN\n- rivets.dev (Frontier.sh)\n- rivets.io (for sale)\n- rivets.com\n- getrivets.com\n- rivet.dev (Rivet stateful backends)\n\n### Alternative Options Considered\n- gorivets.dev, rivethq.dev, rivetcli.com (potentially available)\n- rivets.rs (SELECTED)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T22:00:32.666023401-06:00","updated_at":"2025-12-07T17:36:51.172920061-06:00","closed_at":"2025-12-07T17:36:51.172920061-06:00","source_repo":"."}
{"id":"rivets-ugg6","content_hash":"c4f96da1b2df8f38a58516fb69ad2744100934c9347adc2cb3567d6022dc8ecf","title":"Add integration tests for cross-file resolution","description":"Add tests in tests/indexing.rs:\n\n- cross_file_callers_via_explicit_import\n- cross_file_callers_via_qualified_path  \n- cross_file_callers_via_glob_import\n- csharp_cross_file_via_namespace\n\nEach test creates a multi-file workspace and verifies callers() finds cross-file references.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T11:27:52.150595727-06:00","updated_at":"2026-01-28T12:11:03.344673588-06:00","closed_at":"2026-01-28T12:11:03.344673588-06:00","source_repo":".","labels":["phase1","tethys"],"dependencies":[{"issue_id":"rivets-ugg6","depends_on_id":"rivets-rndz","type":"blocks","created_at":"2026-01-28T11:29:57.221809115-06:00","created_by":"dwalleck"},{"issue_id":"rivets-ugg6","depends_on_id":"rivets-zk2q","type":"parent-child","created_at":"2026-01-28T11:31:58.443415343-06:00","created_by":"dwalleck"}]}
{"id":"rivets-uo7","content_hash":"42110ef2eb5cf61fff2afa7aba6e5c513ad7b8d453869632cb60de48f969fb50","title":"Define core JsonlReader and JsonlWriter types","description":"Define the core async types for JsonlReader and JsonlWriter with proper generic parameters and trait bounds. This establishes the foundation for all read/write operations.\n\nBased on research API design:\n- JsonlReader\u003cR: AsyncRead + Unpin\u003e\n- JsonlWriter\u003cW: AsyncWrite + Unpin\u003e\n- Both wrap BufReader/BufWriter for buffering","design":"```rust\nuse tokio::io::{AsyncRead, AsyncWrite, BufReader, BufWriter};\n\npub struct JsonlReader\u003cR\u003e {\n    reader: BufReader\u003cR\u003e,\n    line_number: usize,\n}\n\nimpl\u003cR: AsyncRead + Unpin\u003e JsonlReader\u003cR\u003e {\n    pub fn new(reader: R) -\u003e Self {\n        Self {\n            reader: BufReader::new(reader),\n            line_number: 0,\n        }\n    }\n}\n\npub struct JsonlWriter\u003cW\u003e {\n    writer: BufWriter\u003cW\u003e,\n}\n\nimpl\u003cW: AsyncWrite + Unpin\u003e JsonlWriter\u003cW\u003e {\n    pub fn new(writer: W) -\u003e Self {\n        Self {\n            writer: BufWriter::new(writer),\n        }\n    }\n}\n```\n\nAdd tokio dependency with features = [\"io-util\", \"fs\"].","acceptance_criteria":"- JsonlReader struct defined with generic R: AsyncRead + Unpin\n- JsonlWriter struct defined with generic W: AsyncWrite + Unpin\n- Both have new() constructors\n- BufReader/BufWriter used for buffering\n- Line number tracking in JsonlReader\n- Compiles without errors\n- Basic struct tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:14:00.581453653-06:00","updated_at":"2025-11-27T17:46:18.409886819-06:00","closed_at":"2025-11-27T17:46:18.409886819-06:00","source_repo":".","labels":["phase-1","rivets-jsonl"]}
{"id":"rivets-uqv","content_hash":"3712e60ac3954d21440081a7dfa1f940ba2bdde74e75d8633b24222ab73a376e","title":"Add JSONL export mirroring to AutomergeStorage","description":"Enable optional JSONL file generation on save() for human readability and git diff friendliness.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T13:10:38.970619144-06:00","updated_at":"2025-12-22T22:45:11.249724356-06:00","closed_at":"2025-12-22T22:45:11.249724356-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-uqv","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T13:10:39.001042454-06:00","created_by":"dwalleck"}]}
{"id":"rivets-uvv","content_hash":"d27e5679baaab1738ee503beb7bfdf7f2a5c96c674c93c73c772ace6bfaf8c76","title":"Fix: Blocked status not counted in execute_info","description":"In execute_info (lines 61-66), the fold counting issue statuses doesn't track Blocked issues separately. They're counted in total but have no dedicated counter, inconsistent with execute_stats which tracks blocked separately.\n\n**Current code:**\n```rust\nlet (total, open, in_progress, closed) =\n    all_issues.iter().fold((0, 0, 0, 0), |(t, o, ip, c), issue| match issue.status {\n        IssueStatus::Blocked =\u003e (t + 1, o, ip, c),  // ← Not tracked\\!\n    });\n```\n\n**Fix:** Add a blocked counter to the tuple and output.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T09:37:17.78718522-06:00","updated_at":"2025-12-28T10:04:20.692554031-06:00","closed_at":"2025-12-28T10:04:20.692554031-06:00","source_repo":".","labels":["bug","execute.rs"],"dependencies":[{"issue_id":"rivets-uvv","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:38:23.644658282-06:00","created_by":"dwalleck"}]}
{"id":"rivets-uyg","content_hash":"d8b3eae7e30f02d3087c40b803f851ccdcad960ba70391dd2f6f72351308e585","title":"Implement read_jsonl_resilient() convenience function","description":"Implement the read_jsonl_resilient() convenience function that reads an entire JSONL file into a Vec while collecting warnings.\n\nThis provides an easy-to-use API for resilient loading from file paths.","design":"```rust\nuse std::path::Path;\nuse tokio::fs::File;\nuse futures::StreamExt;\n\npub async fn read_jsonl_resilient\u003cT, P\u003e(\n    path: P\n) -\u003e Result\u003c(Vec\u003cT\u003e, Vec\u003cWarning\u003e)\u003e\nwhere\n    T: DeserializeOwned + 'static,\n    P: AsRef\u003cPath\u003e,\n{\n    let file = File::open(path).await?;\n    let reader = JsonlReader::new(file);\n    let (stream, collector) = reader.stream_resilient();\n    \n    let values: Vec\u003cT\u003e = stream.collect().await;\n    let warnings = collector.into_warnings();\n    \n    Ok((values, warnings))\n}\n```","acceptance_criteria":"- read_jsonl_resilient() function implemented\n- Returns Result\u003c(Vec\u003cT\u003e, Vec\u003cWarning\u003e)\u003e\n- Reads entire file into memory\n- Collects all warnings\n- Integration test with corrupted JSONL file\n- Verifies warnings contain correct line numbers","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:16:01.004393308-06:00","updated_at":"2025-11-27T21:25:03.360959904-06:00","closed_at":"2025-11-27T21:25:03.360959904-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-uyg","depends_on_id":"rivets-8yl","type":"blocks","created_at":"2025-11-27T17:19:32.751981569-06:00","created_by":"dwalleck"}]}
{"id":"rivets-v3s","content_hash":"9e0fec3ebdc67643e8f31d8b9988317f73ff90174f2fbda409f9c2ac2b150b6a","title":"Beads CLI command parity","description":"Implement missing commands and flags from the Beads CLI to achieve feature parity. This epic tracks the high-priority gaps identified in the CLI comparison.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T18:22:08.108387219-06:00","updated_at":"2025-12-27T23:17:28.44218969-06:00","closed_at":"2025-12-27T23:17:28.44218969-06:00","source_repo":"."}
{"id":"rivets-vdi","content_hash":"f82ef6ee667641483d67547d743e479b8135f7dbe1dc0573a484adf1eaa5870d","title":"Wire StorageBackend::Jsonl to use InMemoryStorage::load_from_jsonl","description":"The `StorageBackend::Jsonl(path)` variant exists but returns an error \"JSONL storage backend not yet implemented\". \n\nPer architecture doc, JSONL is persistence for InMemory, not a separate backend. Wire this variant to use `InMemoryStorage::load_from_jsonl(path)`.\n\nThis unblocks the MCP server which already uses `StorageBackend::Jsonl(db_path)` in `context.rs:109`.","design":"Update `create_storage()` in `crates/rivets/src/storage/mod.rs`:\n\n```rust\nStorageBackend::Jsonl(path) =\u003e {\n    let (storage, warnings) = in_memory::load_from_jsonl(\u0026path, \"rivets\".to_string()).await?;\n    if !warnings.is_empty() {\n        // Log warnings - storage still usable\n        for w in \u0026warnings {\n            tracing::warn!(\"JSONL load warning: {:?}\", w);\n        }\n    }\n    Ok(storage)\n}\n```\n\nIf file doesn't exist, create empty InMemoryStorage (first-run case).","acceptance_criteria":"- [ ] `StorageBackend::Jsonl(path)` returns working storage\n- [ ] Loads existing JSONL file if present\n- [ ] Creates empty storage if file doesn't exist (first run)\n- [ ] Warnings logged but don't fail load\n- [ ] MCP server can successfully use Jsonl backend\n- [ ] Unit test for Jsonl backend creation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T17:36:46.342699192-06:00","updated_at":"2025-11-29T17:40:44.382872584-06:00","closed_at":"2025-11-29T17:40:44.382872584-06:00","source_repo":"."}
{"id":"rivets-vmb","content_hash":"d401e30782708339f5b592b547266081caa069422e6cb6b6bdd36d21a668b745","title":"Evaluate rstest for rivets/src/domain/mod.rs and id_generation.rs inline tests","description":"Evaluate and apply rstest improvements to inline unit tests in domain/mod.rs and id_generation.rs.\n\nFiles:\n- crates/rivets/src/domain/mod.rs (lines ~397+)\n- crates/rivets/src/id_generation.rs (lines ~322+)","acceptance_criteria":"- Inline tests evaluated for rstest opportunities\n- Parameterization applied where beneficial\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:19:30.801627179-06:00","updated_at":"2025-11-28T19:30:50.015894878-06:00","closed_at":"2025-11-28T19:30:50.015894878-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-vmb","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T19:20:23.159725054-06:00","created_by":"dwalleck"}]}
{"id":"rivets-vpny","content_hash":"4beb30103ed9746323462b51af4cedab9fb4f3d78883608268abfe5906816521","title":"Docs: Add rationale for MAX_BLOCKING_DEPTH constant","description":"In storage/in_memory/graph.rs (line 18), the constant has minimal documentation:\n\n```rust\n/// Maximum depth for BFS traversal in blocking detection.\n///\n/// This limit prevents infinite loops and handles extremely deep hierarchies gracefully.\nconst MAX_BLOCKING_DEPTH: usize = 50;\n```\n\nPer M-DOCUMENTED-MAGIC guideline, should explain WHY 50 was chosen:\n\n**Suggested documentation:**\n```rust\n/// Maximum depth for BFS traversal in blocking detection.\n///\n/// This limit prevents infinite loops and handles extremely deep hierarchies gracefully.\n/// Set to 50 to:\n/// - Handle practical issue hierarchies (most projects have \u003c 10 levels)\n/// - Provide headroom for complex epics with nested sub-tasks\n/// - Cap worst-case traversal time for malformed graphs\n/// - Balance between completeness and performance\nconst MAX_BLOCKING_DEPTH: usize = 50;\n```","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T09:51:04.569965544-06:00","updated_at":"2025-12-28T09:51:04.569965544-06:00","source_repo":".","labels":["M-DOCUMENTED-MAGIC","docs","graph.rs"],"dependencies":[{"issue_id":"rivets-vpny","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:51:49.177478162-06:00","created_by":"dwalleck"}]}
{"id":"rivets-vvp","content_hash":"3ce913f5e58c5869fa73beb0824ce9955b1bc5a211414a737c4089ad2dd372bf","title":"Add integration tests for new label and issue_type filters","description":"After adding label filter to list() and label/issue_type filters to ready(), add test cases to verify they work correctly.\n\nTest cases needed:\n- list() with label filter - returns only issues with matching label\n- ready() with label filter - returns only ready issues with matching label\n- ready() with issue_type filter - returns only ready issues of specified type\n- Combined filters (e.g., label + priority)\n\nThese should be added as new cases in the rstest parameterized tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T17:57:51.415495689-06:00","updated_at":"2025-11-29T18:03:39.132309974-06:00","closed_at":"2025-11-29T18:03:39.132309974-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-vvp","depends_on_id":"rivets-wfb","type":"blocks","created_at":"2025-11-29T17:58:19.852690666-06:00","created_by":"dwalleck"},{"issue_id":"rivets-vvp","depends_on_id":"rivets-1yi","type":"blocks","created_at":"2025-11-29T17:58:25.579963617-06:00","created_by":"dwalleck"}]}
{"id":"rivets-wao","content_hash":"6fb907229ac8acdf7f951c698ee0a8652ef4b00cd9dfe7566c582017a7f6f954","title":"Implement rivets pick workflow command","description":"Add `rivets pick` command for interactive work claiming:\n\n```\n$ rivets pick\nShowing 5 ready issues sorted by priority:\n\n1. [P0] rivets-abc Fix critical auth bug     @unassigned\n2. [P1] rivets-def Update OAuth tokens       @unassigned  \n3. [P2] rivets-ghi Add unit tests            @unassigned\n\nPick issue to work on (1-3, or 'q' to quit): 1\n\nStarting work on rivets-abc...\n  - Status: open -\u003e in_progress\n  - Assignee: -\u003e alice (you)\n\nReady to work! Run 'rivets done rivets-abc' when complete.\n```","status":"open","priority":4,"issue_type":"feature","created_at":"2025-11-30T12:37:50.467716127-06:00","updated_at":"2025-11-30T12:37:50.467716127-06:00","source_repo":".","labels":["phase-4","workflow"],"dependencies":[{"issue_id":"rivets-wao","depends_on_id":"rivets-6bc","type":"parent-child","created_at":"2025-11-30T12:37:50.471101246-06:00","created_by":"dwalleck"}]}
{"id":"rivets-wfb","content_hash":"a672868c958fd2b107af8f645c143a3d14702f5882f52dc1415468038c2e9c63","title":"Refactor list filter tests to use rstest with struct-based test cases","description":"Replace individual list filter tests with a single rstest parameterized test using a ListFilterCase struct.\n\nCurrent tests to consolidate:\n- test_list_filter_by_status\n- test_list_filter_by_priority\n- test_list_filter_by_type\n- test_list_filter_by_assignee\n- test_list_with_limit\n\nNew structure:\n```rust\nstruct ListFilterCase {\n    name: \u0026'static str,\n    status: Option\u003c\u0026'static str\u003e,\n    priority: Option\u003cu8\u003e,\n    issue_type: Option\u003c\u0026'static str\u003e,\n    assignee: Option\u003c\u0026'static str\u003e,\n    label: Option\u003c\u0026'static str\u003e,\n    limit: Option\u003cusize\u003e,\n    expected_count: usize,\n}\n```\n\nCreate a shared fixture that sets up diverse issues, then parameterize filter assertions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T17:57:39.85568415-06:00","updated_at":"2025-11-29T18:03:27.331176053-06:00","closed_at":"2025-11-29T18:03:27.331176053-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-wfb","depends_on_id":"rivets-jfs","type":"blocks","created_at":"2025-11-29T17:58:08.264488343-06:00","created_by":"dwalleck"}]}
{"id":"rivets-x1e","content_hash":"1d9b77ec1210104cefd4ad1a9b8f59d67368a6379242ec33a2663fffe0dc6589","title":"Implement hash-based ID generation system","description":"Implement the adaptive hash-based ID generation system from beads, which creates collision-resistant IDs using SHA256 and base36 encoding. The system should support adaptive length (4-6 chars based on database size) and hierarchical IDs for parent-child relationships.","design":"Based on beads ids.go (288 LOC):\n\n**Algorithm**:\n1. Combine title, description, creator, timestamp, nonce\n2. SHA256 hash the content\n3. Base36 encode to desired length (4-6 chars)\n4. Format: {prefix}-{hash} (e.g., \"rivets-a3f8\")\n\n**Adaptive Length**:\n- 0-500 issues: 4 chars\n- 500-1,500: 5 chars  \n- 1,500-10,000: 6 chars\n\n**Collision Handling**:\n- Try nonces 0-99\n- If all collide, increase length\n\n**Hierarchical IDs**:\n- Parent-child: \"rivets-a3f8.1\", \"rivets-a3f8.1.2\"\n- Use child_counters table for sequence\n\n**Implementation**:\n- Use `sha2` crate for hashing\n- Custom base36 encoding function\n- Validation regex for ID format","acceptance_criteria":"- Hash ID generation function implemented\n- Adaptive length selection based on DB size\n- Collision detection and handling\n- Hierarchical ID support with dot notation\n- Base36 encoding/decoding\n- ID validation function\n- Unit tests for all scenarios (collisions, hierarchical, validation)","status":"closed","priority":1,"issue_type":"task","assignee":"claude","created_at":"2025-11-17T16:15:21.124541589-06:00","updated_at":"2025-11-17T19:58:56.62873511-06:00","closed_at":"2025-11-17T19:58:56.62873511-06:00","source_repo":"."}
{"id":"rivets-x51","content_hash":"17eaae0b44b8a2dab0260090eb3cc50e5f0193ea4beae8f80a6109a8addb150b","title":"Implement JSONL import/export system","description":"Implement the JSONL import/export system for syncing between SQLite and JSONL files, with content hash deduplication, dirty tracking, and conflict resolution.","design":"Based on beads importer (internal/importer/):\n\n**Export Flow**:\n1. Query dirty_issues table\n2. Serialize issues with embedded deps, labels, comments\n3. Compute content hash for deduplication\n4. Write to issues.jsonl (newline-delimited)\n5. Clear dirty flags\n\n**Import Flow**:\n1. Read JSONL line-by-line\n2. Parse and validate each issue\n3. Content hash comparison for conflict detection\n4. Upsert to SQLite\n5. Handle orphan dependencies (resurrect/skip/fail)\n\n**Features**:\n- Incremental dirty tracking\n- Content hash prevents duplicate writes\n- Prefix validation and migration\n- Orphan handling policies\n- External ref duplicate detection\n\n**Rust Implementation**:\n- Use serde_json for parsing\n- Streaming reader for large files\n- Batch inserts for performance","acceptance_criteria":"- Export writes issues to JSONL format\n- Import reads JSONL into SQLite\n- Content hash deduplication working\n- Dirty tracking identifies changed issues\n- Orphan handling implemented\n- Conflict resolution via content hash\n- Performance: 1000 issues in \u003c1 second\n- Integration tests for round-trip consistency","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-17T16:16:06.672016354-06:00","updated_at":"2025-11-17T17:02:47.394020398-06:00","closed_at":"2025-11-17T17:02:47.394020398-06:00","source_repo":"."}
{"id":"rivets-xi4","content_hash":"a57e68090f6503fe69cac1f354fc27112519de067ab362e08fc35857c2a0b6b9","title":"Add rstest dependency to both crates","description":"Add rstest = \"0.26\" to dev-dependencies in both workspace crates.\n\nFiles to modify:\n- crates/rivets/Cargo.toml\n- crates/rivets-jsonl/Cargo.toml","acceptance_criteria":"- rstest = \"0.26\" added to dev-dependencies in both Cargo.toml files\n- cargo build succeeds\n- cargo test succeeds (no changes to tests yet)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-28T18:55:59.605072624-06:00","updated_at":"2025-11-28T20:07:41.450391325-06:00","closed_at":"2025-11-28T20:07:41.450391325-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-xi4","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T18:57:15.691977047-06:00","created_by":"dwalleck"}]}
{"id":"rivets-xjam","content_hash":"6fbf63d44112e9e239c62d8c60956d5cf72c57495c9c412cf73db3d2d1ed8b70","title":"Docs: Add rationale for ID length threshold constants (500, 1500)","description":"In storage/in_memory/inner.rs (lines 74-82), the magic numbers 500 and 1500 lack explanation:\n\n```rust\nlet needs_update = match (old_size, current_size) {\n    // Crossing 500 boundary (4 -\u003e 5 chars)\n    (0..=500, 501..) =\u003e true,\n    // Crossing 1500 boundary (5 -\u003e 6 chars)\n    (0..=1500, 1501..) =\u003e true,\n    ...\n};\n```\n\nThe comments say WHAT happens (4-\u003e5 chars, 5-\u003e6 chars) but not WHY these thresholds were chosen.\n\nPer M-DOCUMENTED-MAGIC guideline, should explain the rationale:\n\n**Suggested documentation:**\n```rust\n/// ID length thresholds for adaptive ID generation.\n///\n/// These values are derived from the ID generator's collision probability calculations:\n/// - At 500 issues with 4-char IDs: collision probability exceeds 1%\n/// - At 1500 issues with 5-char IDs: collision probability exceeds 1%\n/// - 6-char IDs support \u003e50,000 issues before similar collision rates\n///\n/// Thresholds chosen to balance ID brevity with uniqueness guarantees.\nconst ID_LENGTH_THRESHOLD_4_TO_5: usize = 500;\nconst ID_LENGTH_THRESHOLD_5_TO_6: usize = 1500;\n```","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T09:51:10.35242714-06:00","updated_at":"2025-12-28T09:51:10.35242714-06:00","source_repo":".","labels":["M-DOCUMENTED-MAGIC","docs","inner.rs"],"dependencies":[{"issue_id":"rivets-xjam","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:51:55.01192252-06:00","created_by":"dwalleck"}]}
{"id":"rivets-xwcy","content_hash":"52deca849aa4bce494a56f7f2858517d8ac338b2c1a420cecad9f0ac76c8418c","title":"Docs: Add documentation for MAX_LABEL_LENGTH magic number","description":"In validators.rs (line 153), the constant lacks explanation:\n\n```rust\n/// Maximum length for labels\npub const MAX_LABEL_LENGTH: usize = 50;\n```\n\nPer M-DOCUMENTED-MAGIC guideline:\n\u003e Hardcoded magic values in production code must be accompanied by a comment outlining why this value was chosen.\n\n**Fix:** Add reasoning for why 50 was chosen:\n```rust\n/// Maximum length for labels.\n///\n/// Set to 50 characters to:\n/// - Keep labels concise and readable in CLI output\n/// - Allow for descriptive multi-word labels (e.g., \"needs-security-review\")\n/// - Align with common tag/label length limits in other issue trackers\npub const MAX_LABEL_LENGTH: usize = 50;\n```","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-28T09:45:19.530764463-06:00","updated_at":"2025-12-28T09:45:19.530764463-06:00","source_repo":".","labels":["M-DOCUMENTED-MAGIC","docs","validators.rs"],"dependencies":[{"issue_id":"rivets-xwcy","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:45:42.528925597-06:00","created_by":"dwalleck"}]}
{"id":"rivets-xy9","content_hash":"93cb37aaa5c5ae17764c12ad4b0ca4c89239639fb8406ea62efdadbd0f6ed943","title":"Implement configuration system with YAML and environment variables","description":"Implement the hierarchical configuration system that merges CLI flags, environment variables, YAML config files, and defaults with proper precedence.","design":"Based on beads internal/config/:\n\n**Precedence (high → low)**:\n1. CLI flags (--db, --json, etc.)\n2. Environment (BD_ACTOR, BD_JSON, BEADS_DIR, etc.)\n3. Config files (.beads/config.yaml, ~/.config/bd/config.yaml)\n4. Defaults\n\n**Config Schema**:\n```yaml\nissue-prefix: \"rivets\"\njson: false\nno-daemon: false\nrouting:\n  mode: auto\n  default: \".\"\nrepos:\n  primary: \".\"\n  additional: []\ndaemon:\n  auto-start: true\n  flush-debounce: \"30s\"\n```\n\n**Rust Stack**:\n- `figment` or `config` crate for merging\n- `serde` for YAML parsing\n- `dirs` for XDG config paths\n\n**Features**:\n- Walk up directory tree to find .beads/config.yaml\n- Merge multiple sources\n- Type-safe access","acceptance_criteria":"- Config merging from all sources works\n- Precedence order enforced correctly\n- YAML parsing functional\n- Environment variable support\n- CLI flag overrides working\n- Default values applied\n- Config validation with helpful errors\n- Unit tests for merge scenarios","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-17T16:16:06.99532982-06:00","updated_at":"2025-11-17T16:16:06.99532982-06:00","source_repo":"."}
{"id":"rivets-y9x","content_hash":"ff449b076550e6608364de9b4eadeac8e87853f503f961d4a8f7c70040554d4c","title":"Add storage metrics to rv stats command","description":"Monitor Automerge document growth and history depth.\n\nAdd to `rv stats` output:\n- Document file size (bytes)\n- Number of changes in history\n- Number of actors (unique editors)\n- Last compaction date (if applicable)\n- Comparison to equivalent JSONL size\n\nThis helps users understand storage overhead and decide when compaction is needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:49:43.181865075-06:00","updated_at":"2025-12-22T22:45:34.661097069-06:00","closed_at":"2025-12-22T22:45:34.661097069-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-y9x","depends_on_id":"rivets-5vz","type":"blocks","created_at":"2025-11-30T15:49:43.211304932-06:00","created_by":"dwalleck"}]}
{"id":"rivets-yip","content_hash":"bb0e76ef37cc3ffe620d834c6eae38b0ff111460181893356bb3a533e885672e","title":"Write comprehensive API documentation","description":"Write comprehensive rustdoc documentation for all public APIs with usage examples.\n\nDocumentation should match or exceed the quality outlined in research document.","design":"Documentation requirements:\n\n1. **Module-level docs** (lib.rs):\n   - Overview of library\n   - Quick start guide\n   - Feature comparison with other libraries\n   - Performance characteristics\n\n2. **Type documentation**:\n   - JsonlReader with examples\n   - JsonlWriter with examples\n   - JsonlQuery with examples\n   - Warning types\n   - Error types\n\n3. **Method documentation**:\n   - All public methods documented\n   - Include # Example blocks\n   - Document edge cases\n   - Document performance characteristics\n\n4. **README.md**:\n   - Installation instructions\n   - Quick start\n   - Feature list\n   - Performance benchmarks\n   - Comparison with alternatives\n\nGenerate docs with `cargo doc --no-deps --open`.","acceptance_criteria":"- All public APIs documented\n- Module-level docs comprehensive\n- README.md complete\n- All doc examples compile (tested with cargo test --doc)\n- Documentation coverage \u003e90%\n- cargo doc generates without warnings","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T17:18:03.937459711-06:00","updated_at":"2025-11-27T17:18:03.937459711-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-yip","depends_on_id":"rivets-kuf","type":"blocks","created_at":"2025-11-27T17:20:41.446316666-06:00","created_by":"dwalleck"}]}
{"id":"rivets-yis","content_hash":"d98e9b4a7c198849ee94471dbd936590558817d6eed94c63f6dbeae0340cc64d","title":"Implement storage backend selection via configuration","description":"Add configuration options to select storage backend (in-memory, PostgreSQL, SQLite) and pass connection parameters. Enables switching backends without code changes.","design":"Extend config system:\n\n```yaml\n# .rivets/config.yaml\nstorage:\n  backend: \"memory\"  # Options: memory, postgres, sqlite\n  \n  # For memory backend\n  data_file: \".rivets/issues.jsonl\"\n  \n  # For postgres backend (future)\n  postgres:\n    host: \"localhost\"\n    port: 5432\n    database: \"rivets\"\n    user: \"rivets\"\n    password_env: \"RIVETS_DB_PASSWORD\"\n  \n  # For sqlite backend (future)\n  sqlite:\n    path: \".rivets/rivets.db\"\n```\n\n**Config struct**:\n```rust\n#[derive(Deserialize)]\npub struct StorageConfig {\n    pub backend: StorageBackend,\n    pub data_file: Option\u003cPathBuf\u003e,\n    pub postgres: Option\u003cPostgresConfig\u003e,\n    pub sqlite: Option\u003cSqliteConfig\u003e,\n}\n\npub enum StorageBackend {\n    Memory,\n    Postgres,  // Future\n    Sqlite,    // Future\n}\n```\n\n**Factory pattern**:\n```rust\npub fn create_storage(config: \u0026StorageConfig) -\u003e Result\u003cBox\u003cdyn IssueStorage\u003e\u003e {\n    match config.backend {\n        StorageBackend::Memory =\u003e {\n            let path = config.data_file.as_ref()\n                .ok_or(Error::ConfigMissing(\"data_file\"))?;\n            \n            let storage = if path.exists() {\n                InMemoryStorage::load_from_jsonl(path)?\n            } else {\n                InMemoryStorage::new()\n            };\n            \n            Ok(Box::new(storage))\n        }\n        StorageBackend::Postgres =\u003e {\n            unimplemented!(\"PostgreSQL backend coming soon\")\n        }\n        StorageBackend::Sqlite =\u003e {\n            unimplemented!(\"SQLite backend coming soon\")\n        }\n    }\n}\n```","acceptance_criteria":"- Config supports storage backend selection\n- Factory creates correct storage implementation\n- In-memory backend configurable\n- Config validation with helpful errors\n- Environment variable support for secrets\n- Default backend is memory + JSONL\n- Integration test verifies backend switching","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-17T16:41:42.380662548-06:00","updated_at":"2025-11-17T16:41:42.380662548-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-yis","depends_on_id":"rivets-cgl","type":"blocks","created_at":"2025-11-17T16:46:30.048522789-06:00","created_by":"daemon"}]}
{"id":"rivets-yyri","content_hash":"db3327cf530db93c01d038fb385eefbf1e7d4b8d4547b7101b71c513e4e1aa9d","title":"Refactor: Extract shared validation logic between Issue and NewIssue","description":"In domain/mod.rs, `Issue::validate()` (lines 118-138) and `NewIssue::validate()` (lines 321-344) have similar validation logic:\n\n**Issue::validate():**\n```rust\npub fn validate(\u0026self) -\u003e Result\u003c(), String\u003e {\n    let trimmed_title = self.title.trim();\n    if trimmed_title.is_empty() { return Err(...); }\n    if self.title.len() \u003e MAX_TITLE_LENGTH { return Err(...); }\n    if self.priority \u003e 4 { return Err(...); }\n    Ok(())\n}\n```\n\n**NewIssue::validate():**\n```rust\npub fn validate(\u0026self) -\u003e Result\u003c(), String\u003e {\n    let trimmed_title = self.title.trim();\n    if trimmed_title.is_empty() { return Err(...); }\n    if trimmed_title.len() \u003e MAX_TITLE_LENGTH { return Err(...); }\n    if self.priority \u003e 4 { return Err(...); }\n    Ok(())\n}\n```\n\n**Recommendation:** Extract to a helper function:\n```rust\nfn validate_title_and_priority(title: \u0026str, priority: u8) -\u003e Result\u003c(), String\u003e {\n    let trimmed = title.trim();\n    if trimmed.is_empty() { return Err(\"Title cannot be empty\".to_string()); }\n    if trimmed.len() \u003e MAX_TITLE_LENGTH { return Err(...); }\n    if priority \u003e MAX_PRIORITY { return Err(...); }\n    Ok(())\n}\n```\n\nNote: Also addresses the hardcoded `4` vs `MAX_PRIORITY` constant issue.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T09:50:52.984657028-06:00","updated_at":"2025-12-28T14:57:06.989347788-06:00","closed_at":"2025-12-28T14:57:06.989347788-06:00","source_repo":".","labels":["DRY","domain","refactor"],"dependencies":[{"issue_id":"rivets-yyri","depends_on_id":"rivets-q82","type":"parent-child","created_at":"2025-12-28T09:51:37.459999983-06:00","created_by":"dwalleck"}]}
{"id":"rivets-zcy","content_hash":"c72626c70cdb176c6c68b819be941df66c288d559de0ac8338c7b8ea336829bd","title":"Evaluate rstest for rivets/src/storage/mod.rs inline tests","description":"Evaluate and apply rstest improvements to inline unit tests in storage/mod.rs.\n\nFile: crates/rivets/src/storage/mod.rs (lines ~323+)","acceptance_criteria":"- Inline tests evaluated for rstest opportunities\n- Parameterization applied where beneficial\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T19:19:25.117428822-06:00","updated_at":"2025-11-28T19:29:24.9413305-06:00","closed_at":"2025-11-28T19:29:24.9413305-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-zcy","depends_on_id":"rivets-ry6","type":"parent-child","created_at":"2025-11-28T19:20:17.541728337-06:00","created_by":"dwalleck"}]}
{"id":"rivets-zk2q","content_hash":"1bc2c02c5d7a776aec1fe3b80725801798a0866348f7785a9ada9a39f808e51f","title":"Cross-File Reference Resolution","description":"Enable tethys to resolve references across files, so `tethys callers` and `tethys impact` work for symbols defined in other files.\n\nTwo phases:\n1. **Tree-sitter resolution (~85% accuracy)** - resolve via import paths ✅ COMPLETE\n2. **LSP refinement (~98% accuracy)** - delegate ambiguous cases to rust-analyzer/csharp-ls\n\nDesign doc: docs/plans/2026-01-28-cross-file-resolution.md","notes":"## Phase 1 Status: COMPLETE (2026-01-28)\n\nAll Phase 1 tasks completed:\n- ✅ imports table added to schema\n- ✅ Import extraction for Rust (`use`) and C# (`using`)\n- ✅ Unresolved references stored with symbol_id = NULL\n- ✅ Pass 2 resolution implemented\n- ✅ Integration tests passing\n- ✅ Performance benchmarks documented in BENCHMARKS.md\n\n## Phase 2 Status: IN PROGRESS\n\nCompleted tasks:\n- ✅ rivets-8j9u: Add lsp-types dependency\n- ✅ rivets-h1va: Implement LspClient with JSON-RPC transport\n- ✅ rivets-nwwm: Implement LspProvider trait + RustAnalyzerProvider\n\nRemaining tasks:\n- rivets-oeu5: Add --lsp flag to CLI commands\n- rivets-k3mv: Integrate LSP into index --lsp\n- rivets-1dza: Integrate LSP into callers --lsp\n- rivets-6x7g: Add CSharpLsProvider\n- rivets-9o82: Add gated integration tests\n\nKey commit: feat(tethys): add LSP client infrastructure for Phase 2","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-28T11:26:53.486115898-06:00","updated_at":"2026-01-28T18:24:39.645610891-06:00","source_repo":"."}
{"id":"rivets-zkb","content_hash":"9f4236daaac0388c2219d0d49351907247d286359091d37c84e1ad19e81775d5","title":"Evaluate cache eviction strategy for workspace storage","description":"The current workspace storage uses FIFO eviction when the cache limit (8 workspaces) is reached. Consider whether LRU eviction would be more appropriate for typical usage patterns.\n\nContext from PR review:\n- Current implementation: FIFO eviction via `workspace_order.remove(0)`\n- Alternative: LRU eviction (move recently-used workspaces to end of queue)\n- Trade-off: FIFO is simpler but may evict frequently-used workspaces\n\nEvaluation should consider:\n1. Typical agent workflow patterns (do they frequently switch between workspaces?)\n2. Memory/performance impact of LRU tracking\n3. Whether the current cache limit (8) is appropriate","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-29T01:29:32.898224105-06:00","updated_at":"2025-11-29T01:29:32.898224105-06:00","source_repo":".","labels":["performance","rivets-mcp"]}
{"id":"rivets-zp3","content_hash":"8074c7163c84edc425be6b97ee3c06a1d39bb99c61f6b4a17fb11e7cf0052737","title":"Implement rivets-jsonl library skeleton with core modules","description":"Create the initial implementation of the rivets-jsonl library including lib.rs and stub modules for reader, writer, query, stream, and error. Set up the public API structure and basic error types.","design":"Based on rivets-kr3 design:\n- Create src/lib.rs with public API exports\n- Create src/error.rs with thiserror-based error types\n- Create src/reader.rs stub for JSONL reading operations\n- Create src/writer.rs stub for JSONL writing operations\n- Create src/query.rs stub for query/filter operations\n- Create src/stream.rs stub for streaming operations\n- Add module-level documentation\n- Create basic integration test in tests/\n- Create simple example in examples/basic.rs","acceptance_criteria":"- All module files created with proper exports from lib.rs\n- Error types defined using thiserror\n- Each module has doc comments explaining its purpose\n- Basic integration test compiles and runs\n- Example code compiles and demonstrates usage\n- `cargo test --package rivets-jsonl` passes\n- `cargo doc --package rivets-jsonl` generates without warnings","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-17T15:45:32.940600766-06:00","updated_at":"2025-11-27T17:13:36.884206539-06:00","closed_at":"2025-11-27T17:13:36.884206539-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-zp3","depends_on_id":"rivets-fk9","type":"blocks","created_at":"2025-11-17T15:45:32.942213604-06:00","created_by":"daemon"}]}
{"id":"rivets-zy0","content_hash":"62e84295cf9febb03671e91b5a1ed21582873f478386c24bffa4979c65b6d98b","title":"Implement streaming support for JsonlReader","description":"Implement the stream() method that returns an async Stream of deserialized records. This enables efficient processing of large JSONL files with constant memory usage.\n\nUses futures::Stream for the return type.","design":"```rust\nuse futures::stream::{Stream, StreamExt};\nuse std::pin::Pin;\n\nimpl\u003cR: AsyncRead + Unpin\u003e JsonlReader\u003cR\u003e {\n    pub fn stream\u003cT\u003e(self) -\u003e impl Stream\u003cItem = Result\u003cT\u003e\u003e\n    where\n        T: DeserializeOwned + 'static,\n    {\n        futures::stream::unfold(self, |mut reader| async move {\n            match reader.read_line().await {\n                Ok(Some(value)) =\u003e Some((Ok(value), reader)),\n                Ok(None) =\u003e None, // EOF\n                Err(e) =\u003e Some((Err(e), reader)),\n            }\n        })\n    }\n}\n```\n\nAdd futures dependency to Cargo.toml.","acceptance_criteria":"- stream() method implemented returning impl Stream\u003cItem = Result\u003cT\u003e\u003e\n- Uses futures::stream::unfold for lazy evaluation\n- Properly handles EOF (returns None to terminate stream)\n- Errors propagated through stream\n- Memory usage constant regardless of file size\n- Unit tests verify streaming behavior\n- Integration test with large file (1000+ records)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T17:14:45.895377787-06:00","updated_at":"2025-11-27T18:40:17.811744371-06:00","closed_at":"2025-11-27T18:40:17.811744371-06:00","source_repo":".","dependencies":[{"issue_id":"rivets-zy0","depends_on_id":"rivets-len","type":"blocks","created_at":"2025-11-27T17:18:52.345950628-06:00","created_by":"dwalleck"}]}
